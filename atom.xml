<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>麒麟教育</title>
  
  <subtitle>麒麟成长点点滴滴</subtitle>
  <link href="https://blog.wangk.cn/atom.xml" rel="self"/>
  
  <link href="https://blog.wangk.cn/"/>
  <updated>2021-04-29T04:15:26.666Z</updated>
  <id>https://blog.wangk.cn/</id>
  
  <author>
    <name>麒麟爸</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Docker部署Portainer</title>
    <link href="https://blog.wangk.cn/2021/04/29/Docker%E9%83%A8%E7%BD%B2Portainer/"/>
    <id>https://blog.wangk.cn/2021/04/29/Docker%E9%83%A8%E7%BD%B2Portainer/</id>
    <published>2021-04-29T04:10:40.000Z</published>
    <updated>2021-04-29T04:15:26.666Z</updated>
    
    <content type="html"><![CDATA[<h1 id="可视化图形工具Portainer"><a href="#可视化图形工具Portainer" class="headerlink" title="可视化图形工具Portainer"></a>可视化图形工具Portainer</h1><h2 id="Portainer介绍"><a href="#Portainer介绍" class="headerlink" title="Portainer介绍"></a>Portainer介绍</h2><p>Portainer是一个可视化的容器镜像的图形管理工具，利用Portainer可以轻松构建，管理和维护Docker环境。 而且完全免费，基于容器化的安装方式，方便高效部署。官方站点：<a href="http://www.yunweipai.com/go?_=ad9d485327aHR0cHM6Ly93d3cucG9ydGFpbmVyLmlvLw==">https://www.portainer.io/</a></p><h2 id="安装Portainer"><a href="#安装Portainer" class="headerlink" title="安装Portainer"></a>安装Portainer</h2><p>官方安装说明：<a href="http://www.yunweipai.com/go?_=8fe4813824aHR0cHM6Ly93d3cucG9ydGFpbmVyLmlvL2luc3RhbGxhdGlvbi8=">https://www.portainer.io/installation/</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ docker search portainer |head -n 3</span><br><span class="line">NAME                             DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">portainer/portainer              This Repo is now deprecated, use portainer/p…   2067</span><br><span class="line">portainer/portainer-ce           Portainer CE - Making Docker and Kubernetes …   494</span><br><span class="line">root @ wangk.cn <span class="keyword">in</span> ~ [12:12:50]</span><br><span class="line"></span><br><span class="line">$ docker volume create portainer_data</span><br><span class="line">portainer_data</span><br><span class="line">$ docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</span><br><span class="line">20db26b67b791648c2ef6aee444a5226a9c897ebcf0160050e722dbf4a4906e3</span><br><span class="line">$ docker ps </span><br><span class="line">CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS                                            NAMES</span><br><span class="line">20db26b67b79        portainer/portainer   <span class="string">&quot;/portainer&quot;</span>        5 seconds ago       Up 4 seconds        0.0.0.0:8000-&gt;8000/tcp, 0.0.0.0:9000-&gt;9000/tcp   portainer</span><br></pre></td></tr></table></figure><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">   </span><br><span class="line">    <span class="attr">portainer:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">portainer/portainer</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;9000:9000&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;$&#123;wwwdata&#125;/docker/portainer:/data&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;可视化图形工具Portainer&quot;&gt;&lt;a href=&quot;#可视化图形工具Portainer&quot; class=&quot;headerlink&quot; title=&quot;可视化图形工具Portainer&quot;&gt;&lt;/a&gt;可视化图形工具Portainer&lt;/h1&gt;&lt;h2 id=&quot;Portainer</summary>
      
    
    
    
    
    <category term="docker" scheme="https://blog.wangk.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>设置阿里云pip源，加速pip更新速度</title>
    <link href="https://blog.wangk.cn/2021/03/15/%E8%AE%BE%E7%BD%AE%E9%98%BF%E9%87%8C%E4%BA%91pip%E6%BA%90%EF%BC%8C%E5%8A%A0%E9%80%9Fpip%E6%9B%B4%E6%96%B0%E9%80%9F%E5%BA%A6/"/>
    <id>https://blog.wangk.cn/2021/03/15/%E8%AE%BE%E7%BD%AE%E9%98%BF%E9%87%8C%E4%BA%91pip%E6%BA%90%EF%BC%8C%E5%8A%A0%E9%80%9Fpip%E6%9B%B4%E6%96%B0%E9%80%9F%E5%BA%A6/</id>
    <published>2021-03-15T15:49:37.000Z</published>
    <updated>2021-03-15T15:51:05.896Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux-系统"><a href="#Linux-系统" class="headerlink" title="Linux 系统"></a>Linux 系统</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/.pip</span><br><span class="line"></span><br><span class="line">cat &gt; ~/.pip/pip.conf &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br><span class="line">index-url=https://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h1 id="Windows系统"><a href="#Windows系统" class="headerlink" title="Windows系统"></a>Windows系统</h1><p>首先在window的文件夹窗口输入 ： %APPDATA%</p><p>然后创建pip文件夹</p><p>最后创建pip.ini文件，写入如下内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = https://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">[install]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Linux-系统&quot;&gt;&lt;a href=&quot;#Linux-系统&quot; class=&quot;headerlink&quot; title=&quot;Linux 系统&quot;&gt;&lt;/a&gt;Linux 系统&lt;/h1&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td cl</summary>
      
    
    
    
    <category term="Python" scheme="https://blog.wangk.cn/categories/Python/"/>
    
    
    <category term="Python" scheme="https://blog.wangk.cn/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Docker部署Tomcat</title>
    <link href="https://blog.wangk.cn/2021/02/02/Docker%E9%83%A8%E7%BD%B2Tomcat/"/>
    <id>https://blog.wangk.cn/2021/02/02/Docker%E9%83%A8%E7%BD%B2Tomcat/</id>
    <published>2021-02-02T01:28:37.000Z</published>
    <updated>2021-03-15T02:34:38.226Z</updated>
    
    <content type="html"><![CDATA[<h1 id="docker-compose-yaml文件配置"><a href="#docker-compose-yaml文件配置" class="headerlink" title="docker-compose.yaml文件配置"></a>docker-compose.yaml文件配置</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">A:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">tomcat:latest</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">8080</span><span class="string">:8080</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span>  <span class="string">$&#123;wwwdata&#125;/docker/webapps:/usr/local/tomcat/webapps</span></span><br><span class="line">            <span class="bullet">-</span>  <span class="string">$&#123;wwwconf&#125;/etc/tomcat/tomcat-users.xml:/usr/local/tomcat/conf/tomcat-users.xml</span></span><br></pre></td></tr></table></figure><h1 id="tomcat-users-xml配置文件"><a href="#tomcat-users-xml配置文件" class="headerlink" title="tomcat-users.xml配置文件"></a>tomcat-users.xml配置文件</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tomcat-users</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://tomcat.apache.org/xml&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-script&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-jmx&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-status&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;admin-script&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;admin-gui&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> <span class="attr">roles</span>=<span class="string">&quot;manager-gui,manager-script,manager-jmx,manager-status,admin-script,admin-gui&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tomcat-users</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;docker-compose-yaml文件配置&quot;&gt;&lt;a href=&quot;#docker-compose-yaml文件配置&quot; class=&quot;headerlink&quot; title=&quot;docker-compose.yaml文件配置&quot;&gt;&lt;/a&gt;docker-compose.ya</summary>
      
    
    
    
    <category term="docker" scheme="https://blog.wangk.cn/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.wangk.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker部署elasticsearch</title>
    <link href="https://blog.wangk.cn/2021/02/02/Docker%E9%83%A8%E7%BD%B2elasticsearch/"/>
    <id>https://blog.wangk.cn/2021/02/02/Docker%E9%83%A8%E7%BD%B2elasticsearch/</id>
    <published>2021-02-02T01:25:27.000Z</published>
    <updated>2021-03-15T02:34:38.227Z</updated>
    
    <content type="html"><![CDATA[<h1 id="docker-compose-yaml文件配置"><a href="#docker-compose-yaml文件配置" class="headerlink" title="docker-compose.yaml文件配置"></a>docker-compose.yaml文件配置</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">   </span><br><span class="line">    <span class="attr">elasticsearch:</span></span><br><span class="line">        <span class="comment">#build:</span></span><br><span class="line">        <span class="comment">#    context: Dockerfile</span></span><br><span class="line">        <span class="comment">#    dockerfile: elasticsearch</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">wangk/elasticsearch</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">elasticsearch</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;9200:9200&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;9300:9300&quot;</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;$&#123;wwwdata&#125;/docker/elasticsearch:/usr/share/elasticsearch/data&quot;</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">elastichd:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">containerize/elastichd</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">elastichd</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;9800:9800&quot;</span></span><br><span class="line">        <span class="attr">depends_on:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;elasticsearch&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;docker-compose-yaml文件配置&quot;&gt;&lt;a href=&quot;#docker-compose-yaml文件配置&quot; class=&quot;headerlink&quot; title=&quot;docker-compose.yaml文件配置&quot;&gt;&lt;/a&gt;docker-compose.ya</summary>
      
    
    
    
    <category term="docker" scheme="https://blog.wangk.cn/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.wangk.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker部署frps</title>
    <link href="https://blog.wangk.cn/2021/02/02/Docker%E9%83%A8%E7%BD%B2frps/"/>
    <id>https://blog.wangk.cn/2021/02/02/Docker%E9%83%A8%E7%BD%B2frps/</id>
    <published>2021-02-02T01:13:47.000Z</published>
    <updated>2021-03-15T02:34:38.229Z</updated>
    
    <content type="html"><![CDATA[<h1 id="docker-compose-yaml文件配置"><a href="#docker-compose-yaml文件配置" class="headerlink" title="docker-compose.yaml文件配置"></a>docker-compose.yaml文件配置</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">   </span><br><span class="line">    <span class="attr">frps:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">snowdreamtech/frps</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">frps</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;17000:17000&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;27500:17500&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;10022:10022&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;10080:10080&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;10443:10443&quot;</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;$&#123;wwwconf&#125;/etc/frps/frps.ini:/etc/frp/frps.ini&quot;</span></span><br></pre></td></tr></table></figure><h1 id="frps-ini配置文件"><a href="#frps-ini配置文件" class="headerlink" title="frps.ini配置文件"></a>frps.ini配置文件</h1><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">17000</span></span><br><span class="line"><span class="attr">token</span> = admin</span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">10080</span></span><br><span class="line"><span class="attr">vhost_https_port</span> = <span class="number">10443</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">dashboard_port</span> = <span class="number">17500</span></span><br><span class="line"><span class="attr">dashboard_user</span> = admin</span><br><span class="line"><span class="attr">dashboard_pwd</span> = admin</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="attr">tcp_mux</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">max_pool_count</span> = <span class="number">10</span></span><br></pre></td></tr></table></figure><h1 id="frpc配置文件"><a href="#frpc配置文件" class="headerlink" title="frpc配置文件"></a>frpc配置文件</h1><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">127.17</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">17000</span></span><br><span class="line"><span class="attr">token</span> = admin</span><br><span class="line"></span><br><span class="line"><span class="section">[web]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_port</span> = <span class="number">8000</span></span><br><span class="line"><span class="attr">custom_domains</span> = www.wangk.cn</span><br><span class="line"></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="frpc启动脚本"><a href="#frpc启动脚本" class="headerlink" title="frpc启动脚本"></a>frpc启动脚本</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frpc -c frpc.ini</span><br></pre></td></tr></table></figure><h1 id="外网访问"><a href="#外网访问" class="headerlink" title="外网访问"></a>外网访问</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.wangk.cn:10080</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;docker-compose-yaml文件配置&quot;&gt;&lt;a href=&quot;#docker-compose-yaml文件配置&quot; class=&quot;headerlink&quot; title=&quot;docker-compose.yaml文件配置&quot;&gt;&lt;/a&gt;docker-compose.ya</summary>
      
    
    
    
    <category term="docker" scheme="https://blog.wangk.cn/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.wangk.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker部署Lnmp</title>
    <link href="https://blog.wangk.cn/2021/02/02/Docker%E9%83%A8%E7%BD%B2Lnmp/"/>
    <id>https://blog.wangk.cn/2021/02/02/Docker%E9%83%A8%E7%BD%B2Lnmp/</id>
    <published>2021-02-02T01:13:47.000Z</published>
    <updated>2021-03-18T12:05:55.290Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">   </span><br><span class="line">    nginx:</span><br><span class="line">        image: wangk/nginx</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">            - $&#123;nginx_port_80&#125;:80</span><br><span class="line">            - $&#123;nginx_port_443&#125;:443</span><br><span class="line">            - $&#123;nginx_port_80_other&#125;:80</span><br><span class="line">        volumes:</span><br><span class="line">            - &quot;$&#123;workspace&#125;:$&#123;workspace&#125;&quot;</span><br><span class="line">            - &quot;$&#123;wwwconf&#125;/etc/docker:/etc/nginx&quot;</span><br><span class="line">    mysql:</span><br><span class="line">        image: wangk/mysql</span><br><span class="line">        container_name: mysql</span><br><span class="line">        restart: always</span><br><span class="line">        environment:</span><br><span class="line">            MYSQL_ROOT_PASSWORD: $&#123;MYSQL_ROOT_PASSWORD&#125;</span><br><span class="line">            TZ: $&#123;WORKSPACE_TIMEZONE&#125;</span><br><span class="line">        command:</span><br><span class="line">            --default_authentication_plugin=mysql_native_password</span><br><span class="line">        volumes:</span><br><span class="line">            - &quot;$&#123;wwwdata&#125;/docker/mysql:/var/lib/mysql&quot;</span><br><span class="line">        ports:</span><br><span class="line">            - &quot;$&#123;mysql_port_default&#125;:3306&quot;</span><br><span class="line">    php80:</span><br><span class="line">        image: wangk/php:8.0-fpm</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">            - &quot;$&#123;php80_fpm_port&#125;:9000&quot;</span><br><span class="line">        volumes:</span><br><span class="line">            - &quot;$&#123;workspace&#125;:$&#123;workspace&#125;&quot;</span><br><span class="line">    php74:</span><br><span class="line">        image: wangk/php:7.4-fpm</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">            - &quot;$&#123;php74_fpm_port&#125;:9000&quot;</span><br><span class="line">        volumes:</span><br><span class="line">            - &quot;$&#123;workspace&#125;:$&#123;workspace&#125;&quot;</span><br><span class="line">    php73:</span><br><span class="line">        image: wangk/php:7.3-fpm</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">            - &quot;$&#123;php73_fpm_port&#125;:9000&quot;</span><br><span class="line">        volumes:</span><br><span class="line">            - &quot;$&#123;workspace&#125;:$&#123;workspace&#125;&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;</summary>
      
    
    
    
    <category term="docker" scheme="https://blog.wangk.cn/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.wangk.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>PHP 7.4 新特性</title>
    <link href="https://blog.wangk.cn/2020/01/21/PHP-7-4-%E6%96%B0%E7%89%B9%E6%80%A7/"/>
    <id>https://blog.wangk.cn/2020/01/21/PHP-7-4-%E6%96%B0%E7%89%B9%E6%80%A7/</id>
    <published>2020-01-21T07:00:31.000Z</published>
    <updated>2021-03-15T02:34:38.231Z</updated>
    
    <content type="html"><![CDATA[<h2 id="预加载"><a href="#预加载" class="headerlink" title="预加载"></a>预加载</h2><p>预加载的实现理论上是可以为 PHP 带来很大的性能提升的。比如说：现在传统的 PHP 框架或者项目，都是有一次请求就加载和重新编译一次文件的。预加载的实现使得我们可以直接将 PHP 文件加载到内存中，并一次来永驻内存来应对后续的请求。（跟 swoole 有点像了？）</p><p>不过预加载也会带来一点机器内存要求和一些损耗，你还需要注意的是，每次在更新完 PHP 文件之后，你需要重启服务才可以使得新的 PHP 文件生效。</p><h2 id="属性类型限定"><a href="#属性类型限定" class="headerlink" title="属性类型限定"></a>属性类型限定</h2><p>在定义类属性的时候，你可以限定属性的类型 string boolean 或者是一个类的实例：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GeiXue</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> Foo <span class="variable">$foo</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="类型限定"><a href="#类型限定" class="headerlink" title="类型限定"></a>类型限定</h2><p>其实类型限定在 PHP 很早之前就支持了，只不过在 7.4 版本之后，PHP 做得更好了，我们来看两个例子：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parents</span> </span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parents</span> </span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">covariantReturnTypes</span>(<span class="params"></span>): <span class="title">Parents</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="comment">/* … */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">covariantReturnTypes</span>(<span class="params"></span>): <span class="title">Child</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="comment">/* … */</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者下面这个例子你就很熟悉了：参数类型限定</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contraVariantArguments</span>(<span class="params">Child <span class="variable">$child</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123; <span class="comment">/* … */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contraVariantArguments</span>(<span class="params">Parents <span class="variable">$parent</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123; <span class="comment">/* … */</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="外部函数接口"><a href="#外部函数接口" class="headerlink" title="外部函数接口"></a>外部函数接口</h2><p>外部函数接口（Foreign Function Interface）总的来说就是允许你调用 C 代码，也就是说，最好的应用场景可能就是：你以后写 PHP 的扩展就可直接用 PHP 来写了！</p><p>不过需要注意的是：这目前来说还是比较复杂的，你最好还是有点 C 语言的基础。</p><h2 id="新的-Null-三元操作符"><a href="#新的-Null-三元操作符" class="headerlink" title="新的 Null 三元操作符"></a>新的 Null 三元操作符</h2><p>以前我们可能会这样写：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span>[<span class="string">&#x27;date&#x27;</span>] = <span class="variable">$data</span>[<span class="string">&#x27;date&#x27;</span>] ?? <span class="keyword">new</span> DateTime();</span><br></pre></td></tr></table></figure><p>PHP 7.4 之后你可以这样：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span>[<span class="string">&#x27;date&#x27;</span>] ??= <span class="keyword">new</span> DateTime();</span><br></pre></td></tr></table></figure><h2 id="自定义对象序列化"><a href="#自定义对象序列化" class="headerlink" title="自定义对象序列化"></a>自定义对象序列化</h2><p>在 PHP 7.4 的时候，增加了 __serialize 和 __unserialize 这两个魔术方法，你可以用来自定义对象的序列化。</p><h2 id="新增-mb-str-split-函数"><a href="#新增-mb-str-split-函数" class="headerlink" title="新增 mb_str_split 函数"></a>新增 mb_str_split 函数</h2><p>这个函数就是 str_split 函数的 mb (multi bytes) 版本，跟你接触过的 mb_substr 和 substr 是同理的。</p><h2 id="PEAR-不再默认开启PEAR-不再默认开启PEAR-不再默认开启"><a href="#PEAR-不再默认开启PEAR-不再默认开启PEAR-不再默认开启" class="headerlink" title="PEAR 不再默认开启PEAR 不再默认开启PEAR 不再默认开启"></a>PEAR 不再默认开启PEAR 不再默认开启PEAR 不再默认开启</h2><p>由于 PEAR 的开发已经很久没有活跃过了，PHP 官方团队决定移除 PEAR 的默认开启。</p><h2 id="废除-ext-wwdx"><a href="#废除-ext-wwdx" class="headerlink" title="废除 ext/wwdx"></a>废除 ext/wwdx</h2><p>此种数据交换格式貌似从来都没有一个行业标准，所以现在也是该它们退休的时候了。</p><p>最后，你需要注意 PHP 7.4 的向后不兼容特性，可以通过此链接来查看详细内容：<a href="https://github.com/php/php-src/blob/PHP-7.4/UPGRADING">https://github.com/php/php-src/blob/PHP-7.4/UPGRADING</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;预加载&quot;&gt;&lt;a href=&quot;#预加载&quot; class=&quot;headerlink&quot; title=&quot;预加载&quot;&gt;&lt;/a&gt;预加载&lt;/h2&gt;&lt;p&gt;预加载的实现理论上是可以为 PHP 带来很大的性能提升的。比如说：现在传统的 PHP 框架或者项目，都是有一次请求就加载和重新编译一</summary>
      
    
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/categories/Laravel/"/>
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>语义化版本</title>
    <link href="https://blog.wangk.cn/2020/01/21/%E8%AF%AD%E4%B9%89%E5%8C%96%E7%89%88%E6%9C%AC/"/>
    <id>https://blog.wangk.cn/2020/01/21/%E8%AF%AD%E4%B9%89%E5%8C%96%E7%89%88%E6%9C%AC/</id>
    <published>2020-01-21T06:50:21.000Z</published>
    <updated>2021-03-15T02:34:38.243Z</updated>
    
    <content type="html"><![CDATA[<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>版本格式：主版本号.次版本号.修订号，版本号递增规则如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主版本号：当你做了不兼容的 API 修改，</span><br><span class="line">次版本号：当你做了向下兼容的功能性新增，</span><br><span class="line">修订号：当你做了向下兼容的问题修正。</span><br></pre></td></tr></table></figure><p>先行版本号及版本编译元数据可以加到“主版本号.次版本号.修订号”的后面，作为延伸。</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在软件管理的领域里存在着被称作“依赖地狱”的死亡之谷，系统规模越大，加入的包越多，你就越有可能在未来的某一天发现自己已深陷绝望之中。</p><p>在依赖高的系统中发布新版本包可能很快会成为噩梦。如果依赖关系过高，可能面临版本控制被锁死的风险（必须对每一个依赖包改版才能完成某次升级）。而如果依赖关系过于松散，又将无法避免版本的混乱（假设兼容于未来的多个版本已超出了合理数量）。当你专案的进展因为版本依赖被锁死或版本混乱变得不够简便和可靠，就意味着你正处于依赖地狱之中。</p><p>作为这个问题的解决方案之一，我提议用一组简单的规则及条件来约束版本号的配置和增长。这些规则是根据（但不局限于）已经被各种封闭、开放源码软件所广泛使用的惯例所设计。为了让这套理论运作，你必须先有定义好的公共 API 。这可以透过文件定义或代码强制要求来实现。无论如何，这套 API 的清楚明了是十分重要的。一旦你定义了公共 API，你就可以透过修改相应的版本号来向大家说明你的修改。考虑使用这样的版本号格式：X.Y.Z （主版本号.次版本号.修订号）修复问题但不影响API 时，递增修订号；API 保持向下兼容的新增及修改时，递增次版本号；进行不向下兼容的修改时，递增主版本号。</p><p>我称这套系统为“语义化的版本控制”，在这套约定下，版本号及其更新方式包含了相邻版本间的底层代码和修改内容的信息。</p><h2 id="语义化版本控制规范（SemVer）"><a href="#语义化版本控制规范（SemVer）" class="headerlink" title="语义化版本控制规范（SemVer）"></a>语义化版本控制规范（SemVer）</h2><p>以下关键词 MUST、MUST NOT、REQUIRED、SHALL、SHALL NOT、SHOULD、SHOULD NOT、 RECOMMENDED、MAY、OPTIONAL 依照 RFC 2119 的叙述解读。（译注：为了保持语句顺畅， 以下文件遇到的关键词将依照整句语义进行翻译，在此先不进行个别翻译。）</p><p> 1、使用语义化版本控制的软件必须（MUST）定义公共 API。该 API 可以在代码中被定义或出现于严谨的文件内。无论何种形式都应该力求精确且完整。</p><p>2、标准的版本号必须（MUST）采用 X.Y.Z 的格式，其中 X、Y 和 Z 为非负的整数，且禁止（MUST NOT）在数字前方补零。X 是主版本号、Y 是次版本号、而 Z 为修订号。每个元素必须（MUST）以数值来递增。例如：1.9.1 -&gt; 1.10.0 -&gt; 1.11.0。</p><p>3、标记版本号的软件发行后，禁止（MUST NOT）改变该版本软件的内容。任何修改都必须（MUST）以新版本发行。</p><p>4、主版本号为零（0.y.z）的软件处于开发初始阶段，一切都可能随时被改变。这样的公共 API 不应该被视为稳定版4、。</p><p>5、1.0.0 的版本号用于界定公共 API 的形成。这一版本之后所有的版本号更新都基于公共 API 及其修改内容。</p><p>6、修订号 Z（x.y.Z | x &gt; 0）必须（MUST）在只做了向下兼容的修正时才递增。这里的修正指的是针对不正确结果而进行的内部修改。</p><p>7、次版本号 Y（x.Y.z | x &gt; 0）必须（MUST）在有向下兼容的新功能出现时递增。在任何公共 API 的功能被标记为弃用时也必须（MUST）递增。也可以（MAY）在内部程序有大量新功能或改进被加入时递增，其中可以（MAY）包括修订级别的改变。每当次版本号递增时，修订号必须（MUST）归零。</p><p>8、主版本号 X（X.y.z | X &gt; 0）必须（MUST）在有任何不兼容的修改被加入公共 API 时递增。其中可以（MAY）包括次版本号及修订级别的改变。每当主版本号递增时，次版本号和修订号必须（MUST）归零。</p><p>9、先行版本号可以（MAY）被标注在修订版之后，先加上一个连接号再加上一连串以句点分隔的标识符来修饰。标识符必须（MUST）由 ASCII 字母数字和连接号 [0-9A-Za-z-] 组成，且禁止（MUST NOT）留白。数字型的标识符禁止（MUST NOT）在前方补零。先行版的优先级低于相关联的标准版本。被标上先行版本号则表示这个版本并非稳定而且可能无法满足预期的兼容性需求。范例：1.0.0-alpha、1.0.0-alpha.1、1.0.0-0.3.7、1.0.0-x.7.z.92。</p><p>10、版本编译元数据可以（MAY）被标注在修订版或先行版本号之后，先加上一个加号再加上一连串以句点分隔的标识符来修饰。标识符必须（MUST）由 ASCII 字母数字和连接号 [0-9A-Za-z-] 组成，且禁止（MUST NOT）留白。当判断版本的优先层级时，版本编译元数据可（SHOULD）被忽略。因此当两个版本只有在版本编译元数据有差别时，属于相同的优先层级。范例：1.0.0-alpha+001、1.0.0+20130313144700、1.0.0-beta+exp.sha.5114f85。</p><p>11、版本的优先层级指的是不同版本在排序时如何比较。判断优先层级时，必须（MUST）把版本依序拆分为主版本号、次版本号、修订号及先行版本号后进行比较（版本编译元数据不在这份比较的列表中）。由左到右依序比较每个标识符，第一个差异值用来决定优先层级：主版本号、次版本号及修订号以数值比较，例如：1.0.0 &lt; 2.0.0 &lt; 2.1.0 &lt; 2.1.1。当主版本号、次版本号及修订号都相同时，改以优先层级比较低的先行版本号决定。例如：1.0.0-alpha &lt; 1.0.0。有相同主版本号、次版本号及修订号的两个先行版本号，其优先层级必须（MUST）透过由左到右的每个被句点分隔的标识符来比较，直到找到一个差异值后决定：只有数字的标识符以数值高低比较，有字母或连接号时则逐字以 ASCII 的排序来比较。数字的标识符比非数字的标识符优先层级低。若开头的标识符都相同时，栏位比较多的先行版本号优先层级比较高。范例：1.0.0-alpha &lt; 1.0.0-alpha.1 &lt; 1.0.0-alpha.beta &lt; 1.0.0-beta &lt; 1.0.0-beta.2 &lt; 1.0.0-beta.11 &lt; 1.0.0-rc.1 &lt; 1.0.0。</p><h2 id="为什么要使用语义化的版本控制？"><a href="#为什么要使用语义化的版本控制？" class="headerlink" title="为什么要使用语义化的版本控制？"></a>为什么要使用语义化的版本控制？</h2><p>这并不是一个新的或者革命性的想法。实际上，你可能已经在做一些近似的事情了。问题在于只是“近似”还不够。如果没有某个正式的规范可循，版本号对于依赖的管理并无实质意义。将上述的想法命名并给予清楚的定义，让你对软件使用者传达意向变得容易。一旦这些意向变得清楚，弹性（但又不会太弹性）的依赖规范就能达成。</p><p>举个简单的例子就可以展示语义化的版本控制如何让依赖地狱成为过去。假设有个名为“救火车”的函式库，它需要另一个名为“梯子”并已经有使用语义化版本控制的包。当救火车创建时，梯子的版本号为 3.1.0。因为救火车使用了一些版本 3.1.0 所新增的功能， 你可以放心地指定依赖于梯子的版本号大等于 3.1.0 但小于 4.0.0。这样，当梯子版本 3.1.1 和 3.2.0 发布时，你可以将直接它们纳入你的包管理系统，因为它们能与原有依赖的软件兼容。</p><p>作为一位负责任的开发者，你理当确保每次包升级的运作与版本号的表述一致。现实世界是复杂的，我们除了提高警觉外能做的不多。你所能做的就是让语义化的版本控制为你提供一个健全的方式来发行以及升级包，而无需推出新的依赖包，节省你的时间及烦恼。</p><p>如果你对此认同，希望立即开始使用语义化版本控制，你只需声明你的函式库正在使用它并遵循这些规则就可以了。请在你的 README 文件中保留此页连结，让别人也知道这些规则并从中受益。</p><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="在-0-y-z-初始开发阶段，我该如何进行版本控制？"><a href="#在-0-y-z-初始开发阶段，我该如何进行版本控制？" class="headerlink" title="在 0.y.z 初始开发阶段，我该如何进行版本控制？"></a>在 0.y.z 初始开发阶段，我该如何进行版本控制？</h3><p>最简单的做法是以 0.1.0 作为你的初始化开发版本，并在后续的每次发行时递增次版本号。</p><h3 id="如何判断发布-1-0-0-版本的时机？"><a href="#如何判断发布-1-0-0-版本的时机？" class="headerlink" title="如何判断发布 1.0.0 版本的时机？"></a>如何判断发布 1.0.0 版本的时机？</h3><p>当你的软件被用于正式环境，它应该已经达到了 1.0.0 版。如果你已经有个稳定的 API 被使用者依赖，也会是 1.0.0 版。如果你很担心向下兼容的问题，也应该算是 1.0.0 版了。</p><h3 id="这不会阻碍快速开发和迭代吗？"><a href="#这不会阻碍快速开发和迭代吗？" class="headerlink" title="这不会阻碍快速开发和迭代吗？"></a>这不会阻碍快速开发和迭代吗？</h3><p>主版本号为零的时候就是为了做快速开发。如果你每天都在改变 API，那么你应该仍在主版本号为零的阶段（0.y.z），或是正在下个主版本的独立开发分支中。</p><h3 id="对于公共-API，若即使是最小但不向下兼容的改变都需要产生新的主版本号，岂不是很快就达到-42-0-0-版？"><a href="#对于公共-API，若即使是最小但不向下兼容的改变都需要产生新的主版本号，岂不是很快就达到-42-0-0-版？" class="headerlink" title="对于公共 API，若即使是最小但不向下兼容的改变都需要产生新的主版本号，岂不是很快就达到 42.0.0 版？"></a>对于公共 API，若即使是最小但不向下兼容的改变都需要产生新的主版本号，岂不是很快就达到 42.0.0 版？</h3><p>这是开发的责任感和前瞻性的问题。不兼容的改变不应该轻易被加入到有许多依赖代码的软件中。升级所付出的代价可能是巨大的。要递增主版本号来发行不兼容的改版，意味着你必须为这些改变所带来的影响深思熟虑，并且评估所涉及的成本及效益比。</p><h3 id="为整个公共-API-写文件太费事了！"><a href="#为整个公共-API-写文件太费事了！" class="headerlink" title="为整个公共 API 写文件太费事了！"></a>为整个公共 API 写文件太费事了！</h3><p>为供他人使用的软件编写适当的文件，是你作为一名专业开发者应尽的职责。保持专案高效一个非常重要的部份是掌控软件的复杂度，如果没有人知道如何使用你的软件或不知道哪些函数的调用是可靠的，要掌控复杂度会是困难的。长远来看，使用语义化版本控制以及对于公共 API 有良好规范的坚持，可以让每个人及每件事都运行顺畅。</p><h3 id="万一不小心把一个不兼容的改版当成了次版本号发行了该怎么办？"><a href="#万一不小心把一个不兼容的改版当成了次版本号发行了该怎么办？" class="headerlink" title="万一不小心把一个不兼容的改版当成了次版本号发行了该怎么办？"></a>万一不小心把一个不兼容的改版当成了次版本号发行了该怎么办？</h3><p>一旦发现自己破坏了语义化版本控制的规范，就要修正这个问题，并发行一个新的次版本号来更正这个问题并且恢复向下兼容。即使是这种情况，也不能去修改已发行的版本。可以的话，将有问题的版本号记录到文件中，告诉使用者问题所在，让他们能够意识到这是有问题的版本。</p><h3 id="如果我更新了自己的依赖但没有改变公共-API-该怎么办？"><a href="#如果我更新了自己的依赖但没有改变公共-API-该怎么办？" class="headerlink" title="如果我更新了自己的依赖但没有改变公共 API 该怎么办？"></a>如果我更新了自己的依赖但没有改变公共 API 该怎么办？</h3><p>由于没有影响到公共 API，这可以被认定是兼容的。若某个软件和你的包有共同依赖，则它会有自己的依赖规范，作者也会告知可能的冲突。要判断改版是属于修订等级或是次版等级，是依据你更新的依赖关系是为了修复问题或是加入新功能。对于后者，我经常会预期伴随着更多的代码，这显然会是一个次版本号级别的递增。</p><h3 id="如果我变更了公共-API-但无意中未遵循版本号的改动怎么办呢？（意即在修订等级的发布中，误将重大且不兼容的改变加到代码之中）"><a href="#如果我变更了公共-API-但无意中未遵循版本号的改动怎么办呢？（意即在修订等级的发布中，误将重大且不兼容的改变加到代码之中）" class="headerlink" title="如果我变更了公共 API 但无意中未遵循版本号的改动怎么办呢？（意即在修订等级的发布中，误将重大且不兼容的改变加到代码之中）"></a>如果我变更了公共 API 但无意中未遵循版本号的改动怎么办呢？（意即在修订等级的发布中，误将重大且不兼容的改变加到代码之中）</h3><p>自行做最佳的判断。如果你有庞大的使用者群在依照公共 API 的意图而变更行为后会大受影响，那么最好做一次主版本的发布，即使严格来说这个修复仅是修订等级的发布。记住， 语义化的版本控制就是透过版本号的改变来传达意义。若这些改变对你的使用者是重要的，那就透过版本号来向他们说明。</p><h3 id="我该如何处理即将弃用的功能？"><a href="#我该如何处理即将弃用的功能？" class="headerlink" title="我该如何处理即将弃用的功能？"></a>我该如何处理即将弃用的功能？</h3><p>弃用现存的功能是软件开发中的家常便饭，也通常是向前发展所必须的。当你弃用部份公共 API 时，你应该做两件事：（1）更新你的文件让使用者知道这个改变，（2）在适当的时机将弃用的功能透过新的次版本号发布。在新的主版本完全移除弃用功能前，至少要有一个次版本包含这个弃用信息，这样使用者才能平顺地转移到新版 API。</p><h3 id="语义化版本对于版本的字串长度是否有限制呢？"><a href="#语义化版本对于版本的字串长度是否有限制呢？" class="headerlink" title="语义化版本对于版本的字串长度是否有限制呢？"></a>语义化版本对于版本的字串长度是否有限制呢？</h3><p>没有，请自行做适当的判断。举例来说，长到 255 个字元的版本已过度夸张。再者，特定的系统对于字串长度可能会有他们自己的限制。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;摘要&quot;&gt;&lt;a href=&quot;#摘要&quot; class=&quot;headerlink&quot; title=&quot;摘要&quot;&gt;&lt;/a&gt;摘要&lt;/h2&gt;&lt;p&gt;版本格式：主版本号.次版本号.修订号，版本号递增规则如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;tab</summary>
      
    
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/categories/Laravel/"/>
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>docker-compose Redis主从配置</title>
    <link href="https://blog.wangk.cn/2020/01/17/docker-compose-Redis%E4%B8%BB%E4%BB%8E%E9%85%8D%E7%BD%AE/"/>
    <id>https://blog.wangk.cn/2020/01/17/docker-compose-Redis%E4%B8%BB%E4%BB%8E%E9%85%8D%E7%BD%AE/</id>
    <published>2020-01-17T06:28:19.000Z</published>
    <updated>2021-03-15T02:34:38.235Z</updated>
    
    <content type="html"><![CDATA[<h1 id="docker-compose-yaml文件配置"><a href="#docker-compose-yaml文件配置" class="headerlink" title="docker-compose.yaml文件配置"></a>docker-compose.yaml文件配置</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">        <span class="attr">external:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">wangk.cn</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">redis-master:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">            <span class="string">redis-server</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">$&#123;DATA_PATH&#125;/redis-master:/data</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="attr">default:</span></span><br><span class="line">                <span class="attr">ipv4_address:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.201</span></span><br><span class="line">    <span class="attr">redis-slave:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">            <span class="string">redis-server</span> <span class="string">--slaveof</span> <span class="string">redis-master</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">$&#123;DATA_PATH&#125;/redis-slave:/data</span></span><br><span class="line">        <span class="attr">depends_on:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">redis-master</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="attr">default:</span></span><br><span class="line">                <span class="attr">ipv4_address:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.202</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;docker-compose-yaml文件配置&quot;&gt;&lt;a href=&quot;#docker-compose-yaml文件配置&quot; class=&quot;headerlink&quot; title=&quot;docker-compose.yaml文件配置&quot;&gt;&lt;/a&gt;docker-compose.ya</summary>
      
    
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/categories/Laravel/"/>
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>docker-compose数据库主从配置</title>
    <link href="https://blog.wangk.cn/2020/01/17/docker-compose%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%BB%E4%BB%8E%E9%85%8D%E7%BD%AE/"/>
    <id>https://blog.wangk.cn/2020/01/17/docker-compose%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%BB%E4%BB%8E%E9%85%8D%E7%BD%AE/</id>
    <published>2020-01-17T06:16:37.000Z</published>
    <updated>2021-03-15T02:34:38.236Z</updated>
    
    <content type="html"><![CDATA[<h1 id="docker-compose-yaml文件配置"><a href="#docker-compose-yaml文件配置" class="headerlink" title="docker-compose.yaml文件配置"></a>docker-compose.yaml文件配置</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">        <span class="attr">external:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">wangk.cn</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">mysql-master:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">mysql:8</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">TZ=$&#123;WORKSPACE_TIMEZONE&#125;</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">            <span class="string">--default_authentication_plugin=mysql_native_password</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">$&#123;DATA_PATH&#125;/mysql-master:/var/lib/mysql</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">$&#123;DATA_PATH&#125;/mysql:/data/wwwdata</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">$&#123;CONFIG_PATH&#125;/mysql/master.cnf:/etc/mysql/conf.d/master.cnf</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="attr">default:</span></span><br><span class="line">                <span class="attr">ipv4_address:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.151</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">mysql-slave:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">mysql:8</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">TZ=$&#123;WORKSPACE_TIMEZONE&#125;</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">            <span class="string">--default_authentication_plugin=mysql_native_password</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">$&#123;DATA_PATH&#125;/mysql-slave:/var/lib/mysql</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">$&#123;DATA_PATH&#125;/mysql:/data/wwwdata</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">$&#123;CONFIG_PATH&#125;/mysql/slave.cnf:/etc/mysql/conf.d/slave.cnf</span></span><br><span class="line">        <span class="attr">depends_on:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">mysql-master</span></span><br><span class="line">        <span class="attr">networks:</span></span><br><span class="line">            <span class="attr">default:</span></span><br><span class="line">                <span class="attr">ipv4_address:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.152</span></span><br></pre></td></tr></table></figure><h1 id="主从库设置"><a href="#主从库设置" class="headerlink" title="主从库设置"></a>主从库设置</h1><h2 id="master-cnf配置"><a href="#master-cnf配置" class="headerlink" title="master.cnf配置"></a>master.cnf配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">log-bin&#x3D;mysql-bin</span><br><span class="line">server-id&#x3D;1</span><br></pre></td></tr></table></figure><h2 id="slave-cnf配置"><a href="#slave-cnf配置" class="headerlink" title="slave.cnf配置"></a>slave.cnf配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server-id&#x3D;2</span><br></pre></td></tr></table></figure><h2 id="备份主服务器的数据"><a href="#备份主服务器的数据" class="headerlink" title="备份主服务器的数据"></a>备份主服务器的数据</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --all-databases --lock-all-tables &gt; /data/wwwdata/master_db.sql</span><br></pre></td></tr></table></figure><h2 id="创建同步账号"><a href="#创建同步账号" class="headerlink" title="创建同步账号"></a>创建同步账号</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;slave&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"><span class="keyword">SHOW</span> MASTER STATUS;</span><br></pre></td></tr></table></figure><p>##从库导入主库数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &lt; /data/wwwdata/master_db.sql</span><br></pre></td></tr></table></figure><h2 id="设置主节点"><a href="#设置主节点" class="headerlink" title="设置主节点"></a>设置主节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER TO</span><br><span class="line">MASTER_HOST&#x3D;&#39;mysql-master&#39;,</span><br><span class="line">MASTER_USER&#x3D;&#39;slave&#39;,</span><br><span class="line">MASTER_PASSWORD&#x3D;&#39;slave&#39;,</span><br><span class="line">MASTER_LOG_FILE&#x3D;&#39;binlog.000003&#39;,</span><br><span class="line">MASTER_LOG_POS&#x3D;997;</span><br></pre></td></tr></table></figure><h2 id="开启主从同步"><a href="#开启主从同步" class="headerlink" title="开启主从同步"></a>开启主从同步</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> slave;</span><br><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G;</span><br></pre></td></tr></table></figure><h1 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h1><h2 id="每次容器重启从库启动失败。执行"><a href="#每次容器重启从库启动失败。执行" class="headerlink" title="每次容器重启从库启动失败。执行"></a>每次容器重启从库启动失败。执行</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br><span class="line">reset slave;</span><br><span class="line"><span class="keyword">start</span> slave;</span><br></pre></td></tr></table></figure><h2 id="或执行如下"><a href="#或执行如下" class="headerlink" title="或执行如下"></a>或执行如下</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose exec mysql-slave mysql -e <span class="string">&quot;stop slave;reset slave; start slave;&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;docker-compose-yaml文件配置&quot;&gt;&lt;a href=&quot;#docker-compose-yaml文件配置&quot; class=&quot;headerlink&quot; title=&quot;docker-compose.yaml文件配置&quot;&gt;&lt;/a&gt;docker-compose.ya</summary>
      
    
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/categories/Laravel/"/>
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>申请OneDrive 5T 网盘</title>
    <link href="https://blog.wangk.cn/2019/08/01/%E7%94%B3%E8%AF%B7OneDrive%205T%20%E7%BD%91%E7%9B%98/"/>
    <id>https://blog.wangk.cn/2019/08/01/%E7%94%B3%E8%AF%B7OneDrive%205T%20%E7%BD%91%E7%9B%98/</id>
    <published>2019-08-01T03:42:30.000Z</published>
    <updated>2021-03-15T02:34:38.242Z</updated>
    
    <content type="html"><![CDATA[<h1 id="临时邮箱"><a href="#临时邮箱" class="headerlink" title="临时邮箱"></a>临时邮箱</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">2019年5月10日09:22:03 更新</span><br><span class="line">http:&#x2F;&#x2F;xkx.me&#x2F;</span><br><span class="line"></span><br><span class="line">2019年5月8日10:36:13 更新</span><br><span class="line">http:&#x2F;&#x2F;office2016.live&#x2F;</span><br><span class="line"></span><br><span class="line">2019年5月6日16:35:35 更新</span><br><span class="line">http:&#x2F;&#x2F;onedrive.readmail.net&#x2F;</span><br><span class="line"></span><br><span class="line">2019年5月3日17:23:00 更新</span><br><span class="line">http:&#x2F;&#x2F;my365.tw&#x2F;</span><br><span class="line"></span><br><span class="line">2019年4月29日09:12:15 更新</span><br><span class="line">http:&#x2F;&#x2F;24mail.chacuo.net&#x2F;</span><br><span class="line">特别提醒：这个邮箱只需复制邮箱ID，不需要复制@chacuo.net，注册的时候请使用邮箱ID+@stu.mao.office.gy 即可！</span><br><span class="line">申请成功后需要加入N软的组（NRuan.com）内，否则会被删除：https:&#x2F;&#x2F;account.activedirectory.windowsazure.com&#x2F;r#&#x2F;groups</span><br><span class="line"></span><br><span class="line">2019年4月25日15:26:30 更新</span><br><span class="line">https:&#x2F;&#x2F;t.odmail.cn&#x2F;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="注册地址"><a href="#注册地址" class="headerlink" title="注册地址"></a>注册地址</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">学生版：https:&#x2F;&#x2F;signup.microsoft.com&#x2F;signup?sku&#x3D;student</span><br><span class="line"></span><br><span class="line">教师版：https:&#x2F;&#x2F;signup.microsoft.com&#x2F;signup?sku&#x3D;faculty</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;临时邮箱&quot;&gt;&lt;a href=&quot;#临时邮箱&quot; class=&quot;headerlink&quot; title=&quot;临时邮箱&quot;&gt;&lt;/a&gt;临时邮箱&lt;/h1&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pr</summary>
      
    
    
    
    <category term="OneDrive" scheme="https://blog.wangk.cn/categories/OneDrive/"/>
    
    
    <category term="OneDrive" scheme="https://blog.wangk.cn/tags/OneDrive/"/>
    
  </entry>
  
  <entry>
    <title>nginx静态文件缓存的解决方案</title>
    <link href="https://blog.wangk.cn/2019/03/24/nginx%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%BC%93%E5%AD%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>https://blog.wangk.cn/2019/03/24/nginx%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%BC%93%E5%AD%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2019-03-24T14:33:45.000Z</published>
    <updated>2021-03-15T02:34:38.238Z</updated>
    
    <content type="html"><![CDATA[<p>nginx的一大功能就是完成静态资源的分离部署，减轻后端服务器的压力，如果给这些静态资源再加一级nginx的缓存，可以进一步提升访问效率。</p><h1 id="添加nginx-conf的http级别的缓存配置"><a href="#添加nginx-conf的http级别的缓存配置" class="headerlink" title="添加nginx.conf的http级别的缓存配置"></a>添加nginx.conf的http级别的缓存配置</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">##cache##</span></span><br><span class="line">    <span class="attribute">proxy_connect_timeout</span> <span class="number">500</span>;</span><br><span class="line">    <span class="comment">#跟后端服务器连接的超时时间_发起握手等候响应超时时间</span></span><br><span class="line">    <span class="attribute">proxy_read_timeout</span> <span class="number">600</span>;</span><br><span class="line">    <span class="comment">#连接成功后_等候后端服务器响应的时间_其实已经进入后端的排队之中等候处理</span></span><br><span class="line">    <span class="attribute">proxy_send_timeout</span> <span class="number">500</span>;</span><br><span class="line">    <span class="comment">#后端服务器数据回传时间_就是在规定时间内后端服务器必须传完所有数据</span></span><br><span class="line">    <span class="attribute">proxy_buffer_size</span> <span class="number">128k</span>;</span><br><span class="line">    <span class="comment">#代理请求缓存区_这个缓存区间会保存用户的头信息以供Nginx进行规则处理_一般只要能保存下头信息即可  </span></span><br><span class="line">    <span class="attribute">proxy_buffers</span> <span class="number">4</span> <span class="number">128k</span>;</span><br><span class="line">    <span class="comment">#同上 告诉Nginx保存单个用的几个Buffer最大用多大空间</span></span><br><span class="line">    <span class="attribute">proxy_busy_buffers_size</span> <span class="number">256k</span>;</span><br><span class="line">    <span class="comment">#如果系统很忙的时候可以申请更大的proxy_buffers 官方推荐*2</span></span><br><span class="line">    <span class="attribute">proxy_temp_file_write_size</span> <span class="number">128k</span>;</span><br><span class="line">    <span class="comment">#proxy缓存临时文件的大小</span></span><br><span class="line">    <span class="attribute">proxy_temp_path</span> /data/wwwdata/nginx/temp;</span><br><span class="line">    <span class="comment">#用于指定本地目录来缓冲较大的代理请求</span></span><br><span class="line">    <span class="attribute">proxy_cache_path</span> /data/wwwdata/nginx/cache levels=<span class="number">1</span>:<span class="number">2</span> keys_zone=cache_one:<span class="number">200m</span> inactive=<span class="number">1d</span> max_size=<span class="number">30g</span>;</span><br><span class="line">    <span class="comment">#设置web缓存区名为cache_one,内存缓存空间大小为12000M，自动清除超过15天没有被访问过的缓存数据，硬盘缓存空间大小200g</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="在访问静态文件的location上添加缓存"><a href="#在访问静态文件的location上添加缓存" class="headerlink" title="在访问静态文件的location上添加缓存"></a>在访问静态文件的location上添加缓存</h1><h1 id="在proxy-pass跳转的location中配置静态文件的路径"><a href="#在proxy-pass跳转的location中配置静态文件的路径" class="headerlink" title="在proxy_pass跳转的location中配置静态文件的路径"></a>在proxy_pass跳转的location中配置静态文件的路径</h1><h1 id="清除缓存"><a href="#清除缓存" class="headerlink" title="清除缓存"></a>清除缓存</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;nginx的一大功能就是完成静态资源的分离部署，减轻后端服务器的压力，如果给这些静态资源再加一级nginx的缓存，可以进一步提升访问效率。&lt;/p&gt;
&lt;h1 id=&quot;添加nginx-conf的http级别的缓存配置&quot;&gt;&lt;a href=&quot;#添加nginx-conf的http级别</summary>
      
    
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/categories/Laravel/"/>
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>Docker CE</title>
    <link href="https://blog.wangk.cn/2019/01/04/DockerCe/"/>
    <id>https://blog.wangk.cn/2019/01/04/DockerCe/</id>
    <published>2019-01-04T06:20:25.000Z</published>
    <updated>2021-03-15T02:34:38.225Z</updated>
    
    <content type="html"><![CDATA[<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="使用官方安装脚本自动安装"><a href="#使用官方安装脚本自动安装" class="headerlink" title="使用官方安装脚本自动安装"></a>使用官方安装脚本自动安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure><h2 id="Ubuntu-14-04-16-04-使用apt-get进行安装"><a href="#Ubuntu-14-04-16-04-使用apt-get进行安装" class="headerlink" title="Ubuntu 14.04 16.04 (使用apt-get进行安装)"></a>Ubuntu 14.04 16.04 (使用apt-get进行安装)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"><span class="comment"># step 2: 安装GPG证书</span></span><br><span class="line">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"><span class="comment"># Step 3: 写入软件源信息</span></span><br><span class="line">sudo add-apt-repository <span class="string">&quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br><span class="line"><span class="comment"># Step 4: 更新并安装 Docker-CE</span></span><br><span class="line">sudo apt-get -y update</span><br><span class="line">sudo apt-get -y install docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装指定版本的Docker-CE:</span></span><br><span class="line"><span class="comment"># Step 1: 查找Docker-CE的版本:</span></span><br><span class="line"><span class="comment"># apt-cache madison docker-ce</span></span><br><span class="line"><span class="comment">#   docker-ce | 17.03.1~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages</span></span><br><span class="line"><span class="comment">#   docker-ce | 17.03.0~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages</span></span><br><span class="line"><span class="comment"># Step 2: 安装指定版本的Docker-CE: (VERSION 例如上面的 17.03.1~ce-0~ubuntu-xenial)</span></span><br><span class="line"><span class="comment"># sudo apt-get -y install docker-ce=[VERSION]</span></span><br></pre></td></tr></table></figure><h2 id="CentOS-7-使用yum进行安装"><a href="#CentOS-7-使用yum进行安装" class="headerlink" title="CentOS 7 (使用yum进行安装)"></a>CentOS 7 (使用yum进行安装)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具</span></span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="comment"># Step 2: 添加软件源信息</span></span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment"># Step 3: 更新并安装 Docker-CE</span></span><br><span class="line">sudo yum makecache fast</span><br><span class="line">sudo yum -y install docker-ce</span><br><span class="line"><span class="comment"># Step 4: 开启Docker服务</span></span><br><span class="line">sudo service docker start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment"># 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，你可以通过以下方式开启。同理可以开启各种测试版本等。</span></span><br><span class="line"><span class="comment"># vim /etc/yum.repos.d/docker-ce.repo</span></span><br><span class="line"><span class="comment">#   将 [docker-ce-test] 下方的 enabled=0 修改为 enabled=1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 安装指定版本的Docker-CE:</span></span><br><span class="line"><span class="comment"># Step 1: 查找Docker-CE的版本:</span></span><br><span class="line"><span class="comment"># yum list docker-ce.x86_64 --showduplicates | sort -r</span></span><br><span class="line"><span class="comment">#   Loading mirror speeds from cached hostfile</span></span><br><span class="line"><span class="comment">#   Loaded plugins: branch, fastestmirror, langpacks</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   Available Packages</span></span><br><span class="line"><span class="comment"># Step2 : 安装指定版本的Docker-CE: (VERSION 例如上面的 17.03.0.ce.1-1.el7.centos)</span></span><br><span class="line"><span class="comment"># sudo yum -y install docker-ce-[VERSION]</span></span><br></pre></td></tr></table></figure><h2 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/docker/compose/releases</span></span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/1.23.2/docker-compose-`uname -s`-`uname -m` -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure><h2 id="镜像加速器"><a href="#镜像加速器" class="headerlink" title="镜像加速器"></a>镜像加速器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://2tttp2d6.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"><span class="comment"># CentOS</span></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://2tttp2d6.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="安装校验"><a href="#安装校验" class="headerlink" title="安装校验"></a>安装校验</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ ubuntu-bionic in ~ [14:47:25]</span></span><br><span class="line">$ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:           18.09.0</span><br><span class="line"> API version:       1.39</span><br><span class="line"> Go version:        go1.10.4</span><br><span class="line"> Git commit:        4d60db4</span><br><span class="line"> Built:             Wed Nov  7 00:49:01 2018</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.09.0</span><br><span class="line">  API version:      1.39 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.4</span><br><span class="line">  Git commit:       4d60db4</span><br><span class="line">  Built:            Wed Nov  7 00:16:44 2018</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ ubuntu-bionic in ~ [14:47:30]</span></span><br><span class="line">$ docker-compose version</span><br><span class="line">docker-compose version 1.23.2, build 1110ad01</span><br><span class="line">docker-py version: 3.6.0</span><br><span class="line">CPython version: 3.6.7</span><br><span class="line">OpenSSL version: OpenSSL 1.1.0f  25 May 2017</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h1&gt;&lt;h2 id=&quot;使用官方安装脚本自动安装&quot;&gt;&lt;a href=&quot;#使用官方安装脚本自动安装&quot; class=&quot;headerlink&quot; title=&quot;使</summary>
      
    
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/categories/Laravel/"/>
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>Eloquent 模型关联关系</title>
    <link href="https://blog.wangk.cn/2018/12/18/Eloquent%E6%A8%A1%E5%9E%8B%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB/"/>
    <id>https://blog.wangk.cn/2018/12/18/Eloquent%E6%A8%A1%E5%9E%8B%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB/</id>
    <published>2018-12-18T15:16:26.000Z</published>
    <updated>2021-03-24T15:55:30.842Z</updated>
    
    <content type="html"><![CDATA[<p>我们所熟知的 MySQL、SQL Server、Oracle 都是关系型数据库，何谓关系型数据库？简单来说就是数据表之间存在关联关系。到目前为止，我们介绍的所有 Eloquent 模型操作都是针对单表的，接下来我们将花三篇左右的篇幅来给大家介绍如何在 Eloquent 模型类中建立模型之间的各种关联关系，以及如何实现关联查询和更新。</p><p>Eloquent 模型支持的关联关系包括以下七种：</p><ul><li>  一对一</li><li>  一对多</li><li>  多对多</li><li>  远层一对多</li><li>  多态关联（一对一）</li><li>  多态关联（一对多）</li><li>  多态关联（多对多）</li></ul><h1 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h1><h2 id="建立关联关系"><a href="#建立关联关系" class="headerlink" title="建立关联关系"></a>建立关联关系</h2><p>一对一是最简单的关联关系，一般可用于某张数据表的扩展表与主表之间的关联关系。比如在大型系统中，我们的用户表通常用于最基本信息的存储，如邮箱、用户名、密码等，然后像用户爱好、标签、个性签名、所在地等信息都存到另一张扩展表中，需要的时候才会去扩展表取数据，从而提高查询性能。针对这样的场景，我们就可以在两张表对应模型之间建立一对一关联。</p><p>在开始之前，我们先通过数据库迁移创建一张 user_profiles 数据表，并创建对应模型 UserProfile，这可以通过以下 Artisan 命令一次完成：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:model UserProfile -m</span><br></pre></td></tr></table></figure><p>在生成的 create_user_profiles 迁移文件中编写迁移类的 up 方法如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Schema::create(<span class="string">&#x27;user_profiles&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;integer(<span class="string">&#x27;user_id&#x27;</span>)-&gt;unsigned()-&gt;default(<span class="number">0</span>)-&gt;unique();</span><br><span class="line">        <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;bio&#x27;</span>)-&gt;nullable()-&gt;comment(<span class="string">&#x27;个性签名&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;city&#x27;</span>)-&gt;nullable()-&gt;comment(<span class="string">&#x27;所在城市&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;json(<span class="string">&#x27;hobby&#x27;</span>)-&gt;nullable()-&gt;comment(<span class="string">&#x27;个人爱好&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意，我们在 user_profiles 表中添加了一个 user_id 字段用于指向所属用户，从而建立于 users 表的关联。运行 php artisan migrate 在数据库创建这张数据表。</p><p>准备好数据表之后，接下来，我们来通过模型类建立 users 表和 user_profiles 表之间的关联，Eloquent 模型类底层提供了相应的 API 方法帮助我们建立模型之间的关联。首先，我们在 User 模型类中通过 hasOne 方法定义其与 UserProfile 的一对一关联：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">profile</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasOne(UserProfile::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们通过数据库填充技术在 user_profiles 插入一些数据，这样就可以在 User 模型实例上通过关联方法名作为动态属性访问与其对应的 UserProfile 模型实例了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span> = User::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$profile</span> = <span class="variable">$user</span>-&gt;profile;</span><br></pre></td></tr></table></figure><p>打印 $profile 结果如下：</p><p><img src="https://upload.anitoys.com/hellocode/20210324234925.jpg" alt="img"></p><h2 id="Eloquent-底层约定"><a href="#Eloquent-底层约定" class="headerlink" title="Eloquent 底层约定"></a>Eloquent 底层约定</h2><p>需要指出的是，在关联关系的建立过程中，Eloquent 也遵循了「约定大于配置」的原则。你可能注意到了我们在定义关联关系时，仅仅指定了模型类名，并没有指定通过哪些数据表字段建立关联，这并不是说 Laravel 神通广大，能知过去未来之事，而是因为 Eloquent 对此做了默认的约定。hasOne 方法的完整签名是：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasOne</span>(<span class="params"><span class="variable">$related</span>, <span class="variable">$foreignKey</span> = <span class="literal">null</span>, <span class="variable">$localKey</span> = <span class="literal">null</span></span>)</span></span><br></pre></td></tr></table></figure><p>其中，第一个参数是关联模型的类名，第二个参数是关联模型类所属表的外键，这里对应的是 user_profiles 表的 user_id 字段，第三个参数是关联表的外键关联到当前模型所属表的哪个字段，这里对应的是 users 表的 id 字段。为什么我们不需要指定 Laravel 就能完成这种关联呢，这是因为如果没有指定 $foreignKey，Eloquent 底层会通过如下方法去拼接：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getForeignKey</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Str::snake(class_basename(<span class="keyword">$this</span>)).<span class="string">&#x27;_&#x27;</span>.<span class="keyword">$this</span>-&gt;getKeyName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你可以看到，在本例中，拼接的结果正好是 user_id。</p><p>同样，没有指定 $localKey 的话，Eloquent 底层会返回主键 ID：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getKeyName</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;primaryKey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在本例中，就是 id 了。</p><p>遵循这种默认的约定，可以帮我们少写很多代码，减少很多额外的配置，所以如果不是迫不得已（比如从其他系统迁移过来），建议你在使用 Eloquent 的话，尽量遵循这些默认约定。如果数据表没有遵循这种约定的话，只能手动传参了。</p><h2 id="建立相对的关联关系"><a href="#建立相对的关联关系" class="headerlink" title="建立相对的关联关系"></a>建立相对的关联关系</h2><p>通常我们都是通过 User 模型获取 UserProfile 模型，但是有时候我们可能需要反过来通过 UserProfile 反查所属的 User 模型，Eloquent 底层也为我们提供了相应的 belongsTo 方法来建立相对的一对一关联关系，我们在 UserProfile 模型类定义其与 User 模型的关联如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(User::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同样，采用关联关系方法名作为动态属性即可访问该模型所属 User 模型实例：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$profile</span> = UserProfile::findOrFail(<span class="number">2</span>);</span><br><span class="line"><span class="variable">$user</span> = <span class="variable">$profile</span>-&gt;user;</span><br></pre></td></tr></table></figure><p>打印 $user 用户信息如下：</p><p><img src="https://upload.anitoys.com/hellocode/20210324234940.jpg" alt="img"><br>同样，和 hasOne 方法一样，belongsTo 方法也是遵循了默认的约定规则，其完整方法签名如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">belongsTo</span>(<span class="params"><span class="variable">$related</span>, <span class="variable">$foreignKey</span> = <span class="literal">null</span>, <span class="variable">$ownerKey</span> = <span class="literal">null</span>, <span class="variable">$relation</span> = <span class="literal">null</span></span>)</span></span><br></pre></td></tr></table></figure><p>其中第一个参数是关联模型的类名。</p><p>第二个参数是当前模型类所属表的外键，在本例中是 user_profiles 表的 user_id 字段，拼接规则和 hasOne 那里类似，只不过这里是基于第四个参数关联关系名称 $relation：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (is_null(<span class="variable">$relation</span>)) &#123;</span><br><span class="line">    <span class="variable">$relation</span> = <span class="keyword">$this</span>-&gt;guessBelongsToRelation();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (is_null(<span class="variable">$foreignKey</span>)) &#123;</span><br><span class="line">    <span class="variable">$foreignKey</span> = Str::snake(<span class="variable">$relation</span>).<span class="string">&#x27;_&#x27;</span>.<span class="variable">$instance</span>-&gt;getKeyName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>$relation 默认约定是对应关联关系方法名，这里的是 user。如果你这里定义的方法名不是 user，则需要手动指定外键参数。</p><p>第三个参数是关联模型类所属表的主键：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$instance</span> = <span class="keyword">$this</span>-&gt;newRelatedInstance(<span class="variable">$related</span>);</span><br><span class="line">...</span><br><span class="line"><span class="variable">$ownerKey</span> = <span class="variable">$ownerKey</span> ?: <span class="variable">$instance</span>-&gt;getKeyName();</span><br></pre></td></tr></table></figure><p>第四个参数前面已经说过，默认约定就是关联关系方法名，也是关联关系动态属性名。</p><p>还是很之前一样，建议遵循这些默认约定，可以少写很多代码，避免配置出错导致程序bug。如果实在满足不了这些默认的约定，只能指定按照上述约定指定传入自己的参数了。</p><p>一对一关联很简单，但是我们还是花了很长的篇幅来讨论，因为后面其它关联的实现思路、访问方式、底层约定都是类似的，掌握了一对一关联，就能更好的理解和掌握其它关联关系的创建和使用。</p><h1 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h1><h2 id="建立关联关系-1"><a href="#建立关联关系-1" class="headerlink" title="建立关联关系"></a>建立关联关系</h2><p>一对多关联是我们日常开发中经常碰到的一种关联关系。以博客系统为例，一个用户可以发布多篇文章，反过来，一篇只能归属于一个用户，那么用户和文章之间就是一对多的关系，同样，用户可以发布多条评论，一条评论只能归属于一个用户，用户与评论之间也是一对多关系。</p><p>要定义用户文章之间的一对多关联，可以在 User 模型类中通过 Eloquent 底层提供的 hasMany 方法来实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(Post::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于我们之间已经创建过 users 表和 posts 表，并且初始化过数据，所以我们可以直接通过动态属性的方式来调用用户模型上的文章：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span> = User::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$posts</span> = <span class="variable">$user</span>-&gt;posts;</span><br></pre></td></tr></table></figure><p>与 hasOne 返回的是单个模型实例不一样，hasMany 返回的是模型类集合：</p><p><img src="https://upload.anitoys.com/hellocode/20210324234958.jpg" alt="img"></p><h2 id="Eloquent-底层约定-1"><a href="#Eloquent-底层约定-1" class="headerlink" title="Eloquent 底层约定"></a>Eloquent 底层约定</h2><p>和 hasOne 方法一样，hasMany 方法底层也对如何建立关联关系做了约定，而且 hasMany 方法和 hasOne 方法的签名一样：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasMany</span>(<span class="params"><span class="variable">$related</span>, <span class="variable">$foreignKey</span> = <span class="literal">null</span>, <span class="variable">$localKey</span> = <span class="literal">null</span></span>)</span></span><br></pre></td></tr></table></figure><p>$foreignKey 和 $localKey 默认获取逻辑也和 hasOne 完全一样，这里不再赘述。其实你完全可以把一对一关联看作一对多关联的简化版本，只不过一对一退化为只返回一条记录，所以实现逻辑一样也不难理解了。</p><p>如果你的数据表结构不符合这种默认约定，可以自定义传入对应字段参数值。</p><h2 id="建立相对的关联关系-1"><a href="#建立相对的关联关系-1" class="headerlink" title="建立相对的关联关系"></a>建立相对的关联关系</h2><p>与一对一一样，我们可以在文章模型中建立于用户模型之间的相对关联关系，而且这种使用场景很普遍，比如在文章详细页或列表页显示文章作者信息。还是通过 Eloquent 提供的 belongsTo 方法来实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(User::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，我们就可以在文章模型实例上通过动态属性 user 来访问对应的用户信息：</p><p>$post = Post::findOrFail(29);<br>$author = $post-&gt;user;<br>belongsTo 方法的底层约定我们在前面一对一关联中已经讨论过。这里，如果你想要让代码可读性更好，可以将 Post 模型中的关联关系调方法名修改为 author，这样，我们就需要手动指定更多的 belongsTo 方法传入参数了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">author</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(User::class, <span class="string">&#x27;user_id&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;author&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>相应的访问方式也需要做调整：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$author</span> = <span class="variable">$post</span>-&gt;author;</span><br></pre></td></tr></table></figure><p>返回结果完全一样。</p><h2 id="渴求式加载"><a href="#渴求式加载" class="headerlink" title="渴求式加载"></a>渴求式加载</h2><p>前面我们演示的关联关系查询都是通过动态属性的方式，这种加载方式叫做「懒惰式加载」，因为都是用到的时候才回去查询，这就意味着要多次对数据库的进行查询才能返回需要的结果。如果是单条记录获取关联关系，就需要两次查询；如果是多条记录获取关联关系，比如文章列表页获取作者信息，因为每篇文章的作者通过动态属性获取都有一次查询，所以对N条记录来说，需要「N+1」次查询才能返回需要的结果，从数据库查询优化的角度来说，显然是不合理的。能不能一次就返回所有的关联查询结果呢？</p><p>可以，Eloquent 为我们提供了 with 方法，我们将需要查询的关联关系动态属性（关联方法名）传入该方法，并将其链接到 Eloquent 模型原有的查询中，就可以一次完成关联查询，加上模型自身查询，总共查询两次。我们将这种加载方式叫做「渴求式加载」，即根据所需预先查询所有数据。</p><p>以文章列表为例，我们可以通过这种方式获取文章及对应作者信息：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$posts</span> = Post::with(<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">    -&gt;where(<span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">    -&gt;offset(<span class="number">1</span>)-&gt;limit(<span class="number">10</span>)</span><br><span class="line">    -&gt;get();</span><br></pre></td></tr></table></figure><p>对应的底层 SQL 执行语句是：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `posts` <span class="keyword">where</span> `views` <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">and</span> `posts`.`deleted_at` <span class="keyword">is</span> <span class="keyword">null</span> limit <span class="number">10</span> <span class="keyword">offset</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `users` <span class="keyword">where</span> `users`.`id` <span class="keyword">in</span> (?, ?, ?, ?, ?, ?) <span class="keyword">and</span> `email_verified_at` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure><p>这样，就可以在返回的列表中看到关联的作者信息了，在遍历的时候可以通过 $post-&gt;author 获取，而无需每次加载，从而提高数据库查询性能：</p><p><img src="https://upload.anitoys.com/hellocode/20210324235009.jpg" alt="img"></p><h1 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h1><h2 id="建立关联关系-2"><a href="#建立关联关系-2" class="headerlink" title="建立关联关系"></a>建立关联关系</h2><p>多对多关联也很常见，还是以博客系统为例，我们会为每篇文章设置标签，一篇文章往往有多个标签，反过来，一个标签可能会归属于多篇文章，这时，我们说文章和标签之间是多对多的关联关系。</p><p>多对多关联比一对一和一对多关联复杂一些，需要借助一张中间表才能建立关联关系。以文章标签为例，文章表已经存在了，还需要创建一张 tags 表和中间表 post_tags。首先创建 Tags 模型类及其对应数据表 tags 迁移文件：</p><p>php artisan make:model Tag -m<br>编写 create_tags_table 迁移文件对应类的 up 方法如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Schema::create(<span class="string">&#x27;tags&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;name&#x27;</span>, <span class="number">100</span>)-&gt;unique()-&gt;comment(<span class="string">&#x27;标签名&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后创建 post_tags 数据表迁移文件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:migration create_post_tags_table --create=post_tags</span><br></pre></td></tr></table></figure><p>编写其对应迁移类的 up 方法如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Schema::create(<span class="string">&#x27;post_tags&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;integer(<span class="string">&#x27;post_id&#x27;</span>)-&gt;unsigned()-&gt;default(<span class="number">0</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;integer(<span class="string">&#x27;tag_id&#x27;</span>)-&gt;unsigned()-&gt;default(<span class="number">0</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;unique([<span class="string">&#x27;post_id&#x27;</span>, <span class="string">&#x27;tag_id&#x27;</span>]);</span><br><span class="line">        <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行 php artisan migrate 让迁移生效。</p><p>接下来，我们在 Post 模型类中定义其与 Tags 模型类的关联关系，通过 Eloquent 提供的 belongsToMany 方法来实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Tag::class, <span class="string">&#x27;post_tags&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过数据库填充器填充一些数据到 tags 表和 post_tags 表，这样我们就可以通过关联查询查询指定 Post 模型上的标签信息了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$tags</span> = <span class="variable">$post</span>-&gt;tags;</span><br></pre></td></tr></table></figure><p>返回的是个模型集合：</p><p><img src="https://upload.anitoys.com/hellocode/20210324235018.jpg" alt="img"><br>当然，你也可以通过前面提到的渴求式加载方式获取标签数据：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::with(<span class="string">&#x27;tags&#x27;</span>)-&gt;find(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$tags</span> = <span class="variable">$post</span>-&gt;tags;</span><br></pre></td></tr></table></figure><p>返回结果和上面一样，但减少了对数据库的查询次数。</p><h2 id="Eloquent-底层约定-2"><a href="#Eloquent-底层约定-2" class="headerlink" title="Eloquent 底层约定"></a>Eloquent 底层约定</h2><p>可以看到我们在定义多对多关联的时候，也没有指定通过哪些字段进行关联，这同样是遵循 Eloquent 底层默认约定的功劳，belongsToMany 方法签名如下：</p><p>public function belongsToMany($related, $table = null, $foreignPivotKey = null, $relatedPivotKey = null, $parentKey = null, $relatedKey = null, $relation = null)<br>除了第一个参数之外，其它参数都可以为空。第一个参数是关联模型的类名，这里是 Tag。</p><p>第二个参数 $table 是建立多对多关联的中间表名，该表名默认拼接规则如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$segments</span> = [</span><br><span class="line">    <span class="variable">$instance</span> ? <span class="variable">$instance</span>-&gt;joiningTableSegment()</span><br><span class="line">                  : Str::snake(class_basename(<span class="variable">$related</span>)),</span><br><span class="line">    <span class="keyword">$this</span>-&gt;joiningTableSegment(),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">sort(<span class="variable">$segments</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> strtolower(implode(<span class="string">&#x27;_&#x27;</span>, <span class="variable">$segments</span>));</span><br></pre></td></tr></table></figure><p>其中 $this-&gt;joiningTableSegment() 将当前模型类名转化为小写字母+下划线格式（注意不是复数格式，所以并不是对应默认表名），$instance 对应关联模型类实例，如果为空的话返回Str::snake(class_basename($related))，也会将关联类名转化为小写字母+下划线格式（也不是表名），然后对转化后的字符片段按字母表排序。所以本例中如果不指定中间表名，按照默认约定该值是 post_tag。但是为了遵循 Laravel 数据表名都是复数，所以我这里自定义了一回。</p><p>第三个参数是 $foreignPivotKey 指的是中间表中当前模型类的外键，默认拼接规则和前面一对一、一对多一样，所以在本例中是 posts 表的 post_id 字段。我在建表的时候遵循了这个约定，所以不需要额外指定。</p><p>第四个参数 $relatedPivotKey 是中间表中当前关联模型类的外键，拼接规则和 $foreignPivotKey 一样，只不过作用于关联模型类，所以在本例中是 tags 表的 tag_id 字段。同样，我在建表的时候也遵循了这一约定，不需要额外指定。</p><p>第五个参数 $parentKey 表示对应当前模型的哪个字段（即 $foreignPivotKey 映射到当前模型所属表的哪个字段），默认是主键 ID，即 posts 表的 id 字段，所以这里不需要额外指定。</p><p>第六个参数 $relatedKey 表示对应关联模型的哪个字段（即 $relatedPivotKey 映射到关联模型所属表的哪个字段），默认是关联模型的主键 ID，即 tags 表的 id 字段，所以这里也不需要额外指定。</p><p>最后一个参数 $relation 表示关联关系名称，用于设置查询结果中的关联属性，默认是关联方法名。</p><p>如果你没有遵循上述约定，需要手动指定自己的参数字段，不过还是建议遵循这些默认的约定，不然写着写着容易把自己绕晕。</p><h2 id="建立相对的关联关系-2"><a href="#建立相对的关联关系-2" class="headerlink" title="建立相对的关联关系"></a>建立相对的关联关系</h2><p>与之前的关联关系一样，多对多关联也支持建立相对的关联关系，而且由于多对多的双方是平等的，不存在谁归属谁的问题，所以建立相对关联的方法都是一样的，我们可以在 Tag 模型中通过 belongsToMany 方法建立其与 Post 模型的关联关系：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Post::class, <span class="string">&#x27;post_tags&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>比如博客的标签页，通过指定标签查看归属该标签下的所有文章，就可以用到类似的关联查询，相应的实现代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tag</span> = Tag::with(<span class="string">&#x27;posts&#x27;</span>)-&gt;where(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;ab&#x27;</span>)-&gt;first();</span><br><span class="line"><span class="variable">$posts</span> = <span class="variable">$tag</span>-&gt;posts;</span><br></pre></td></tr></table></figure><p>对应的查询结果如下：<br><img src="https://upload.anitoys.com/hellocode/20210324235027.jpg" alt="img"></p><h2 id="获取中间表字段"><a href="#获取中间表字段" class="headerlink" title="获取中间表字段"></a>获取中间表字段</h2><p>Eloquent 还提供了方法允许你获取中间表的字段，你仔细看查询结果字段，会发现 relations 字段中有一个 pivot 属性，中间表字段就存放在这个属性对象上：<br><img src="https://upload.anitoys.com/hellocode/20210324235039.jpg" alt="img"><br>我们在遍历返回结果的时候可以在循环中通过 $post-&gt;pivot-&gt;tag_id 获取中间表字段值。不过中间表默认只返回关联模型的主键字段，如果要返回额外字段，需要在定义关联关系的时候手动指定，比如如果想要返回时间戳信息，可以这么定义：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Tag::class, <span class="string">&#x27;post_tags&#x27;</span>)-&gt;withTimestamps();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就可以返回文章标签创建时间和更新时间了：<br><img src="https://upload.anitoys.com/hellocode/20210324235050.jpg" alt="img"><br>如果除此之外，你还在中间表中定义了额外的字段信息，比如 user_id，可以通过 with 方法传入字段然后将其返回：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Tag::class, <span class="string">&#x27;post_tags&#x27;</span>)-&gt;withPivot(<span class="string">&#x27;user_id&#x27;</span>)-&gt;withTimestamps();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自定义中间表模型类"><a href="#自定义中间表模型类" class="headerlink" title="自定义中间表模型类"></a>自定义中间表模型类</h2><p>你还可以通过自定义中间表对应模型类实现更多自定义操作，中间表模型类继承自 Illuminate\Database\Eloquent\Relations\Pivot，Pivot 也是 Eloquent Model 类的子类，只不过为中间表操作定义了很多方法和属性，比如我们创建一个自定义的中间表模型类 PostTag：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Relations</span>\<span class="title">Pivot</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostTag</span> <span class="keyword">extends</span> <span class="title">Pivot</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$table</span> = <span class="string">&#x27;post_tags&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，我们在定义多对多关联关系的时候指定自定义的模型类了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Tag::class, <span class="string">&#x27;post_tags&#x27;</span>)-&gt;using(PostTag::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="更多中间表操作"><a href="#更多中间表操作" class="headerlink" title="更多中间表操作"></a>更多中间表操作</h2><p>此外，如果你觉得 pivot 可读性不好，你还可以自定义中间表实例属性名称：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;belongsToMany(Tag::class, <span class="string">&#x27;post_tags&#x27;</span>)-&gt;as(<span class="string">&#x27;taggable&#x27;</span>)-&gt;withTimestamps();</span><br></pre></td></tr></table></figure><p>这样，就可以通过 $tag-&gt;taggable-&gt;created_at 访问中间表字段值了。</p><p>还可以通过中间表字段值过滤关联数据（支持 where 和 in 查询）：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Tag::class, <span class="string">&#x27;post_tags&#x27;</span>)-&gt;wherePivot(<span class="string">&#x27;user_id&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Tag::class, <span class="string">&#x27;post_tags&#x27;</span>)-&gt;wherePivotIn(<span class="string">&#x27;user_id&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>]);</span><br></pre></td></tr></table></figure><h1 id="远层一对多关联"><a href="#远层一对多关联" class="headerlink" title="远层一对多关联"></a>远层一对多关联</h1><h2 id="什么是远层一对多关联"><a href="#什么是远层一对多关联" class="headerlink" title="什么是远层一对多关联"></a>什么是远层一对多关联</h2><p>我们在上一篇教程中学习了一对多关联，远层一对多在一对多关联的基础上加上了一个修饰词「远层」，意味着这个一对多关系不是直接关联，而是「远层」关联，远层怎么关联呢？借助中间表。前面我们讨论的多对多关联也是借助中间表，但是远层一对多与其区别在于还是一对多的关联。所以理解一对多和多对多关联是理解今天介绍的几种关联关系的基础。</p><p>光说概念你可能还是懵，下面我们举个例子来说明。如果我们的博客系统是针对全球市场的话，可能针对不同的国家推出不同的用户系统和功能，然后中国用户过来就只展示中国用户发布的文章，日本用户过来就只展示日本用户发布的文章，这里面涉及到三张表，存储国家的 countries 表，存储用户的 users 表，以及存储文章的 posts 表。用户与文章是一对多的关联关系，这一点我们上篇教程已经说过，国家与用户之间是一对多的关联（一个用户只能有一个国籍），那么通过用户这张中间表，国家和文章之间也建立起来一对多的关联，只是这个关联不是直接的关联，而是「远层」的关联。针对这样的情况，我们说国家和文章之间是远层的一对多关联。</p><h2 id="建立远层一对多关联关系"><a href="#建立远层一对多关联关系" class="headerlink" title="建立远层一对多关联关系"></a>建立远层一对多关联关系</h2><p>了解这个关联的概念之后，我们要查询某个国家下的文章，要怎么做呢？或者说我们要怎么在模型类之间建立远层的一对多关联呢？</p><p>开始之前，我们要先创建 Country 模型类及其对应数据库迁移：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:model Country -m </span><br></pre></td></tr></table></figure><p>编写新生成的数据库迁移文件对应迁移类的 up 方法如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Schema::create(<span class="string">&#x27;countries&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;name&#x27;</span>, <span class="number">100</span>)-&gt;unique();</span><br><span class="line">        <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;slug&#x27;</span>, <span class="number">100</span>)-&gt;unique();</span><br><span class="line">        <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，编写迁移文件为 users 表新增一个 country_id 字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:migration alter_users_add_country_id --table=users</span><br></pre></td></tr></table></figure><p>编写新生成的迁移类文件如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Schema</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Schema</span>\<span class="title">Blueprint</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Migrations</span>\<span class="title">Migration</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlterUsersAddCountryId</span> <span class="keyword">extends</span> <span class="title">Migration</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Run the migrations.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Schema::table(<span class="string">&#x27;users&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$table</span>-&gt;integer(<span class="string">&#x27;country_id&#x27;</span>)-&gt;unsigned()-&gt;default(<span class="number">0</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;index(<span class="string">&#x27;country_id&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Reverse the migrations.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">down</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Schema::table(<span class="string">&#x27;users&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$table</span>-&gt;dropColumn(<span class="string">&#x27;country_id&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来，运行 php artisan migrate 让迁移生效。在 countries 表和 users 表填充一些测试数据便于后续测试。</p><p>准备好数据库、模型类并填充测试数据后，接下来，我们在 Country 模型类中通过 Eloquent 提供的 hasManyThrough 方法定义其与 Post 模型类之间的远层一对多关联：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasManyThrough(Post::class, User::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，第一个参数是关联的模型类，第二个参数是中间借助的模型类。</p><p>这样，我们就可以在代码中通过 Country 模型实例获取归属于该国家的所有文章了，查询方式和前面其它关联查询一样，可以懒惰式加载，也可以渴求式加载：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$country</span> = Country::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$posts</span> = <span class="variable">$country</span>-&gt;posts;</span><br></pre></td></tr></table></figure><p>返回结果也是模型集合：<br><img src="https://upload.anitoys.com/hellocode/20210324235103.jpg" alt="img"></p><h2 id="Eloquent-底层约定-3"><a href="#Eloquent-底层约定-3" class="headerlink" title="Eloquent 底层约定"></a>Eloquent 底层约定</h2><p>同样，我们在通过 hasManyThrough 方法定义远层一对多关联关系的时候，并没有指定关联字段，因为我们在定义数据库字段、模型类的时候都遵循了 Eloquent 底层的约定。</p><p>我们来看一下 hasManyThrough 方法的完整签名：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasManyThrough</span>(<span class="params"><span class="variable">$related</span>, <span class="variable">$through</span>, <span class="variable">$firstKey</span> = <span class="literal">null</span>, <span class="variable">$secondKey</span> = <span class="literal">null</span>, <span class="variable">$localKey</span> = <span class="literal">null</span>, <span class="variable">$secondLocalKey</span> = <span class="literal">null</span></span>)</span></span><br></pre></td></tr></table></figure><p>其中，第一个参数和第二个参数分别是关联模型类和中间模型类。</p><p>第三个参数 $firstKey 表示中间模型类与当前模型类的关联外键，按照默认约定，在本例中拼接出来的字段是 country_id，正好和我们在中间表 users 中新增的 country_id 吻合，所以不需要额外指定。</p><p>第四个参数 $secondKey 指的是中间模型类与关联模型类的关联外键，按照默认约定，在本例中拼接出来的字段是 user_id，正好和我们在关联表 posts 中定义的 user_id 吻合，所以也不需要额外指定。</p><p>第五个参数 $localKey 默认是当前模型类的主键 ID，第六个参数是中间模型类的主键 ID。</p><p>如果你的字段定义与 Eloquent 底层默认约定拼接出来的字段不一致，需要手动指定对应参数。</p><h1 id="一对一的多态关联"><a href="#一对一的多态关联" class="headerlink" title="一对一的多态关联"></a>一对一的多态关联</h1><h2 id="什么是一对一的多态关联"><a href="#什么是一对一的多态关联" class="headerlink" title="什么是一对一的多态关联"></a>什么是一对一的多态关联</h2><p>接下来讲的三个关联关系都归属于多态关联，多态关联允许目标模型通过单个关联归属于多种类型的模型，根据模型之间的关联关系类型，又可以将多态关联细分为一对一、一对多和多对多三种关联。首先我们来看最简单的一对一多态关联。</p><p>一对一多态关联和上一篇的一对一关联有点类似，只不过这里的一对一关联是「多态」的，说理论太抽象，我们还是举例来说明。假设在我们的博客系统中用户可以设置头像，文章也可以设置缩略图，我们知道每个用户只能有一个头像，一篇文章也只能有一个缩略图，所以此时用户和图片之间是一对一关联，文章和图片之间也是一对一关联，通过多态关联，我们可以让用户和文章共享与图片的一对一关联，我们只需要在图片模型类通过一次定义，就可以动态建立与用户和文章的关联。</p><p>要建立这种多态管理，需要图片表结构支持与对应用户和文章的关联，只是，在这里，我们需要两个字段才能建立这种关联，一个是类型字段，表示归属于用户还是文章，另一个是ID字段，指向对应的用户/文章ID，这样，我们就可以结合这两个字段唯一确定该图片归属于哪个用户/哪篇文章了。</p><h2 id="如何建立一对一的多态关联"><a href="#如何建立一对一的多态关联" class="headerlink" title="如何建立一对一的多态关联"></a>如何建立一对一的多态关联</h2><p>开始之前我们要创建图片模型类 Image 及其对应数据库迁移文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:model Image -m</span><br></pre></td></tr></table></figure><p>然后编写新创建的 create_images_table 迁移文件对应迁移类的 up 方法如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Schema::create(<span class="string">&#x27;images&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;url&#x27;</span>)-&gt;comment(<span class="string">&#x27;图片URL&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;morphs(<span class="string">&#x27;imageable&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中 $table-&gt;morphs(‘imageable’) 用于创建 imageable_id 和 imageable_type 两个字段，其中 imageable_type 用于存放 User 模型类或 Post 模型类，而 imageable_id 用于存放对应的模型实例 ID，从而方便遵循默认约定建立多态关联。</p><p>运行 php artisan migrate 让迁移生效，准备好数据表和模型类后，接下来我们在模型类中建立一对一的多态关联。首先在 Image 模型类中通过 morphTo 建立其与 User/Post 模型类之间的关联：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">imageable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphTo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们不需要指定任何字段，因为我们在创建数据表和定义关联方法的时候都遵循了 Eloquent 底层的约定，还是来看下 morphTo 方法的完整签名：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">morphTo</span>(<span class="params"><span class="variable">$name</span> = <span class="literal">null</span>, <span class="variable">$type</span> = <span class="literal">null</span>, <span class="variable">$id</span> = <span class="literal">null</span>, <span class="variable">$ownerKey</span> = <span class="literal">null</span></span>)</span></span><br></pre></td></tr></table></figure><p>第一个参数 $name 是关联关系名称，默认就是关联方法名，在本例中是 imageable。</p><p>第二个参数 $type、第三个参数 $id 结合第一个参数 $name 用于构建关联字段，在本例中就是 imageable_type 和 imageable_id。由于我们的数据库字段和关联方法名都遵循了默认约定，所以不需要额外指定。如果你的数据库字段名是自定义的，比如 item_id 和 item_type，那么就需要指定第一个参数值为 item。</p><p>最后一个参数是当前模型类的主键 ID。</p><p>这样，我们就可以在 images 表中填充一些测试数据进行测试了，你可以借助填充器来填充，或者手动插入，需要注意的是在 imageable_type 字段中需要插入完整的类名作为类型，比如 App\User 或者 App\Post，以便 Eloquent 在插询的时候结合 imageable_id 字段利用反射构造对应的模型实例：<br><img src="https://upload.anitoys.com/hellocode/20210324235351.jpg" alt="img"><br>这样，我们就可以在 Image 实例上获取其归属的模型实例了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$image</span> = Image::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$item</span> = <span class="variable">$image</span>-&gt;imageable;</span><br></pre></td></tr></table></figure><p>返回结果是对应的模型类实例，我们打印 $item 对象，现实如下：<br><img src="https://upload.anitoys.com/hellocode/20210324235115.jpg" alt="img"></p><h2 id="定义相对的关联关系"><a href="#定义相对的关联关系" class="headerlink" title="定义相对的关联关系"></a>定义相对的关联关系</h2><p>当然，我们在日常开发中，更常见的是获取某个用户的头像或者某篇文章的缩略图，这样，我们就需要在 User 模型中定义其与 Image 模型的关联：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">image</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphOne(Image::class, <span class="string">&#x27;imageable&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在 Post 模型中定义其与 Image 模型的关联：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">image</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphOne(Image::class, <span class="string">&#x27;imageable&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同样，因为我们遵循了 Eloquent 底册的约定，只需要传入最少的参数即可建立关联。morphOne 方法的完整签名如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">morphOne</span>(<span class="params"><span class="variable">$related</span>, <span class="variable">$name</span>, <span class="variable">$type</span> = <span class="literal">null</span>, <span class="variable">$id</span> = <span class="literal">null</span>, <span class="variable">$localKey</span> = <span class="literal">null</span></span>)</span></span><br></pre></td></tr></table></figure><p>第一个参数表示关联的模型类。</p><p>第二个参数 $name、第三个参数 $type、第四个参数 $id 和前面的 morphTo 方法的前三个参数一样，用于在关联表中拼接关联外键，在本例中就是 imageable_type 和 imageable_id，所以第三个和第四个参数不需要额外指定，当然如果你是用的是 item_id 和 item_type 字段需要将第二个参数设置为 item，如果结尾不是以 type 和 id 作为后缀，也需要通过 $type 和 $id 参数传入。</p><p>最后一个参数 $localKey 表示当前模型类的主键 ID。</p><p>在模型类中定义完关联方法后，就可以在代码中通过相应方法获取关联模型了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$image</span> = <span class="variable">$post</span>-&gt;image;</span><br></pre></td></tr></table></figure><p>返回结果是 Image 模型实例：<br><img src="https://upload.anitoys.com/hellocode/20210324235128.jpg" alt="img"><br>底层对应的查询 SQL 语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  `images`</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  `images`.`imageable_id` <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">and</span> `images`.`imageable_id` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  <span class="keyword">and</span> `images`.`imageable_type` <span class="operator">=</span> &quot;App\Post&quot;</span><br><span class="line">limit</span><br><span class="line">  <span class="number">1</span></span><br></pre></td></tr></table></figure><h1 id="一对多的多态关联"><a href="#一对多的多态关联" class="headerlink" title="一对多的多态关联"></a>一对多的多态关联</h1><h2 id="什么是一对多的多态关联"><a href="#什么是一对多的多态关联" class="headerlink" title="什么是一对多的多态关联"></a>什么是一对多的多态关联</h2><p>理解了一对一的多态关联之后，一对多的多态关联理解起来就简单多了，其实就是模型类与关联类之间的关联变成一对多了，只不过这个一对多是多态的，如何理解这个多态，其实就是在关联表引入了类型的概念，关联表中的数据不再是与某一张表有关联，而是与多张表有关联，具体是哪张表通过关联类型来确定，具体与哪条记录关联，通过关联ID来确定。能理解到这个层面基本上就可以通吃多态关联了。这种逻辑和面向对象中的多态很像（面向对象三大特性：继承、封装、多态），所以将其称作「多态关联」。</p><p>下面我们还是以一个具体的例子来解释下一对多多态关联。</p><p>博客系统中免不了评论系统，以 Larave 学院为例，它支持两种类型的内容发布，一种是普通的文章，一种是独立的页面，分别存在两张表里。用户可以评论普通文章，也可以评论页面，我们不可能去为不同类型的内容分别创建评论表，因为它们的结构是完全一样的。我们知道如果单独看文章和评论，它们是一对多的关系，现在我们的评论表还要支持页面评论的存储，因此，需要引入一个类型字段做区分，这样，文章/页面与评论之间的关联关系就变成一对多的多态关联了。是不是这么看起来，也就那么回事了？</p><p>接下来，我们就来实际演示如何在模型类中建立一对多的多态关联。</p><h2 id="在模型类中构建一对多多态关联"><a href="#在模型类中构建一对多多态关联" class="headerlink" title="在模型类中构建一对多多态关联"></a>在模型类中构建一对多多态关联</h2><p>首先还是要创建对应数据表和模型，我们先创建评论模型类 Comment 及其数据库迁移文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:model Comment -m</span><br></pre></td></tr></table></figure><p>编写新生成的 create_comments_table 迁移文件对应迁移类的 up 方法如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Schema::create(<span class="string">&#x27;comments&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;text(<span class="string">&#x27;content&#x27;</span>)-&gt;comment(<span class="string">&#x27;评论内容&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;integer(<span class="string">&#x27;user_id&#x27;</span>)-&gt;unsigned()-&gt;default(<span class="number">0</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;morphs(<span class="string">&#x27;commentable&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;index(<span class="string">&#x27;user_id&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;softDeletes();</span><br><span class="line">        <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后创建一个 Page 模型类及其对应数据库迁移文件用于存放页面内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:model Page -m</span><br></pre></td></tr></table></figure><p>编写新生成的 create_pages_table 迁移文件对应迁移类的 up 方法如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Schema::create(<span class="string">&#x27;pages&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;slug&#x27;</span>)-&gt;unique();</span><br><span class="line">        <span class="variable">$table</span>-&gt;text(<span class="string">&#x27;content&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;integer(<span class="string">&#x27;user_id&#x27;</span>)-&gt;unsigned()-&gt;default(<span class="number">0</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;index(<span class="string">&#x27;user_id&#x27;</span>);</span><br><span class="line">        <span class="variable">$table</span>-&gt;softDeletes();</span><br><span class="line">        <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行 php artisan migrate 让迁移生效。</p><p>准备好数据库之后，我们通过填充器填充一些数据到刚创建的两张数据表。然后在 Comment 模型类中通过 Eloquent 提供的 morphTo 方法定义其与 Post 模型和 Page 之间的一对多多态关联：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">commentable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphTo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为一个评论只会对应一篇文章/页面，所以，通过和一对一的多态关联同样的 morphTo 方法定义其与文章和页面的关联关系即可。和前面的一对一多态关联一样，因为我们的数据表字段和关联方法名都遵循了 Eloquent 底层的默认约定，所以不需要指定任何额外参数，即可完成关联关系的构建。这些默认约定我们在上面一对一多态关联中已经详细列出，这里就不再赘述了。</p><p>这样，我们就可以通过 Comment 实例查询其归属的文章或页面了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$comment</span> = Comment::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$item</span> = <span class="variable">$comment</span>-&gt;commentable;</span><br></pre></td></tr></table></figure><p>返回的结果是对应的模型实例：<br><img src="https://upload.anitoys.com/hellocode/20210324235136.jpg" alt="img"></p><h2 id="定义相对的关联关系-1"><a href="#定义相对的关联关系-1" class="headerlink" title="定义相对的关联关系"></a>定义相对的关联关系</h2><p>同样，我们在日常开发中，更多的是通过文章或页面实例获取对应的评论信息，比如在文章页或页面页获取该文章或页面的所有评论。为此，我们需要在 Post 模型类和 Page 模型类中定义其与 Comment 模型的关联关系，这需要通过 morphMany 方法来实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">comments</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphMany(Comment::class, <span class="string">&#x27;commentable&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>和 morphOne 方法一样，因为我们遵循了 Eloquent 底层的默认约定，所以只需要传递很少的必要参数就可以定义关联关系了，morphMany 方法的完整签名如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">morphMany</span>(<span class="params"><span class="variable">$related</span>, <span class="variable">$name</span>, <span class="variable">$type</span> = <span class="literal">null</span>, <span class="variable">$id</span> = <span class="literal">null</span>, <span class="variable">$localKey</span> = <span class="literal">null</span></span>)</span></span><br></pre></td></tr></table></figure><p>这些参数的含义和 morphOne 方法完全一样，这里就不再赘述了。如果想要在 Post 模型下获取对应的所有评论，可以这么做：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::with(<span class="string">&#x27;comments&#x27;</span>)-&gt;findOrFail(<span class="number">23</span>);</span><br><span class="line"><span class="variable">$comments</span> = <span class="variable">$post</span>-&gt;comments;</span><br></pre></td></tr></table></figure><p>返回的结果是 Comment 模型对象集合：<br><img src="https://upload.anitoys.com/hellocode/20210324235145.jpg" alt="img"><br>对应的关联查询底层 SQL 语句是：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  `comments`</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  `comments`.`commentable_id` <span class="keyword">in</span> (<span class="number">23</span>)</span><br><span class="line">  <span class="keyword">and</span> `comments`.`commentable_type` <span class="operator">=</span> &quot;App\Post&quot;</span><br><span class="line">  <span class="keyword">and</span> `comments`.`deleted_at` <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure><h1 id="多对多的多态关联"><a href="#多对多的多态关联" class="headerlink" title="多对多的多态关联"></a>多对多的多态关联</h1><h2 id="什么是多对多的多态关联"><a href="#什么是多对多的多态关联" class="headerlink" title="什么是多对多的多态关联"></a>什么是多对多的多态关联</h2><p>多对多的多态关联比前面的一对一和一对多更加复杂，但是有了前面讲解的基础，理解起来也很简单。你可以类比下常规的多对多关联，现在加入了「多态」的概念，常规的多对多需要借助中间表，多态的也是，只不过此时不仅仅是两张表之间的关联，而是也要引入类型字段。</p><p>还是以文章和标签的关联为例，在常规的多对多关联中，中间表只需要一个标签 ID 和文章 ID 即可建立它们之间的关联，但当我们添加新的内容类型，比如页面、视频、音频，它们也有标签，而且完全可以共享一张标签表，此时仅仅一个文章 ID 已经满足不了定义内容与标签之间的关联了，所以此时引入多对多的多态关联，和前面两种多态关联思路一样，只是在多对多关联中，我们需要在中间表中引入类型字段来标识内容类型，将原来的文章ID调整为内容ID，这样就可以从数据库层面满足不同内容类型与标签之间的关联了。</p><p>所以你可以看到从一对一、一对多（远层一对多）、多对多、一对一多态关联、一对多多态关联、多对多多态关联，它们之间是层层递进的，理解了前面的，后面的也就更好理解。</p><p>下面我们以标签与文章、页面关联关系为例，演示如何定义和使用多对多的多态关联。</p><h2 id="在模型类中定义多对多的多态关联"><a href="#在模型类中定义多对多的多态关联" class="headerlink" title="在模型类中定义多对多的多态关联"></a>在模型类中定义多对多的多态关联</h2><p>首先我们要废弃原来的 post_tags 数据表，创建一个新的 taggables 数据表来构建不同内容类型与标签之间的关联：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:migration create_taggables_table --create=taggables</span><br></pre></td></tr></table></figure><p>编写新生成的 create_taggables_table 迁移文件对应迁移类的 up 方法如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">&#x27;taggables&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;integer(<span class="string">&#x27;tag_id&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;morphs(<span class="string">&#x27;taggable&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;index(<span class="string">&#x27;tag_id&#x27;</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;unique([<span class="string">&#x27;tag_id&#x27;</span>, <span class="string">&#x27;taggable_id&#x27;</span>, <span class="string">&#x27;taggable_type&#x27;</span>]);</span><br><span class="line">    <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>运行 php artisan migrate 让迁移生效。然后通过填充器填充一些测试数据到新生成的 taggables 数据表。</p><p>接下来我们在 Tag 模型类中通过 Eloquent 提供的 morphedByMany 方法定义其与其他模型类的多对多多态关联：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphedByMany(Post::class, <span class="string">&#x27;taggable&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pages</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphedByMany(Page::class, <span class="string">&#x27;taggable&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>和之前一样，因为我们遵循了 Eloquent 底层的默认约定，所以我们只需传递必需参数，无需额外配置即可定义关联关系，我们来看下 morphedByMany 方法的完整签名：</p><p>public function morphedByMany($related, $name, $table = null, $foreignPivotKey = null, $relatedPivotKey = null, $parentKey = null, $relatedKey = null)<br>其中第一个参数 $related 表示关联的模型类。</p><p>第二个参数 $name 表示关联的名称，和定义中间表数据库迁移的时候 morphs 方法中指定的值一致，也就是 taggable。</p><p>第三个参数 $table 表示中间表名称，默认是第二个参数 $name 的复数格式，这里就是 taggables 了，因为我们在创建数据表的时候遵循了这一约定，所以不需要额外指定。</p><p>第四个参数 $foreignPivotKey 表示当前模型类在中间表中的外键，默认拼接结果是 tag_id，和我们在数据表中定义的一样，所以这里不需要额外指定。</p><p>第五个参数 $relatedPivotKey 表示默认是通过 $name 和 _id 组合而来，表示中间表中的关联ID字段，这里组合结果是 taggable_id，和我们定义的一致，也不需要额外指定。</p><p>第六个参数 $parentKey 默认表示当前模型类的主键 ID，即与中间表中 tag_id 关联的字段。</p><p>第七个参数 $relatedKey 表示关联模型类的主键 ID，这个因 $related 指定的模型而定。</p><p>如果你不是按照默认约定的规则定义的数据库字段，需要明确每一个参数的含义，然后传入对应的参数值，和之前一样，对新手来说，还是按照默认约定来比较好，免得出错。</p><p>定义好上述关联关系后，就可以查询指定标签模型上关联的文章/页面了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tag</span> = Tag::with(<span class="string">&#x27;posts&#x27;</span>, <span class="string">&#x27;pages&#x27;</span>)-&gt;findOrFail(<span class="number">53</span>);</span><br><span class="line"><span class="variable">$posts</span> = <span class="variable">$tag</span>-&gt;posts;</span><br><span class="line"><span class="variable">$pages</span> = <span class="variable">$tag</span>-&gt;pages;</span><br></pre></td></tr></table></figure><p>返回的结果都是对应的模型实例集合。</p><h2 id="定义相对的关联关系-2"><a href="#定义相对的关联关系-2" class="headerlink" title="定义相对的关联关系"></a>定义相对的关联关系</h2><p>最后，我们还可以在 Post 模型类或 Page 模型类中通过 Eloquent 提供的 morphToMany 方法定义该模型与 Tag 模型的关联关系（两个模型类中定义的方法完全一样）：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphToMany(Tag::class, <span class="string">&#x27;taggable&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为我们遵循和 Eloquent 底层默认的约定，所以指定很少的参数就可以定义多对多的多态关联，morphToMany 方法的完整签名如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">morphToMany</span>(<span class="params"><span class="variable">$related</span>, <span class="variable">$name</span>, <span class="variable">$table</span> = <span class="literal">null</span>, <span class="variable">$foreignPivotKey</span> = <span class="literal">null</span>, <span class="variable">$relatedPivotKey</span> = <span class="literal">null</span>, <span class="variable">$parentKey</span> = <span class="literal">null</span>, <span class="variable">$relatedKey</span> = <span class="literal">null</span>, <span class="variable">$inverse</span> = <span class="literal">false</span></span>)</span></span><br></pre></td></tr></table></figure><p>其中前七个参数和 morphedByMany 方法含义一致，只不过针对的关联模型对调过来，最后一个参数 $inverse 表示定义的是否是相对的关联关系，默认是 false。如果你是不按套路出牌自定义的字段，需要搞清楚以上参数的含义并传入自定义的参数值。</p><p>定义好上述关联关系后，就可以通过 Post 模型或 Page 模型获取对应的标签信息了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::with(<span class="string">&#x27;tags&#x27;</span>)-&gt;findOrFail(<span class="number">6</span>);</span><br><span class="line"><span class="variable">$tags</span> = <span class="variable">$post</span>-&gt;tags;</span><br></pre></td></tr></table></figure><p>返回的结果也是模型集合：<br><img src="https://upload.anitoys.com/hellocode/20210324235152.jpg" alt="img"><br>对应的底层查询 SQL 语句是：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  `tags`.<span class="operator">*</span>,</span><br><span class="line">  `taggables`.`taggable_id` <span class="keyword">as</span> `pivot_taggable_id`,</span><br><span class="line">  `taggables`.`tag_id` <span class="keyword">as</span> `pivot_tag_id`,</span><br><span class="line">  `taggables`.`taggable_type` <span class="keyword">as</span> `pivot_taggable_type`</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  `tags`</span><br><span class="line">  <span class="keyword">inner</span> <span class="keyword">join</span> `taggables` <span class="keyword">on</span> `tags`.`id` <span class="operator">=</span> `taggables`.`tag_id`</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  `taggables`.`taggable_id` <span class="keyword">in</span> (<span class="number">6</span>)</span><br><span class="line">  <span class="keyword">and</span> `taggables`.`taggable_type` <span class="operator">=</span> &quot;App\Post&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="关联查询"><a href="#关联查询" class="headerlink" title="关联查询"></a>关联查询</h1><p>关于关联查询，我们在前面介绍关联关系定义的时候已经穿插着介绍过，这里简单回顾下。在 Eloquent 模型上进行关联查询主要分为两种方式，一种是懒惰式加载（动态属性），一种是渴求式加载（通过with方法）。从性能上来说，渴求式加载更优，因为它会提前从数据库一次性查询所有关联数据，而懒惰式加载在每次查询动态属性的时候才会去执行查询，会多次连接数据库，性能上差一些（数据库操作主要开销在数据库连接上，所以在开发过程中如果想优化性能，尽量减少频繁连接数据库）</p><h2 id="懒惰式加载"><a href="#懒惰式加载" class="headerlink" title="懒惰式加载"></a>懒惰式加载</h2><p>下面这种方式就是懒惰式加载：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$author</span> = <span class="variable">$post</span>-&gt;author;</span><br></pre></td></tr></table></figure><p>每次访问 author 属性都会执行一次数据库查询，如果返回的文章结果是列表的话，需要遍历获取作者信息，假设要循环 N 次的话，加上文章模型本身的获取，总共需要进行 N + 1 次查询，而 PHP 对数据库的连接是短连接，每次都要重新连接数据库，所以从性能角度考虑不建议使用这种方式。</p><p>另外，如果访问的是模型实例上的 author() 方法时，返回的不是用户实例了，而是一个关联关系实例，该实例注入了查询构建器，所以你可以在其基础上通过方法链的方式构建查询构建器进行更加复杂的查询，我们以一个一对多的查询为例：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span> = User::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$posts</span> = <span class="variable">$user</span>-&gt;posts()-&gt;where(<span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">0</span>)-&gt;get();</span><br></pre></td></tr></table></figure><p>这样，我们就可以过滤出该用户发布的文章中浏览数大于 1 的结果。</p><h2 id="基于关联查询过滤模型实例"><a href="#基于关联查询过滤模型实例" class="headerlink" title="基于关联查询过滤模型实例"></a>基于关联查询过滤模型实例</h2><h3 id="有结果过滤"><a href="#有结果过滤" class="headerlink" title="有结果过滤"></a>有结果过滤</h3><p>有的时候，可能需要根据关联查询的结果来过滤查询结果，比如我们想要获取所有发布过文章的用户，可以这么做：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = User::has(<span class="string">&#x27;posts&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure><p>返回的是模型实例集合：<br><img src="https://upload.anitoys.com/hellocode/20210324235200.jpg" alt="img"><br>底层对应的是一个 EXISTS 查询：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  `users`</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  <span class="keyword">exists</span> (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      <span class="operator">*</span></span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">      `posts`</span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">      `users`.`id` <span class="operator">=</span> `posts`.`user_id`</span><br><span class="line">      <span class="keyword">and</span> `posts`.`deleted_at` <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">and</span> `email_verified_at` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure><p>如果你想要进一步过滤发布文章数量大于 1 的用户，可以带上查询条件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = User::has(<span class="string">&#x27;posts&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">1</span>)-&gt;get();</span><br></pre></td></tr></table></figure><p>底层执行的 SQL 查询语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  `users`</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">      `posts`</span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">      `users`.`id` <span class="operator">=</span> `posts`.`user_id`</span><br><span class="line">      <span class="keyword">and</span> `posts`.`deleted_at` <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">  ) <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">and</span> `email_verified_at` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure><p>你甚至还可以通过嵌套关联查询的方式过滤发布的文章有评论的用户：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = User::has(<span class="string">&#x27;posts.comments&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure><p>其实也就是一个嵌套的 EXISTS 查询：<br><img src="https://upload.anitoys.com/hellocode/20210324235208.jpg" alt="img"><br>此外，还有一个 orHas 方法，顾名思义，它会执行一个 OR 查询，比如我们想要过滤包含评论或标签的文章：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$posts</span> = Post::has(<span class="string">&#x27;comments&#x27;</span>)-&gt;orHas(<span class="string">&#x27;tags&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure><p>如果你想要通过更复杂的关联查询过滤模型实例，还可以通过 whereHas/orWhereHas 方法基于闭包函数定义查询条件，比如我们想要过滤发布文章标题中包含「Laravel学院」的所有用户：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = User::whereHas(<span class="string">&#x27;posts&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>);</span><br><span class="line">&#125;)-&gt;get();</span><br></pre></td></tr></table></figure><p>底层执行的 SQL 查询语句如下：<br><img src="https://upload.anitoys.com/hellocode/20210324235215.jpg" alt="img"><br>如果你想进一步过滤出文章标题和评论都包含「Laravel学院」的用户，可以在上述闭包函数中通过查询构建器进一步指定：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = User::whereHas(<span class="string">&#x27;posts&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>)</span><br><span class="line">       -&gt;whereExists(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>)  </span>&#123;</span><br><span class="line">          <span class="variable">$query</span>-&gt;from(<span class="string">&#x27;comments&#x27;</span>)</span><br><span class="line">              -&gt;whereRaw(<span class="string">&#x27;`posts`.`id` = `comments`.`commentable_id`&#x27;</span>)</span><br><span class="line">              -&gt;where(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>)</span><br><span class="line">              -&gt;where(<span class="string">&#x27;commentable_type&#x27;</span>, Post::class)</span><br><span class="line">              -&gt;whereNull(<span class="string">&#x27;deleted_at&#x27;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;)-&gt;get();</span><br></pre></td></tr></table></figure><p>如果你想过滤文章标题或评论都包含「Laravel学院」的用户，将 whereExists 换成 orWhereExists 方法即可：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = User::whereHas(<span class="string">&#x27;posts&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>)</span><br><span class="line">       -&gt;orWhereExists(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>)  </span>&#123;</span><br><span class="line">          <span class="variable">$query</span>-&gt;from(<span class="string">&#x27;comments&#x27;</span>)</span><br><span class="line">              -&gt;whereRaw(<span class="string">&#x27;`posts`.`id` = `comments`.`commentable_id`&#x27;</span>)</span><br><span class="line">              -&gt;where(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>)</span><br><span class="line">              -&gt;where(<span class="string">&#x27;commentable_type&#x27;</span>, Post::class)</span><br><span class="line">              -&gt;whereNull(<span class="string">&#x27;deleted_at&#x27;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;)-&gt;get();</span><br></pre></td></tr></table></figure><p>如果不想自己构造查询构建器，还可以通过方法链的方式实现上述同样的功能：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// and </span></span><br><span class="line"><span class="variable">$users</span> = User::whereHas(<span class="string">&#x27;posts&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>);</span><br><span class="line">&#125;)-&gt;whereHas(<span class="string">&#x27;posts.comments&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>);</span><br><span class="line">&#125;)-&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="comment">// or    </span></span><br><span class="line"><span class="variable">$users</span> = User::whereHas(<span class="string">&#x27;posts&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>);</span><br><span class="line">&#125;)-&gt;orWhereHas(<span class="string">&#x27;posts.comments&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>);</span><br><span class="line">&#125;)-&gt;get();</span><br></pre></td></tr></table></figure><h3 id="无结果过滤"><a href="#无结果过滤" class="headerlink" title="无结果过滤"></a>无结果过滤</h3><p>与 has/orHas 方法相对的，还有一对 doesntHave/orDoesntHave 方法。很显然，它们用于过滤不包含对应关联结果的模型实例。比如我们想要那些没有发布过文章的用户，可以通过 doesntHave 方法实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = User::doesntHave(<span class="string">&#x27;posts&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure><p>获取的结果也是模型实例集合：<br><img src="https://upload.anitoys.com/hellocode/20210324235222.jpg" alt="img"><br>底层执行的 SQL 语句一个 NOT EXISTS 查询：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  `users`</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  <span class="keyword">not</span> <span class="keyword">exists</span> (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      <span class="operator">*</span></span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">      `posts`</span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">      `users`.`id` <span class="operator">=</span> `posts`.`user_id`</span><br><span class="line">      <span class="keyword">and</span> `posts`.`deleted_at` <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">and</span> `email_verified_at` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure><p>如果想要获取没有评论或没有标签的文章，可以结合 doesntHave 和 orDoesntHave 方法实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$posts</span> = Post::doesntHave(<span class="string">&#x27;comments&#x27;</span>)-&gt;doesntHave(<span class="string">&#x27;tags&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure><p>对应的 SQL 语句是：<br><img src="https://upload.anitoys.com/hellocode/20210324235229.jpg" alt="img"><br>和 whereHas 方法和 orWhereHas 方法相对的，也有 whereDoesntHave 和 orWhereDoesntHave 方法，使用方法一样，这里就不再赘述了。</p><h2 id="统计关联模型"><a href="#统计关联模型" class="headerlink" title="统计关联模型"></a>统计关联模型</h2><p>我们还可以通过 Eloquent 提供的 withCount 方法在不加载关联模型的情况下统计关联结果的数量。比如我们想要统计某篇文章的评论数，可以这么做：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::withCount(<span class="string">&#x27;comments&#x27;</span>)-&gt;findOrFail(<span class="number">32</span>);</span><br></pre></td></tr></table></figure><p>我们查看下返回的 $post 模型实例的数据结构：<br><img src="https://upload.anitoys.com/hellocode/20210324235451.jpg" alt="img"><br>其中包含了 comments_count 字段，通过这个字段就可以访问该文章的评论数。如果要统计其它关联模型结果数量字段，可以依次类推，对应字段都是 {relation}_count 结构。</p><blockquote><p>注：实际开发中为了提高查询性能，我们往往是在 posts 表中冗余提供一个 comments_count 字段，每新增一条评论，该字段值加 1，查询的时候直接取该字段即可，从而提高查询的性能。</p></blockquote><p>此外，你还可以通过数组传递多个关联关系一次统计多个字段，还可以通过闭包函数指定对应统计的过滤条件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::withCount([<span class="string">&#x27;tags&#x27;</span>, <span class="string">&#x27;comments&#x27;</span> =&gt; <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院&#x27;</span>)</span><br><span class="line">        -&gt;orderBy(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>);</span><br><span class="line">&#125;])-&gt;findOrFail(<span class="number">32</span>);</span><br></pre></td></tr></table></figure><p>甚至还可以为统计字段设置别名，以便可以从不同维度统计某个字段：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::withCount([</span><br><span class="line">    <span class="string">&#x27;comments&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;comments as pending_comments&#x27;</span> =&gt; <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;status&#x27;</span>, Comment::PENDING);</span><br><span class="line">    &#125;</span><br><span class="line">])-&gt;findOrFail(<span class="number">32</span>);</span><br></pre></td></tr></table></figure><p>对应的返回结果如下：<br><img src="https://upload.anitoys.com/hellocode/20210324235242.jpg" alt="img"><br>这个功能用于不考虑性能的场景进行快速查询还是很方便的，但如果对性能有较高要求，则不推荐使用，毕竟是要执行多次查询才能逐个统计出来。</p><h2 id="渴求式加载-1"><a href="#渴求式加载-1" class="headerlink" title="渴求式加载"></a>渴求式加载</h2><p>我们在前面已经介绍过，渴求式加载通过 with 方法实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::with(<span class="string">&#x27;author&#x27;</span>)-&gt;findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$author</span> = <span class="variable">$post</span>-&gt;author;</span><br></pre></td></tr></table></figure><p>渴求式加载会在查询到模型实例结果后，通过 IN 查询获取关联结果，并将其附着到对应的模型实例上，在后面访问的时候不会再对数据库进行查询。所以不管模型实例有多少个，关联结果只会查询一次，加上模型本身查询总共是两次查询，在列表查询时，大大减少了对数据库的连接查询次数，因而有更好的性能表现，推荐使用。</p><p>渴求式加载支持一次加载多个关联模型（参数名对应相应的关联方法名）：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$posts</span> = Post::with(<span class="string">&#x27;author&#x27;</span>, <span class="string">&#x27;comments&#x27;</span>, <span class="string">&#x27;tags&#x27;</span>)-&gt;findOrFail(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>返回的数据格式如下：<br><img src="https://upload.anitoys.com/hellocode/20210324235248.jpg" alt="img"><br>此外，渴求式加载还支持嵌套查询，比如我们想要访问文章作者的扩展表信息，可以这么做：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::with(<span class="string">&#x27;author.profile&#x27;</span>)-&gt;findOrFail(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>这样就可以嵌套获取到 profile 表记录的信息：<br><img src="https://upload.anitoys.com/hellocode/20210324235519.jpg" alt="img"><br>这里会涉及到三个 SQL 查询：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `posts` <span class="keyword">where</span> `posts`.`id` <span class="operator">=</span> ? <span class="keyword">and</span> `posts`.`deleted_at` <span class="keyword">is</span> <span class="keyword">null</span> limit <span class="number">1</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `users` <span class="keyword">where</span> `users`.`id` <span class="keyword">in</span> (?) <span class="keyword">and</span> `email_verified_at` <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `user_profiles` <span class="keyword">where</span> `user_profiles`.`user_id` <span class="keyword">in</span> (?);</span><br></pre></td></tr></table></figure><p>你还可以通过 with 方法指定要加载的字段：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::with(<span class="string">&#x27;author:id,name&#x27;</span>)-&gt;findOrFail(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>注：使用此特性 id 字段必须列出。</p><p>在渴求式加载中，也可以通过闭包传入额外的约束条件，只不过这个约束条件是对关联模型自身的过滤，不影响目标模型的查询：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::with([<span class="string">&#x27;comments&#x27;</span> =&gt; <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>)</span><br><span class="line">        -&gt;orderBy(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>);</span><br><span class="line">&#125;])-&gt;where(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="number">5</span>)-&gt;get();</span><br></pre></td></tr></table></figure><p>底层执行的 SQL 语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  `posts`</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  `id` <span class="operator">&lt;</span> <span class="number">5</span></span><br><span class="line">  <span class="keyword">and</span> `posts`.`deleted_at` <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  `comments`</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  `comments`.`commentable_id` <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">  <span class="keyword">and</span> `comments`.`commentable_type` <span class="operator">=</span> &quot;App\Post&quot;</span><br><span class="line">  <span class="keyword">and</span> `content` <span class="keyword">like</span> &quot;Laravel学院%&quot;</span><br><span class="line">  <span class="keyword">and</span> `comments`.`deleted_at` <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  `created_at` <span class="keyword">desc</span></span><br></pre></td></tr></table></figure><h2 id="懒惰渴求式加载"><a href="#懒惰渴求式加载" class="headerlink" title="懒惰渴求式加载"></a>懒惰渴求式加载</h2><p>有时候，你可能觉得一次性加载所有关联数据有点浪费，对于特定条件下才使用的数据我们可以通过动态条件判断进行渴求式加载或者延迟加载。我们将这种加载叫做懒惰渴求式加载，这种加载可以通过 load 方法实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = User::all();</span><br><span class="line"><span class="variable">$condition</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$condition</span>) &#123;</span><br><span class="line">    <span class="variable">$users</span>-&gt;load(<span class="string">&#x27;posts&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>懒惰渴求式加载也是渴求式加载，只不过是在需要的时候才去加载，所以加上了「懒惰」这个修饰词，底层执行的 SQL 查询语句和渴求式加载是一样的：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  `posts`</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  `posts`.`user_id` <span class="keyword">in</span> (?, ?, ?, ?, ?)</span><br><span class="line">  <span class="keyword">and</span> `posts`.`deleted_at` <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">和渴求式加载一样，它也支持通过闭包传递额外的约束条件：</span><br><span class="line"></span><br><span class="line">$posts <span class="operator">=</span> Post::<span class="keyword">where</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;&lt;=&#x27;</span>, <span class="number">3</span>)<span class="operator">-</span><span class="operator">&gt;</span><span class="keyword">get</span>();</span><br><span class="line">$posts-&gt;load([&#x27;comments&#x27; =&gt; function ($query) &#123;</span><br><span class="line">    $query<span class="operator">-</span><span class="operator">&gt;</span><span class="keyword">where</span>(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;Laravel学院%&#x27;</span>)</span><br><span class="line">        <span class="operator">-</span><span class="operator">&gt;</span>orderBy(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure><h1 id="关联插入与更新"><a href="#关联插入与更新" class="headerlink" title="关联插入与更新"></a>关联插入与更新</h1><h2 id="一对多关联记录插入"><a href="#一对多关联记录插入" class="headerlink" title="一对多关联记录插入"></a>一对多关联记录插入</h2><p>新增关联模型的时候，可以在父模型上调用相应方法直接插入记录到数据库，这样做的好处是不需要指定关联模型与父模型的外键关联字段值，Eloquent 底层会自动判断并设置。比如，如果我们要在某篇文章上新增一条评论可以这么做：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$faker</span> = \Faker\Factory::create();</span><br><span class="line"><span class="variable">$comment</span> = <span class="keyword">new</span> Comment();</span><br><span class="line"><span class="variable">$comment</span>-&gt;content = <span class="variable">$faker</span>-&gt;paragraph;</span><br><span class="line"><span class="variable">$comment</span>-&gt;user_id = mt_rand(<span class="number">1</span>, <span class="number">15</span>);</span><br><span class="line"><span class="variable">$post</span>-&gt;comments()-&gt;save(<span class="variable">$comment</span>);</span><br></pre></td></tr></table></figure><p>Eloquent 底层会自动帮我们维护 commentable_id 和 commentable_type 字段。</p><p>还可以通过 saveMany 方法一次插入多条关联记录，前提是为关联模型配置了批量赋值，比如我们为 Comment 模型类配置白名单 $fillable 属性如下（你也可以不配置批量赋值，但是需要多次实例化并逐个设置评论模型属性值，很麻烦）：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$fillable</span> = [</span><br><span class="line">    <span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;user_id&#x27;</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>这样我们就可以批量插入文章评论数据了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$faker</span> = \Faker\Factory::create();</span><br><span class="line"><span class="variable">$post</span>-&gt;comments()-&gt;saveMany([</span><br><span class="line">    <span class="keyword">new</span> Comment([<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;paragraph, <span class="string">&#x27;user_id&#x27;</span> =&gt; mt_rand(<span class="number">1</span>, <span class="number">15</span>)]),</span><br><span class="line">    <span class="keyword">new</span> Comment([<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;paragraph, <span class="string">&#x27;user_id&#x27;</span> =&gt; mt_rand(<span class="number">1</span>, <span class="number">15</span>)]),</span><br><span class="line">    <span class="keyword">new</span> Comment([<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;paragraph, <span class="string">&#x27;user_id&#x27;</span> =&gt; mt_rand(<span class="number">1</span>, <span class="number">15</span>)]),</span><br><span class="line">    <span class="keyword">new</span> Comment([<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;paragraph, <span class="string">&#x27;user_id&#x27;</span> =&gt; mt_rand(<span class="number">1</span>, <span class="number">15</span>)]),</span><br><span class="line">    <span class="keyword">new</span> Comment([<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;paragraph, <span class="string">&#x27;user_id&#x27;</span> =&gt; mt_rand(<span class="number">1</span>, <span class="number">15</span>)])</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p>此外，我们还可以通过 create/createMany 方法来插入关联数据，与 save/saveMany 方法不同的是，这两个方法接收的是数组参数：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入一条记录</span></span><br><span class="line"><span class="variable">$post</span>-&gt;comments()-&gt;create([</span><br><span class="line">    <span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;paragraph, <span class="string">&#x27;user_id&#x27;</span> =&gt; mt_rand(<span class="number">1</span>, <span class="number">15</span>)</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入多条记录</span></span><br><span class="line"><span class="variable">$post</span>-&gt;comments()-&gt;createMany([</span><br><span class="line">    [<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;paragraph, <span class="string">&#x27;user_id&#x27;</span> =&gt; mt_rand(<span class="number">1</span>, <span class="number">15</span>)],</span><br><span class="line">    [<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;paragraph, <span class="string">&#x27;user_id&#x27;</span> =&gt; mt_rand(<span class="number">1</span>, <span class="number">15</span>)],</span><br><span class="line">    [<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;paragraph, <span class="string">&#x27;user_id&#x27;</span> =&gt; mt_rand(<span class="number">1</span>, <span class="number">15</span>)]</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><h2 id="更新一对多所属模型外键字段"><a href="#更新一对多所属模型外键字段" class="headerlink" title="更新一对多所属模型外键字段"></a>更新一对多所属模型外键字段</h2><p>如果是要更新新创建的模型实例所属模型（父模型）的外键字段，比如以 posts 表为例，新增的记录想要更新 user_id 字段，可以这么实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span> = User::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$post</span>-&gt;author()-&gt;associate(<span class="variable">$user</span>);</span><br><span class="line"><span class="variable">$post</span>-&gt;save();</span><br></pre></td></tr></table></figure><p>相对的，如果想要解除当前模型与所属模型之间的关联，可以通过 dissociate 方法来实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span>-&gt;author()-&gt;dissociate();</span><br><span class="line"><span class="variable">$post</span>-&gt;save();</span><br></pre></td></tr></table></figure><p>这样，就会将 posts.user_id 置为 null。前提是 user_id 允许为 null，否则会抛出异常。</p><h3 id="空对象模型"><a href="#空对象模型" class="headerlink" title="空对象模型"></a>空对象模型</h3><p>如果外键字段 user_id 允许为空的话，当我们访问 Post 模型上的 author 属性时，默认返回为 null。Eloquent 允许我们为这种空对象定义一个默认的类型，这个对象的类型可以在定义关联关系的时候指定：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">author</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(User::class, <span class="string">&#x27;user_id&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">        -&gt;withDefault();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，再次访问对应 Post 模型实例的时候返回的就是一个空的 App\User 实例，你还可以为这个对象指定默认属性值：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">author</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(User::class, <span class="string">&#x27;user_id&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">        -&gt;withDefault([</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;游客用户&#x27;</span>,</span><br><span class="line">        ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再次访问对应 Post 模型上的 author 属性时，就会返回如下默认的空对象了：<br><img src="https://upload.anitoys.com/hellocode/20210324235300.jpg" alt="img"><br>该特性其实应用了设计模式中的空对象模式，好处是在代码里可以为不同情况编写一致性代码。这样，我们就不需要在每个地方去判断如果文章作者信息为空该如何处理了，因为这种情况下返回的也是一个正常的 User 模型实例。</p><h2 id="多对多关联的绑定与解除"><a href="#多对多关联的绑定与解除" class="headerlink" title="多对多关联的绑定与解除"></a>多对多关联的绑定与解除</h2><p>在插入多对多关联记录的时候，可以通过上面一对多关联记录插入的方式。以文章与标签为例，完全可以这样通过文章模型新增标签模型，同时更新中间表记录：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入单条记录</span></span><br><span class="line"><span class="variable">$post</span>-&gt;tags()-&gt;save(</span><br><span class="line">    <span class="keyword">new</span> Tag([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;word])</span><br><span class="line">); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果中间表接收额外参数可以通过第二个参数传入</span></span><br><span class="line"><span class="variable">$post</span>-&gt;tags()-&gt;save(</span><br><span class="line">    <span class="keyword">new</span> Tag([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;word]), </span><br><span class="line">    [<span class="string">&#x27;user_id&#x27;</span> =&gt; <span class="number">1</span>]</span><br><span class="line">); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入多条记录</span></span><br><span class="line"><span class="variable">$post</span>-&gt;tags()-&gt;saveMany([</span><br><span class="line">    <span class="keyword">new</span> Tag([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;unique()-&gt;word]),</span><br><span class="line">    <span class="keyword">new</span> Tag([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;unique()-&gt;word]),</span><br><span class="line">    <span class="keyword">new</span> Tag([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;unique()-&gt;word])</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果插入多条记录需要传递中间表额外字段值（通过键值关联对应记录与额外字段）</span></span><br><span class="line"><span class="variable">$post</span>-&gt;tags()-&gt;saveMany([</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="keyword">new</span> Tag([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;unique()-&gt;word]),</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="keyword">new</span> Tag([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;unique()-&gt;word]),</span><br><span class="line">    <span class="number">3</span> =&gt; <span class="keyword">new</span> Tag([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$faker</span>-&gt;unique()-&gt;word])</span><br><span class="line">], [</span><br><span class="line">    <span class="number">1</span> =&gt; [<span class="string">&#x27;user_id&#x27;</span> =&gt; <span class="number">1</span>],</span><br><span class="line">    <span class="number">2</span> =&gt; [<span class="string">&#x27;user_id&#x27;</span> =&gt; <span class="number">2</span>],</span><br><span class="line">    <span class="number">3</span> =&gt; [<span class="string">&#x27;user_id&#x27;</span> =&gt; <span class="number">3</span>],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p>此外，Eloquent 底层还提供了为已有模型之间进行多对多关联的绑定和解除操作。</p><p>还是以文章和标签为例，要将两个本来没有关联关系的记录绑定起来，可以通过 attach 方法实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = Post::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$tag</span> = Tag::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$post</span>-&gt;tags()-&gt;attach(<span class="variable">$tag</span>-&gt;id);</span><br><span class="line"><span class="comment">// 如果中间表还有其它额外字段，可以通过第二个数组参数传入</span></span><br><span class="line"><span class="comment">// $post-&gt;tags()-&gt;attach($tag-&gt;id, [&#x27;user_id&#x27; =&gt; $userId]);</span></span><br><span class="line"><span class="comment">// 还可以一次绑定多个标签</span></span><br><span class="line"><span class="comment">// $post-&gt;tags()-&gt;attach([1, 2]);</span></span><br><span class="line"><span class="comment">// 如果绑定多个标签，要传递额外字段值，可以这么做：</span></span><br><span class="line"><span class="comment">/*$post-&gt;tags()-&gt;attach([</span></span><br><span class="line"><span class="comment">    1 =&gt; [&#x27;user_id&#x27; =&gt; 1],</span></span><br><span class="line"><span class="comment">    2 =&gt; [&#x27;user_id&#x27; =&gt; 2]</span></span><br><span class="line"><span class="comment">]);*/</span></span><br></pre></td></tr></table></figure><p>如果要解除这个关联关系可以通过 detach 方法实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span>-&gt;tags()-&gt;detach(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 如果想要一次解除多个关联，可以这么做：</span></span><br><span class="line"><span class="comment">// $post-&gt;tags()-&gt;detach([1, 2]);</span></span><br><span class="line"><span class="comment">// 如果想要一次解除所有关联，可以这么做：</span></span><br><span class="line"><span class="comment">// $post-&gt;tags()-&gt;detach();</span></span><br></pre></td></tr></table></figure><p>上面这两种方法很方便，但还有更方便的，当我们在更新某篇文章的标签时，往往同时涉及关联标签的绑定和解除。按照上面的逻辑，我们需要先把所有标签记录查询出来，再判断哪些需要绑定关联、哪些需要解除关联、哪些需要插入新的标签记录，然后再通过 attach 和 detach 方法最终完成与对应文章的绑定和解除关联。</p><p>对于那些已存在的标签记录，我们可以通过更高效的方法与文章进行关联关系的绑定和解除，这个方法就是 sync，调用该方法时只需传入刚创建/更新后文章的标签对应 ID 值，至于哪些之前不存在的关联需要绑定，哪些存在的关联需要解除，哪些需要维护现状，交由 Eloquent 底层去判断：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span>-&gt;tags()-&gt;sync([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure><p>如果对应新增数据需要传递额外参数，参考 attach 即可，两者是一样的。</p><p>有时候，你可能仅仅是想要更新中间表字段值，这个时候，可以通过 updateExistingPivot 方法在第二个参数中将需要更新的字段值以关联数组的方式传递过去：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span>-&gt;tags()-&gt;updateExistingPivot(<span class="variable">$tagId</span>, <span class="variable">$attributes</span>);</span><br></pre></td></tr></table></figure><h2 id="触发父模型时间戳更新"><a href="#触发父模型时间戳更新" class="headerlink" title="触发父模型时间戳更新"></a>触发父模型时间戳更新</h2><p>当一个模型归属于另外一个模型时，例如 Comment 模型归属于 Post 模型，当子模型更新时，父模型的更新时间也同步更新往往很有用，比如在有新评论时触发文章页缓存更新，或者通知搜索引擎页面有更新等等。Eloquent 提供了这种同步机制帮助我们更新子模型时触发父模型的更新时间 updated_at 字段值更新，要让该机制生效，需要在子模型中配置 $touches 属性：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要触发更新的父级关联关系</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$touches</span> = [</span><br><span class="line">    <span class="string">&#x27;commentable&#x27;</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>属性值是对应关联方法的名称，支持配置多个关联关系。下面我们简单演示下，以 id=31 的评论记录为例，对应的模型数据及所属文章模型数据如下：<br><img src="https://upload.anitoys.com/hellocode/20210324235308.jpg" alt="img"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;我们所熟知的 MySQL、SQL Server、Oracle 都是关系型数据库，何谓关系型数据库？简单来说就是数据表之间存在关联关系。到目前为止，我们介绍的所有 Eloquent 模型操作都是针对单表的，接下来我们将花三篇左右的篇幅来给大家介绍如何在 Eloquent 模型</summary>
      
    
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/categories/Laravel/"/>
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>健身干货</title>
    <link href="https://blog.wangk.cn/2018/09/05/%E5%81%A5%E8%BA%AB%E5%B9%B2%E8%B4%A7/"/>
    <id>https://blog.wangk.cn/2018/09/05/%E5%81%A5%E8%BA%AB%E5%B9%B2%E8%B4%A7/</id>
    <published>2018-09-05T09:09:22.000Z</published>
    <updated>2021-03-15T02:34:38.240Z</updated>
    
    <content type="html"><![CDATA[<h1 id="健身干货"><a href="#健身干货" class="headerlink" title="健身干货"></a>健身干货</h1><ul><li>1.仰卧起坐练不了腹肌，和腹肌完全没关系，还伤身，尤其抱头，杀伤性无极大。从小学体育课就这么错误的教，健身界和别的国家早都知道的并淘汰的一个错误的动作，中国用了这么多年，直到今年部队大纲才发现并取消。只能呵呵了。</li><li>2.引体向上不是练胳膊的，是练背。俯卧撑练的是胸</li><li>3.节食不能减肥，只会越来越胖，吃的多才能减脂</li><li>4.睡觉也能减肥</li><li>5.只跑步不做力量训练，永远也跑不出有肌肉的好身材</li><li>6.女性跑步跑死腿也跑不粗，跑完变粗那是充血发涨的。</li><li>7.局部减肥是伪科学，没有局部减肥，不要再问我某个部位肉多怎么减，也不要再信什么局部减肥的广告了，那都是骗人的，全球现在也没研究出局部减肥的办法，不知道为什么有那么多人还信。</li><li>8.想永远保持好身材必须要有肌肉，有肌肉才会瘦，运动以外任何方法减脂都是暂时的。</li><li>9.女性只要你不注射药物，永远也练不成肌肉男，只会前凸后翘</li><li>10.没有减肥这个词，只有减脂，只有体型变瘦体重不变才是正确的，很多人却只看体重，请看体型不要看体重。</li><li>11.体重快速下降那减少的是你身体里的水，不是肉。</li><li>12.腹肌有个屁用，体脂率低都会显现，大小不一而已，但你可以练的更大，但必须体脂率低，胖人你就不要练腹肌了，没用，先减脂再说。</li><li>13.跑步减脂请看时间不要看距离，跑步前期消耗的是身体里的糖，不是脂肪，请至少20分钟以上</li><li>14.力量训练胖人减脂轻重量多组数，瘦人增肌大重量少次数。</li><li>15.腿也要练，练下半身才能促睾，睾酮才能帮助你全身的肌肉锻炼，女性没有睾丸，睾酮低的可怜，所以练不出肌肉。</li><li>16.一周5天不锻炼，只集中一两天猛练反而对身体有害，不如别练</li><li>17.肌肉就是肌肉，脂肪就是脂肪，没有不锻炼肌肉就变脂肪的说法，不锻炼肌肉只会松弛变软，也还是瘦肉，再接着锻炼很快就能恢复。</li><li>18.平板支撑练不出腹肌，练的是核心稳定性</li><li>19.出汗多少和训练量和减脂没半毛钱关系，那是体质问题。</li><li>20.夏天晚上尽量不要夜跑，太危险，出门到处都是烧烤摊，一吃一晚上。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;健身干货&quot;&gt;&lt;a href=&quot;#健身干货&quot; class=&quot;headerlink&quot; title=&quot;健身干货&quot;&gt;&lt;/a&gt;健身干货&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;1.仰卧起坐练不了腹肌，和腹肌完全没关系，还伤身，尤其抱头，杀伤性无极大。从小学体育课就这么错误的教，健身界和别</summary>
      
    
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/categories/Laravel/"/>
    
    
    <category term="Laravel" scheme="https://blog.wangk.cn/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>Charles Proxy</title>
    <link href="https://blog.wangk.cn/2018/07/03/CharlesProxy/"/>
    <id>https://blog.wangk.cn/2018/07/03/CharlesProxy/</id>
    <published>2018-07-03T07:34:13.000Z</published>
    <updated>2021-04-29T02:52:32.715Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Charles破解"><a href="#Charles破解" class="headerlink" title="Charles破解"></a>Charles破解</h1><h2 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h2><p><a href="https://www.charlesproxy.com/download/">官方下载地址</a></p><h2 id="破解地址"><a href="#破解地址" class="headerlink" title="破解地址"></a>破解地址</h2><p><a href="https://www.zzzmode.com/mytools/charles/">Charles破解工具</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">描述</span><br><span class="line">此工具用于生成破解后的charles.jar文件，blog介绍: https:&#x2F;&#x2F;blog.zzzmode.com&#x2F;2017&#x2F;05&#x2F;16&#x2F;charles-4.0.2-cracked</span><br><span class="line">用法</span><br><span class="line">输入RegisterName(此名称随意，用于显示 Registered to xxx)，选择本地已安装的版本，点击生成，并下载charles.jar文件</span><br><span class="line">替换本地charles.jar文件</span><br><span class="line">macOS: &#x2F;Applications&#x2F;Charles.app&#x2F;Contents&#x2F;Java&#x2F;charles.jar</span><br><span class="line">Windows: C:\Program Files\Charles\lib\charles.jar</span><br><span class="line">注意</span><br><span class="line">仅供个人学习研究和交流使用，请勿用于任何商业用途。</span><br></pre></td></tr></table></figure><p><a href="https://cdn.jsdelivr.net/gh/wangk-cc/picgo@images/2021/04/29/20210429100444.jar">charles.jar</a></p><h2 id="注册码"><a href="#注册码" class="headerlink" title="注册码"></a>注册码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Charles Proxy License</span><br><span class="line">&#x2F;&#x2F; 适用于Charles任意版本的注册码，谁还会想要使用破解版呢。</span><br><span class="line">&#x2F;&#x2F; Charles 4.6.1目前是最新版，可用。</span><br><span class="line"></span><br><span class="line">Registered Name: https:&#x2F;&#x2F;zhile.io</span><br><span class="line">License Key: 48891cf209c6d32bf4</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Charles破解&quot;&gt;&lt;a href=&quot;#Charles破解&quot; class=&quot;headerlink&quot; title=&quot;Charles破解&quot;&gt;&lt;/a&gt;Charles破解&lt;/h1&gt;&lt;h2 id=&quot;下载地址&quot;&gt;&lt;a href=&quot;#下载地址&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="破解" scheme="https://blog.wangk.cn/categories/%E7%A0%B4%E8%A7%A3/"/>
    
    
    <category term="破解" scheme="https://blog.wangk.cn/tags/%E7%A0%B4%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>macOS开发环境配置</title>
    <link href="https://blog.wangk.cn/2017/09/04/macOS%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>https://blog.wangk.cn/2017/09/04/macOS%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</id>
    <published>2017-09-04T09:13:33.000Z</published>
    <updated>2021-03-18T10:43:25.176Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，这个密码看着不太对，请再试试。" data-whm="抱歉，这个文章不能被纠正，不过您还是能看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="36d2837019e19f75220b71bb140dd043f9fcb82bad62c1a0af4eeca535ada0ad">b09808b90291370b797d5907a7a29571a262c4b82455ccef73a68bd576cbfc9900f1e07ea3a6bd0e150bd6d77eef6469f66a31d69008453fb877fe8894b0af1a70b22a388264194a9d4df668832f79fffa1633f9ea2136326632881725fa358625df07b37c49296eb855b5daba6c08228a85425b6db741b553abbe02b317bafa3746bbd5c7b3e367a4d73b440b0cc29d921a45441b5c187268d5b125f6ef096a7483c88d881b57f07e4ed19f3a000a8d691837b4a99960c8080da6780f90b6c19a5c541c83c64498b9766ef039d3e34488f7db4cd6ef644b8d98ef22e54823470ee75c8e324260947a7bba380157ac7a188585964b7da30aa9daf77a30d02d6b9625a5db6bee9fbc8e2790433cf2e01abca5e662616e826cb3e12d77c0fbe5f58e1c87bfc78e1cd2e16637ef80cd0982f8f399eadce1d4c21c7d9e1c496994ea99312119ba4c79d5076f613c23c5f8e3bbbda7cda5bd5f5a11f47092663c5c3c919ee51107d101edb397873263c8c313955a8bc3c4d82f09396283d3c137229b72e84baf43956e2a2bfe6b808640e8dc594df42f41cfce31a914adb1d4d05cee1eb2527d7dc5fc1695d318babf99a581ec3cdb457cf8efc9b68937f228b0f6fc73eafd33548f8bf163f8fce6557103f6c7539aafa3415cb8c79be1e65b14564d2112bfd80c7168546789ea5e4e73f0835326dbce2e4a9418ae91c35a50589f3cfa4bce4d2b6f9b2efc68d510fcfb649faa58e95369090133bfc4ec969119b069d5d2c81c491ae27b53db5cb232606e5870ec7c32477c9e2dd9e2cf45c533f5812d18c7056ee228eabb6ec05a0f203be111743f9c1baeff2ec7d8323cc144f7c86014f3f027373059bba45181b170e69174d2ac3f1ca02fd43b3060fb71a199bc1aa27ddf02c3039ded6a9e86dc8d9d19155093a74d6616a06023eb56f9e3f14932452e69516d3459173413fb8d93abf57b017291dbf80137146c2fe536020d8f4c615a19ae777186bc16cc39e50d23a1579cd91523f1c3a0bfb4b724dc4577f18cc865ea6ab1845f0a2558a045dead5f876ebebf24c63b82706e51a1f5bb99c82584e23a3ed8d617dadc22568858dd09d61b60576d01be9c4ff7cceba80997514e69f5348491a1479e0ffe46c9bc210916010e02a4d97b2c6af9ac9e3f391a3ad9aaed94f31b35ede1532568495c2f8a2cf02f41065811ba78514563500ecaab1c415306a376daad7e0369a08c9e09881a2514bdb5cf59dc88b022edf9d4cccba630863277e2740e4e9b722aeaeb520224aba96f2f5352223c793d06d0f22857906a002366e3d28b9b195da964b0ddfc72b1445026396bdac692f34723e1e628edf926aa279db52942a218f8faae8474cca334a260149585072dccf4ac2edf86e2f91a333a248ed26bd9aceda93f004231dee3f8deb738e253ed07ed6bdf3156ac61acdea71605211bce739f7013be53f3243a6dcd9262e5318748817fb47d5ecdfaed9b2a101d2d105087c3e4eb62325017ebadb3768dc8e3dbdca34e1a801ac0b2f3b1da25549825729f3c63eddfe1c9d8b14a64f1700012a159762108ed74d167425ae79d8fda60e9a95c7a133ee79f6827d6f011b7529a2824d61da90b64f1a441afc2b8756a8a59f63381308bae2f6218e7185739f4fd8eb9681d66bd7a666a0bb495eb2525d4abcfd0a62991ed27ab4b47b836b18e163c07906876a5c8e7f4f707caef11ee13cb80b1d6048be65918340eccbafe764d7d2ea674bed45de0b7669276085a56063fd910480f037cfed3dbf32a154c9a4e5a7d0e26e6d68a9c4d59d68a299d750c190cac7880e7e668c05953334c4ff9e5fc7cd3f625c12b38138e0b7f9b31f244661b555de79ad1bc668ef5bab08376ff6fa0fba9e741b0e7f562da38ba350ed6a133ff442eae7c9435b6e08849c6ec2c0cb12b992dd8819c05ebb3bb21e96db7c42db12c1965a7cded4d5aac677285c6225b3263a3f381afc628c13d612430868a827d368948e5339fc0a3295443161cbe1051d9cb5b66fc572c98d5d1866fdcd65bbbf78b80cd640c9e086beecdc8eae09b547059f3250f1833f058c67a4be51764f9c4da0b0311a1e4bac9f57da6ea08712256d9e6c5e3da09a5388c91afd8b09a4733e85f9c669d15fb739b46028f61fa8f591c5b5facf3cc81dafb5822fd5ce2a738396871674e293c55531ff5c49c375f3cbcc85e8c18bd6468a9caf2f790087a75e8bcc5b0451d3b639bc49f50c4b31d4da212044034d000db732352dc1e6dcef91354bf9f21d2dd0da6b363f9c919128a108d078f1e7bde1e4652f96cc8ae055274a2eeb904406fe3ad5fe8976b75af839b15583f01bf4ee87d2edf87f4a1592db4547c52b759de30b610e673ab03c428dae147026bcf5682228559010bb932a585b4d2b431e67f00893e5722d61e127aa73080cb13a2b1d4f73eb66c0744a819b3d0fb1265f7a0c094b5a4f062070e3e5ee3cef456a46c35d1dfc30586cf87adbba7355e5d9217b5002586d3bcd0dbe75c7d763d48edad9e9d1f34f8b29415597da3a7f0a2529767c605aa91094d593a631a84e132e92224601fc0df6d4bfb68dc1f299539f22f49cc5abe060cfa9e391f11d0a937d12a5cebe71b6e679d27732036e8fc5288389b6ae6bfc74e00991c6794fc96ebfc5e607bdac8ad09ac751f4fd06b67d3dbef2d03df04b4b1b96867ff83552ad39715c1284526d2fdcf8b40b660c1d53c81c280a8ebbaf319edeb7928b624576520a3b15c08c4f5f74e3b5127679533e17835b2c6f4e96464c032a598f4f1827c10619c99f694e9cd8478997cfca50088bfde1379ed6cc975d23f2db2a3a2d24d6263ba0c3ebf3e372c3a82e1a513624c6c79bdde9d881ecbd5603988f667a1da1c0e2bfaf76d52b1de12639903a3c0e47370cd09aa4e38d609a8ad417b3ff6d635bf617ce75e19e8bf19fcad28d670991b2f81e8f86ad7a5c271dcfd102d940a9fc14b949b687e10f41a09abd226d88fe72804b1ddf0bc8aa04638f9213bcfeb07f841f83e452d5567bba4f89fdc551cfc012eb632a3412c1190e509955411f36d0e16c1ffa9d914db681ebfba88ba8d55f6e47843af350c64e904e8016a3f92dbd9946649b2c4cc1cd1fab888af43132dab058e3b124a372107102b0d303733abc7b0f94d61cddde8040064b71487ed00b34373ea398ff7fd9cd36b17a0d2afcc77250437087db11777b5aa160ac4a89180f6cbfdf403b097b9e8f6018204ca2295f1bae65359945c704762adc31f30552deb5fff4ecd8f849c3147638b1072e536b8279186c9d6524d4ee137df47a9639a43368a4ef1a32ac2a9d956ee3f36fe559904c9a10e6688766f083c21116c637431d1af2b9191feb8217d3efedcbd5cec30130551397615af6b6d4156100bc2d8606de1772029028ebdf672ecc6fe0ce5e13a8e8cfdb2b79f0cd7f3abd8ab1601a2b6c53a7b452773765ad0cfaa03801d7b81edbaa99a085d1723e82dce3b676d31e806a32e0be709c454ef19476312acb71fdb540f09a0f3562341643508526ec53bd456a55f9670fc87423b8ddc49a00dab47668b6b39318dca30aff46ea366f76361b2af221062f1b5dacd3f2094b3c7636508c936898f8da76b5f485ca0393e569d8bbe7221f9c9ab1f67a23283912f30c6ccd374f7677dfdf2309798130f18936e2f85909617a6035222de9ff3088061406194d646b408097ffa2f1a1bb4a37ec3c07345753c53317ca811bcdfd10b034cd8af47dc3015db51d509614fa1291d0eaaf7c93d38f4b282e50d188e7c042f439e3e2fb26790fd3667132508280174b7c88f462f1c6cafd9ae5a99bc84d3164be2f536a689d9e5b07a9be374aa64f2e1cf611512f7623bde3318499662d8e81b5a095880199d0256c8acffc210b9f5c808d5154c7075c41ea6d43eb82f458d1e8a83e08102027b2f015521c2593688ff0c698ad1c07d03dc3325ffddd04c87642edc9cef4d9057e77742fbf238c86736e622326c5e01237bc46575fbe8e0273ebde903e37221fe5a80e7c2250b45adb1192a89876888ccf6225436173a083e048d69bdf4601dbe0b5d7fd96b48a6a147dc41ed7a1f54dd5121e8cb8962e78e4fa84480555749d51b520ef2df87973e4f42fc0bd75f93209779b294942d3a000649d4bbfe328ffabe48669db5681ee7c0f02878bc36767a95c366652ff6f56e626ed908e53ba3cd23cd377d7c3d1975821f0515bb520ab0c55b975fc4a42c8cf4e7c07f405b116398d73428634ff057969697c2e57abdb3a9c38e46853117524781b4d91cc41b3338215d7230e6d3c22a178c068faafdafeb0dd797090dc462d1be84e2ed8bc1152b81f257a749da4dcde5529d77c4d7faf4201a964c9fd58ff6db40047766f7ca0483c0fafb5af06ed3a56c7c0e6c4f5be300d7c2501c3003f3db87120614e945d79fc46d9e72dfbe4e08cd7f8642db4251590ec4056dfc00fd911451bba0565d8338852f1e0f78dd3f30cd5de2c98764db74db1e6c128f24bdc4ea5a91bfa22912100721478fa4d5c16ba929411119ce4529dd6a51902cda5a5126132ec7135c0b0253fb4b1d740947c0e18ae190bdeb9a01ab87f7b04228e0bf2a0fa69b60e052f9ac2f1a37a02c3b1bec1d9274731191cf3dd8a9e6795feeba556c3d55dac61a1bc465609a8c611ee83e122915f883487c0ba1d038ae64443600e278d054208925b326c829ca46eb777768ea6744d6fd08d2166eecf21d86c1dcd5c93e5968246acde0d8dd6368d233f5fb2d29164a219719723bbad42d279ae3ee33f101dc9f720ef59ad8e480887913d44fe0ef33457358cb200782046896acf2d17516518c55531917d277da9a879875680df3d2298f0ba739e5e0340a5eec03ad9b4b31f12dec697b220e2fa44993683a16ab7f0d7264eaeafef48f81997777d304fdd01e39a80c2d6f834e7557aba32079217211ffeaf53249859f5d0f6ff0824ad52d20379124c36e6402a9999e329db71219b61c77913b80a8a9de3d99351a6eb954db79955b49f3bef1cb3ff3a27ec3fe0336cc2d409d21b6eaa906577073f856bc1209edcabbc83680983f7c318554dc1532730e3ca4d8cc6fb8652026f02aff78703d6811574474f3fd4adebb695fd038a0ef0a1cf0dd72a547962419eed8cc84e39ac93c43f41dcdcfcea709481596440d439613e043a19214e7e7ad3b7881891c80c98c0add179a95a215cabda21950672f7630e5c8a4c529f5fec9106dc72dbb8f9fbcdcbd8386e706a665509c7dec8ba477af8973980153bec862941b58d6e8a7e788be55fcc326ddcba1c1fa260c343f38a49e2e682fc37b7bb7fd6e71c815a4f68f30e3914166a78f8967f08dc1559e75c3369ece82cb2d826a723dc548f245005e06293e9a2e018e7539d6909fbb1e72b4860d38da1a6c470398abb6c3f6c8a32457910f9ab36146b2f52c624b40f4dc18ce5113a1927bbdb462d70295580cd3d4dcf3836154ba5be88ec3f7caec1d62a6a27c524ba6b9b9ff17e3dcff9a87a4968a28e16820da5ce20c305d4b4fa3e3793185ced0370ab44c592cd728d740c93573ae78f273555ae947311c73bfe7f4ae1caffc95433a1f1e9396b081cf67f1b2d85da4c9d55757169ba058c7592d6312ed0099b2e32f02fc08ec5b215046be469772967f975d3b5fbdc79210415bf56b4947d5bf5d95f84be07c599d20c7cc84a84860518076f7083e29d416e26194cb58e43cc4f6931c21eb35531d7a583243fdb29b3af5f786ef47a988e1ff4af8eacdce75a35138e7e3f656d2f0031d66ac6219653678893cfb66b245654421523cda3b45fdc59a82652d1ad3ecc666894aed1bbb05faa60800b5e6749bfa23629bcf6c0f84fb68233ba450b5fe6e19286d2df45d00892c6ab1139752b7d66bff3cc36b92f74d7acc66712772151686c1f99dbb4cea42bf5a64d68d397405480a87e082235802df19dccee13f6731da25ad1644dd89ba596fc6fa9af3215d539e12c93a1e74d64f777721127503cb51fa21ee4e9bf4ea09213e7e03681c9053d43c3b8dbfbed253bf6b8e5e8f27b364c7bb136ad1a75c33ed4a52ffd7a5bdfa082cf35ef47aacb5eaa66c997cb8d2db809902b1235b8f16a2da0210d1c2ce9311827b04673b803e3c354b8e7e9fb9ea0d46b49257ca64d3c4ab8618a82e455882eda55d36fd56b50e7b197054148b95269d396d1a0b76cf57d003ef31f8d95adbb49e79f51dc3dbca74fa7f5497c01102cb419b0d6896bfb28b93e17c087afb1b0d394e0197edff6016627d012976ae2e585c7dce6cec057a5c3001028eaec86034f422886c77404103ae6701f1750b70525268d7c7b71b656fe8580c85b21898afb9d3d1bc5fe3f43781c226449b7d0c83004c7ad32a49707a2195d861819d48f261b667d5b0058a5be7fb76a4fc6785ce6d9ea650efd50538b129a84963c041d4eae151c88d079af239dd931885e110c66457f9d29f2f2f89f3bbd77247b31b5f5e443392fe7f692bb9af70c4236ae7ab03cce88e09abd8d5c893be745f8327d8a533905bb7c26d07726c9303c8fc421c580a9734ae1fdd34b4549e0f765ce1492e67e70659ce8ff3ffcabc127dbbb1c1cc0282810b938e35189f3e09bb668072caf8351c75a3485179230a8abbe4e7178d5a4c0c840d8b7db27a65a0383f4b5248094323cc9fa88d0cb81e8c5f0f92b8049ee60a03b6b79c4d82fae8d335f1c411128b6cfe586092cb426ca49d6b861289ab4ef9d627d4d98a400fcdb3e54faecc4642a811fc7edc54c9ebdf17ab3cd96df1a9a2670cfa2851853df10b550f3fdc4cba1a93acc6fb0a16dab700f232aeb321788f67cab2474f650e338ee2cb8f7a598c730d4b091f38286ab6b20a778f87ba0c3a1f9b066a382cfb9b6ec510db96a0054592c4ff7f09dc9bd4104828c4bdb2b31afd5436028566406986f9b323193709905bf273d8a419da6066556f10fe1397107b2eb71974dd82024b11828ea1070eec52fa255620cf50bc20fc4443ddcb947deeff5cf3e2e92a74c85ed32fb58596675ca9fbab95b9d581779ff9de93b2e5ee9a67ffc331d7439bd8b68c4b1c51a1c0ffdaaba07ca643c89189324d5cc3f0b8ef9577ecd6c9310d1c99de01249a9673d8a6587f775d0a86f155643ffe94c493368b9a7bfbae9c427e2776630cb4c6202d90251f76e20fa950ef6e32994b79a743699198cdf1cbd9d927f43e2a6c69ddd39bb1e998db96409a96a82cdce788d83046e51e555f81ce464046ed08d32e7598eb3475db08baa02525ac24cf8a2b30e7acd8635dd91d672c9b3ba9c328341569c58ea97fb51f7d11b8811c400e79b83c89c85aad46014b2c0567159c78fe4dc03f39dbf77eb71913e9d623cc403295faf534608b713f89578f98be95cbc81eba5d2a0cadb68478265b39eec3664f0a0ff0486b08840a2ad034c765d94ff8bc9288e267df8a3e4496de4522b7aaacf3af103b3f9856e297c87b6be02b5c25f3c066cf8321922113ffb58df6b22997076fc07e13f06b7f35328caa4c728cdb4e59a1ece0c67d23d3d626f8333c6f194d0220d358fbae3b6b07c00b3b06fd82d1a8ecbcf8e12e4a15e9bde0c1de71b7a9060cbcf0dde59965fd4083f90a939454acc465f413d7b4f7b130ef6f2f61d3b229c022bd3f6dd99364b03adea8ff7fd3be027c63150a17b9360b1c083f84904d4b0a34e7938f5736a5bb510e73ff06e8c3f00f10c0892a85a76d1dadbcd6a2ead67455151c7365e2f7425608425dd068936d49635e605885b86eeb2d1a138cdb28eb70764446f1c35f428a4e1d5b41514d03ed87e3630a140a56bf07208ed7122fd7461e17ee2e084050dd57b21127d00d16264235ce9217a8ecec45d769393b7f43c232352cff8f02ca84da9d78a5a2f8bca6af924faa39eee8d90d2d2cb2a723db3e0066d8732a608c2b84fc358ea69cda71c6c840ba54d843368e52bf5afea73934cb56b77b911104b4110a0836a4d64b2c5b3b31bd141fc5afd2bb2f089c53a4ede532000a43d247a588f847d3a1feb967b1a2af2f7f1de65a7433283cfd33925030aa228e69c4ddbbb84a7742ae00a0406d382a97bf169e55992a519e485c01e5850da5819fad803059b7c0cdf4d16632bee3b98accc89a62ddf48de17c24633c98e712d9dbdb1842fb579e3f94809799bfa5c1b6b9d93fb8a87eef7c78d7c509054804d9bdfb25b54b07eb0757722753c025015bb28c3bd781fde1f1986302662ba5771930b535e9f8035f49da7c5fbf19ee002b5f43953dd6e3fd59251c01f9da6a0923891058b6333a852ac6a7b0737c53246355f446369915b931f7502c05d8aecd715d34aca3479d49f06a4f0b03da9005a73ace4ad9f0466545de160248aaaa9cfbd3841cb50df0b5df31b9b35387e87f7694c0334e026254da539f3fc1181912129405c164f42c8d506d397a7531b8eccc8ee57e4d7a07c0b6d247bf31e4395468f1a170541e2e648bcb8356e8c2ba7828be3e0c82edda4daf345aac332f8d66f7442e0667cf92226bd078c7914cf9525bf994b471b8ddd816d1b01bc91b29036955e5e7372b985537e60111c49cfbf4c7a75d16f2592f0956f1dfcc73aaf5eb823422f16f0e9d390b90feb41fdb4a378df9dc34c5edbbfb6ebf7c612a5832cbcefb313ed229f548fd91e997547fb0b1a493d332dffc67775502d9560b8aade8455f14f93047cdef6d7445075e6839cd8ac4c5f07d0f21bda787d87a1ffcc2275cafc2a87b7fddff98f1e749fd0449ca000e0d9c10105a4fde427ebcb67dcb1de83aa331a94491650de639a208ca193432dfef7d900b4509e1934db0124eb024798f1c495578a57dd79af33068bd73216b035fb3ee453335def8f5b06af6e19e8cfd3286a997c20992e868eaf0e36a16e5a122bdcaf83cb8a79e98ff0afbb344bfbf3ec2578dfb6c939296f42001505e8ce76d6ea123c3192310a9a3d1b2d48138f3ececa813a01c9126fd2eb55be48251d607a3b53a23742e7f92cbcd1ae8ccf90c7eb92c54fd4c19dfe453d360cedda602198ccb4ed9166751d834bcd7b8c6ee8b25273402589778aaf756dace614220306e253c7f2a45aa05c8f1d958a7ed1341ea4c7b6715ec61886da2ac2da381902f27f730abc5146913da62a34679382bde2262a93a8665cdcba9d86dbfd5cda18d27f0a428dc922e378ed8b7087766a336bf5a2a0409316e4d573ce4a6794e856cd9939a7937a89b071d6591834c6f3b5a4895dc8874ff516822df5be3c8eff17528b4038c5ea1c5caa7e2664902c55bddfe38cb750dfff9789040f5da156fc701ba74ab294f46a18f30539970b3401cc1cc6289dfc1436a5f725dc9e4beb99f22c90e76a94b2aef5399dd8ec178ef485ecbba9396b47f5d2972268e1134a1caea10b71ccdb6fe469e74ec48034809d6f0c84d06445dff43321a76c31cda6324bb41e480646a476093423f04444dfde1e1ed0c745369f8c56d65f38df6972fcd3a36281f3d5dbbca3c741149f9f24846474245c11da0b881248f121cb04826eb1953087eea1ad18dc82b6c8302f55f4a64030ddb7be68a2307971798219d66ee74315654f6008199e4d74c0229371d84a93fe241fb370a5969f03762e4886116821d8cd542db2e0fd9ac2569103eb7921346d6e562aef36406f83c65f770923ce6f1790c90996bde234b530005df70759a5e0f575382eca9abbdd9cfcdfc36c7a7ad4a683ed13c7c1f9a13f725d4a34a15124e203c9fc728482de59666126376236c58d5bd9e1cafeaf494339c749844b0d52f0f8a1b8c3e3936893ea67592638e93b3179cbc0db79c1294ca1087ee76f8ba7ac94659e1f03b4c9681ae9648792f11d524022d9777db9217df7b136e3484c70229333bb47172c90974485cacdefdf0bed9280a12843e7e41f0e9f45b2d0188c4f77395ae6a47ab6836773788d371bfbe6d49b2e5290417fb6eb4bf7c23129dc8bba69e345901f03712e8ea43bed0308a68991213a052d22e6fec3c06844021a7d55e3b26d22b568f267fc9528976659e19541fecfde37fabd0263fb3960fb6f20daee7f763a518b24fbb7c5f32fda2c57ead96e6bc86f4977f10e02b8ba4687e57a20a930e9e6bbfb97802007edee198f1847f029fb8f39fd3791b14499e49e28b59b5ac5fdd81596644536f7a5a45855364aaf89a4b9b9dd00244d4da2082702731a5b5388bc6e44fba49fb783d7285a2dfedf76efee5a5b80d938b68b4a05746dc3df9cd00b40e29d4a5066e0115e9c4d59a20b148b753fd23c7f5f5a41557dd50813345a81d9e3f0dfec649b0b6999fc7e36f104076ccac3f4c7b4fa2876a44b22e86e28556373a4c0ec136dfb16bdae47193ce2e978916d04ce362eaa9b535952a7c32fa1d16ad3cdea3137449dff28244883e95d869672b85e115aedc245d40594f385af6313c4fc74d596843014dce925315e7883aabeb1d45eef66340a86160e0635790a5ac34cc52ed323980e7b8bbfb610da5cb80326dcdba945518b722d0b9930a7d49b22c773ad6e7e9e6b79f841ec55f85d610c58086061cae25822c023326d1ac5d598f1decf268c5d309e35b2c2e815c2e6aec4d6dcac94439eb25ce1b2b3c9b075f46bf0528985adcc8553074d6321bd8b2b2ae6952102859fdd247b35101b1dfa1911dbdd60f01e3ab8545b8d5cf163a02f12fe9ae1c17fb379e4ae39330d42585cc3cd760d9956e26d4c9375420bcf5129713d41b87da552275f635b94e367e24667baf1ab8731450f08eb63aa66758bd92c8082adeaadcbf3b44a6ed6cd31729d2023bad430ca2918b3261d4aaeef127cfdcad0e9386650e087a890f305d83782c4a8ccb2b5f6933a22c66766272443c22ea3cafe4182a4c399335fcd07c477ff22f6f48267fa93cdb9c8b768ded416716c3c3564de531c9ca4ab5312e057ebe2d66da9c38f09e960885317a13d28bace03add92d9e00ade5ca2056e08174d5779b09c87b0113123c2e95b987c263b5dba41c143093b0a80b4f0ec62c3e45d960723b046711b519f7c3d8837557aadcb8d257396c1d7a6194401cf223643cd821203234ef8ffa2293d1bc49e466ea3fd0016a65d6c0573dfe670fa0d4c4815d62f02db263d2fc1277d2c7efcf1e583ddd7044db6c820d7dafef99f72f948e15e404a13e98b81efe79b692067b36ab5ea4adf3215b25f1e059801f6d1ca52d3f8e6971d28303e48346e098769d21164898e22cdd44444f89acb2f12e299c83753af99867ad0197a1b05596f06a20bf86b661b17783e58bd98f9ad9e86b0769ae93ced498abe82a5302fd592b1749397694f80d00f409f3310dbb9049b0ab93adf6a8dd86b1c42c1868a8b1f51c98779c1aa543657af5ad80e7c1d1afc0e315489e33c2d92c9d9f7b57911fd7c3f42336d8e6f393c124c6e6f70569e4d51b629826afdc12488a9d090c2d5e021c6bfcf0eb105c9248ffe4368058520787357741c1c9c7e387dfe27856fa3a0dad9b1b70914c2e99cc14214c2329ab49c7d01222d1c3c8202984b6ed25f0ca27022af5de3b5f1128d6d9fe45d520614bfdd58e6bf1ef07e21d93981fea7ed189ce1e7d8734782395778e92d9810915b4481a25b008c084893afb8fec1fd2e7feed65f6451cc8eda55959568436d0e1ea4aea1093acc07705f826753723047e8b878379a1f3251df0755ea44d9fcd40c6ce96233ea9dbd054ac8c288b05d9ab907f29ba12c5b7dba1203c553079dfd019a8b629c9ece069bf628bcda8628f1c9cb320d5eb80242231b686ee3f133ec64e68524f9ccaf61a0bfd5230f6a4bbd0963d39283edcf90df88879c1639de779002e550513b7c03d6ac1fae5f384bc582aa8079a5b9afa471a317f87647f47b2511ba1c29dbec067658b0991c6b0682715781902f3b2b3d15a83a5814a169df31360a267c0e62b03a7d66ceac1ee2d11db645ca29ac222e8a11487cb3fc5e41d7ea8af49ef254b52e49f7d96903ab5ad0282ff0161c3a112b209ecf4086ae42dcd31a7748144eb89011d5a6d9581b685175123eb5c529ac9ff02cf141e1f46a11ec29121a3be5551f6bdc016be9ac92ae957bfc3ceeb536f49fbf8a362cd5347ac905e574a5375a3376d63c1a377ff09aec8bc2ec86e7fc8709d7d8c76f78573055e29706c16603abafea6c7a4ea823aee512675e1115d6f5393e07fd0434be36e3c7034a0b44d47c559ba62d751a1d1d99d879b7271faaf12ff1649bbb969295e12b113d7fcd3b096e15679243148bf462267f64e3e1972b5f2fea4818a4570ca80fb2a51cd10be09ce758eb19721983d15323c078046a807840936bd3cc1206b4110d468a8541cf37469d5e86bc620e45fd5140ffdc0eb1088de47fb5081b156cbf3635ce75e5b20636cec7993607cd80101645e6bb5cbe9fbe7c1a2ea113b497bae93bd4e83d8e3f67106815e6aaa5d0248472c4e3af363b4d4895c5322578cb84158e94b3409be49ab03f42b7d00bd0ca3386240fd9934fc46048ee49e4054ff5e6f0ff0935d6155f4a7df1768ccb9a72d32907c4c339f8c93072e216151ada430311d4f2f42098c6882c4f90cdb07aed68cc26466cf727b8fb2dc1aed549133238082d03241ab9a63450f843ee8e8c211a977095861272543dd5a199330e8617eaa1d8992a5d72e24c5dcb8b34fdde70d42124833d968911416fdb2b9673d4c0c1cc2219007b4010d6fbf39a6315bf5d8adb3c0957ff30e1fbb6872588685f1d37008cee576f60112f3bf4d790cb116bd79514c92cfbc0b1bd886065eb390bf047daf11a847bf68f24c8ca5521d469dfcf67e6bb194de60749b44ffad398f55e3c15c8dc6c30f3dd3ac03bd6b7d00a0b9ee52ce6633e4c88848e1217aa7fd498b668906da78fea6b3683310d5399ddfaf345ed6b4a94ec4fbc0679ec1858bf42324f070185d3fc09cd3aeed082326781777f687d82573e39d5b36f97d22563d0044fb97d36c114eda122d652a9b924495dde72cd37a9d6cf3880f3b7902c3832782b3929c4b1e4feefb8c7867f2c371ed674e85e13cda69a97770f86b2df137478fb3b63d6dcbdefdb2e6c0d216bd6fd2d3bf1dd07d0a7926534239adb5196173c96d5e33aa260ca56eaf40a01a0afbe52e9b7b57506ffd8cc24fb854b009054855b9dbce69e55ffa96d41a02b6f808ce280970fc4d65991bd7b919dfec10206a4b9f7f9a6ec1da8cf62f299783163d7b55c2a22e40b104ced9ad6c8be564453392c5ad5866c364c1ceeca2114e3f752760e3f3e9feb97944968f3d8dbb48c8b629156358c2bac1047f07b328084ff682473861efbf42ef9fe744c3f4455f0ee4509750641cd01d41bfe2c330156f1617c6eedffc12e30bc8ddf1020b8d2a5b5347165a763a531b8e1fcd42d57c7c56b4bc501dc43c158af5756c8d49a8d8be8d0dcab1daa948f053ab3f40c4463f9eef1b56fb662593e6e3b17efb76fce213a4d2e681d9017ab4ed0ecc798a58f811b76f8bb0c1433fd10025c9aa402bbe8cdc7927ca84cf483f502859d9709cc291563075e156a80ba68aac6d8cb87236eacba385ec07be9cbae8a05fce3e0012f917fc5a2361f767a17e5b7abdb09f471d1fc1199b8ebbcfbbd29a5c5094fa5316a5ff270ad9129983f7e3f5658ddc06298c06e035b1f21a999ea77f1525a7d0ef8b41cb0f6e508f8ed61dd2ae01beffb4ae5e2198a2353e8554b01dedd9eb43bfe430c05eaef07902b2d98f5ddb6210d3258e1046a05afb9515c38c7e0cf144ed0fc6dc9a8bb13a9847b07a1d486ce9c9b183d08b05ff7740683edb2833b74d11f5628eefa2618d35ffb065144393959cf942ab6b1bdb7cc365dacdf8fb0c820d7c78d03fca1f35eff588347394ba4325fec5a40f0ad2cde9a3732a3ac08dfccf0b720254a4cd8688ea9ce6937e22f6d2003e388167b1e1c7609276723d27d128323cc243926434993a94f22de5019300301b7d8c7a78949cc9685b8cf930bf0b4b4a97e5bfb0f571eb0245cfa5a3fcea4b961243c7cc83e8ab4a7347a8939fd9767565cf1e5a4de7d423c4df3e53bf5de7675fcc8377db003011146972fbf63155bd5c09d08cc496cea4325782941987149fc91bba911f7e5b884ac4ca6014fd58236542bf7a09278f4e89591d0d5ba44173cda8fd231c2e267e53b11f96fcd904cf4cbfa803309bf48f87aee0b7e85570595f3c0e78d71be1b6e54c3ab5905c1d1565e099d185f141a2746ecad31e8b6d7824d62ebad1f8884d768051930d5b14a64f8f7bc570ec62816ad175e949083d5a9436824a0383c43fc990f101380b724b52bd8b88640d994d5be4a60612928eb7153a2b953ddae35a000955dba1c9d09ac5d0bdd7b0e218272efa9610e7392fffc84fd5edd4af2cb04eed98653fa17583d003615c0645ae633c807415b94c834e548fe5b6dc51b8c9a977d8d37e4fcf19bbb53493059e1124f3e1a298c294c229268df3abab1866c3a9d35c488c3d9c5ee66146ac8e3d3f5adab7817acbddc94a775b240143d40fc89feaa09ac72f0f0277ba496f7416bc2648236eb93559a7d33ac9ec6ed1a5deee311630a9015acbcdd365d6f473b81763bb3ff4dd335c59b0d42f565c461faff7948a6dc8a6814979bdfa658acef7c92bd3917d20f8cb19f903e399114e6d887279afc8601313f5e01794d677eb85e0b1f16c0e3015f51276b3de613d94f2b040e4613226129be5b7b65dc9addf61c29412e65b91c999d666841e69b75ce823500bebae8bc4666b167c4364489180a7a9fafff1fe5cc4010b7eb4ad916476974be66fa0ee437e9fbc8bc7f40b850dae2e88bb250d1b96af177425e8753a4db0815613870043f1e71caf7cd008f1e98699843ac24980bcb2ed128608a2dc6495aff5b59fb4656702b7a2b029953461c679a087ed5cbe262d99c03adcf99c4db62b58258fb518e8a3a1a604b7cf57e7ba378687c66e6b0c354859044e835e58f03edfdd61ea51520530e623bfbd678b935e9a6e0952a759dba6b6999b6ab2da96f648a8f8f03a92bfebd5064f2a09b3065a8e3ae42c5e5d5cb7e679a4440e31bf663da51b32d47a589f15d63db944ba5566f93a7c9de37062d62d0070339bc704a9e5cc452c2bbfda5b9e7d2c1c4bcada0eb9e8d0bbc6e9e17999ec93cdb7b06f89d8ae11d742ef6f8194e801fdca5b7246b5fe202d56c648139220fe042493d7d1bb950c770370f77b6103f87757ec613d1e322ea16a98ab1b419b40633f204b90b356d2d563002728a92bf53ed98f77bf4f14d4e581a98076e1b79456d11ef21ff822d295b1523e210313c515603da4591859b7b9c343a41236b915abbba8ed2d3b93eefe8e63c3daad5e6e62104d7433bf4217b1ac023ccf2637fe21cbcbd118f4cdffdc5f9c714e5157902034aee9fb00397dbf7c7a08e61d06fafadb54602ae3aea3b1001e496ec93f0e5a18c2e5d79ba827bb05e90615c0cbdbbfde9c8ad1fce1b81f8e6b20f58560f46fced3214cc072b6b69322747ace70ec1cffddf2f026d62874654ef07fb60ef92a8ef8648a20ba2f2ed6c88c62570dc9f2e557b9182b6dc628e5ca65687176838db668f742301cea751e577a95c8ba4923db08a02f5b52824e2df9cf609a7200e9630371ced97c7d9b309d7565baf390809a0248848e3e79315afdcd7bcdebe5ca9ca3e86e72c23cd869808288a9844a88809380513c0a66a7de986fc2fa1243f146e994be26805af020ca500dca519f544486c925ce8317d5b89a42ffa3bd53da79ddfead5cf4d07e6b06f1b0cd97ea64f7d536673a28fd447b95451f2b6af4c28da5aaee422446b47beb5bad13ea33c51a60d8285197a6320a3f5b2e0964d3dfb5e2d26c8af8308555cedcac8c6e76a89e8b7a5ed5390e6feb5f110dc65bb0b6f5c323f65ada588e8ab068c4e9bd878ac62a508786b8160079a4a9056c7c76b6d1fc8289158bb6d8ac4f3e857373b5e21341b030c300892673c93e7b665b4d91fdbe83df135eaed6b157e5e492b0b7036693b6df4d908f1eb1615f900e0328e8dc8c7d36958c1394f78371317f527e828b8d448eb56cf4bc5a3c5022b70281617613b3418791137088dccccee93ee975a54d42c1b0496bbb63272c278e74b0e845b0aba34f4bd267f9a241c1895a06a6468f2eb5130d0113cac02b0935c51fc4ae6991fd4b9ae313d313119e22505931bc91f9992eb8ef674226993463648eb8e2ac248419163783831de0cc448d480af00d9d02237c95aa36a66d518fef96a7fa9f0414005aac25e7f70280640f93bc9f46d35a0a1e78043b884d7fcc9fb3c9c488c33849380a4c875eb605ecf8cc73308e5672f9584d44aece5298f5c91bdaaad12b7eb6bef29e5e14c84655ac4f42d434ed0e33ad29b98276cf06d98b73f04abddf3d27576c6330257a227e26ec452a57df972ab888d7bb896fd7ca6af910325242aff0f76fe1211718c7136c7ac760b30a305a0580aa43eb4b292d94b59f81c8787cbf25bff97b50a4913a40c1f5a0562ad03811675bd713c27d8077ebf8a6d13efa53d7d7661c1cd723c8264dc118c4c387e5d50737be5bfa2d6f6c339691cdd68af37586b6ea0f3c7208638d76549687b01b1d094694257542e16312e0033f2c291b45306aa1b1fb274f7f6483687acce54b04187822f6919f80fd16765043fc7aa106f0d5284e9a2772c2e8f3ff922707dd40920463874dcc88e1a4b0c450430f5b6727d098130d1b8e385034afeeef6bdcc04f8768511f1f07838d8fcdf984a13a4c20d1cdf8617e6d5285a02fbe70e2157a82fce9e5e2ddeef0b8cadbfa1c9e062833f2bbf0df4f3f68e38c9bb7365097a6cedd2243022e09064252b9dd717c192ed56714f5ca29c27632f4bf2767a40e2d991a3a120c4578d2a02d7a775df722a492d78b4d02162a2693ccb526804fc28b3998d6c382cf17796b8c7f6bd35839ddf4552efee85dfaaa5e42284ee86cbd3f4df1e7cc6ccad7f0c46d1441482e38dee89d2eb5d12dee95f0e9364ee6734af529dde35ff112f69c53a8c64296f0f1657d43509c8237f99611fdc863dc322f3131998f00895a8b41eb7b3a29bda2cf55aaaaa65a912e6a07248cc4153f8410417460f843f5c271ad15651453fab0f68a007016635c1c88ac436046980debebb23ddf2fe747b7fdf7e2a6acf2e0c7bea6b480ac7997953a89beadc4f566e019701886906cd8500602e4cb4eaf10fac12f69fe18b820ed5a178f9a19780ae8a2610a24e4c5aa5f4326ccc3f5036acd8a2eafe8403eaeff6b3d25b3c31579f8d68dbc5225922a7e90ef205dc70b6b06077d23d5a28458635dcdd67ea1a9d10b804d80a24eb52664f9c1aa3431470be4a8e7e087363bf19ba123b44153743341506ee321359093c30037d8cc7769b037a2cc4eb250d0f397bb4a3dcc6363949aff81e199963c2d5021a008cebd210599a10edb59d31ad0eee7425fb0962caf276434f02ca9d088cbe5082a0c3fa2e67a3211bdacdad24a1eb14ac33e73137bd102c2935318152bc9a28721c3a44d43c46b45a7991383cb59e9e2f34a8819394747d3a404fe8ef01037c90525087f5d26edb6ec8df4cfe9129636d8b511abf59752160b585fea090526b975a423a23893bafb3b71f822504214c55495997934a0a4a64175c71eb1fd3f0cce2a7bba5564a40c494209bd4bedb6824207b3c050f85e43389eaab8008ed99e9de33ce290781e823a341fd7dc5d958bd92d58beaf0fecd2f0ae91bad2e509a32f7f8edddd995cdd337658a8e184723d277e5e4b98c1b39b3f5d40abbd19a46c42db8872d19b8833d20c241859448cf9280af93e4522349896fac51415ac6abd509858ed5edb0789ca608d40ea39b6f69d3b0287827c35207fcc624a8f2b5aaf293f050d4205d8a2c5b9778ff401d7fdc9c9b556573cc2d2b18f8e574bbaa81f7e83122b2c2982eb5a8030a9383b615aad10dcdf0799e94b3fb25610aa5e3fe2dd09cef620b7f69457ff38e874b3647d39960a4802450711e420d03bb4461544fa276c0c18014555798fb77befcccdcec5f7f34b3ed23080968ebee98b373094ac3c96e979eb9c5fa734f81ad04efd651b958f2148f426a482bb64d27377da3f9d280418b9d8867854c0abb69cfcbf36695774c3ad17d48cae792ca42270d7869686a0b9b5b6a0bd850add221b9bebb784f287276ed509b380c5833fb3794fcffc561d837004b076a2948e47355887d9634314f99f037f18846330f2f5fdde1cc8183bdd6ba3133bebb23b07a436c31c9898f0adf838a9fc46ef1f3ba301c6c13e2ed8aa6cc79c1811ae0803618774c8c750eefc1aa345ae034fa1281465fd1e0c2943f2d220a6f7f04a2c9fccddbd647f468891d72f64f48967d5e9714865a8d7ff187c8912bdb38ec43b9abc24e0a4ded0bfb7c401e8efc1eebcc98f3421e15332d5a01a474095bb6d71397a261d46a0c23df0f0929add3122c7836256b22eb38d029187271b97be2537e162661993bc8e1d5d67c5f91c3abfb11795b08447e2b0ac3ce761e6d12d160d29fa77e09d98d7bf039f1ad105eeff4e771a4e06b79c8a44cc46e1a3fc5f8f264edf5ae56455b1604706aeb153a33609c9d67a2043606115e73decfb381fee5f125ae6fb2c9d0bc9254f006455e54f04f7661acddcd45f8114004e083c43d2eb865edab45cbd56bafff2a437ca6d5c59142d73f9d3485fde5677117ebd29c84abddda03ba7755d797a1a0c235238d4ca9566a6dbc6fe069fff383cd95a1f155009ff47a6bbd3f11598033e886da90e0f69985ca4725b19a6ed436e84826bd420bfffa33b60c499cfd847f5ff317735e33a12bc157bf3c925a324a48838ca061f4f6d89bcb6d647e4587cbcdc7f5df1e14a48f078077426d8a437bf7d2c5c4299ae64676fdbf3cf0c3fe6ec5f749a214c179e430d8cdf4235f04e5f851a5e498683ac64152e912e80e0e1d1ed1ab6f7d42188156bc676429b5742a336608690eff350bbbfd95193c6e200b1bdf92af61da189612db440ba6e37c9b490d90f6d60083f4724eddfe8ddcc4a752e8df29a9dac9886a408a0c55ab90d0865f64d1616879635f09fdb9b00ad260e4cb7a2aac8b2a63d1169b9bd90ab57cf9dd196429c2f2a449196525f3fe0b5a316c700d5cb6524bdcaa5320e94a918881b06385cd8b45bbed47c4c278b29b60cb72f45dabe39797f111b6540dcba09beca2433a792acc6b3b8b7b0de0413e8162c8ba021b153aa2abf0bca3832eeabeaa23b96639942bfcbc041d021890c4ef8534e9d22bf06d8ee0be95a91cc40356b9dfbfbc9b34097cd56ba960bf0a8937706fc0aed3e369f2533b8370ea9fb58eda34d43dd222a84c0b3c1ba48cb789755c174fee5804f0884731b6b615f0c8cbc14e78285723306e9b4d5a589e74e15446eef141a182c081e76c395c38d09e3a80dc72c68987c94142b2c539939fab3c02698c13d4b4585e560a58ddac4828d79b56a6738df685bc6252b6d5b383d8be996a8f8c8e6574ce927fe72094937c073aac8ded46757b8d7dacfe8b6f2d1fe9bbb8da7066d11af2e63dbe09bc36f2a7f96b9aeef5e3897243f60c7074a120aa0476ee65d7dbc17efd57ab0c5c7bb7989e605105d275ed98b5f9ed9f6c6e60517fad89ed70901d4f0fd91509de1a64461eda1bdf0f16942e7c4e820d3beecbdf508d9910e002d9ead95376b20094a4a0cf47ea5913a086a0ab299cdfc153f6d64a8769da294e01591695b9845988b75961e05cdd762638c7ca40a3fcefc0b279c51a68e008dac4fdb28ada731374576af8c29aebff481b45cec1326bd455ddfb45a983efc41df481262c74086dee2a333bb976ed4682a583fe1164455d2897a70c37a118456d3cf91bda52bf1e995ebf1f4ecadcbe0277f64eb7fba245506092d3b58788229d90e581c92d0f80a751bebb783e4e46470b2e7ec73189a4dad27290019f1508f17d1cb1f37b8dfaf51bfdea097f4376858c2841e9e09a66b696939723c5859652807f4235c8b342f4dcb1100d02ef1572ca2e5aca869569aac4f28bd991a4c805ea97a93d9186e7b2aaad19dd0b4df6524c2cdd3f821e10b5d37dd113f7be818ca1baff04408ed7ac49f7d4498f66c4c949e1f20d47898fa6830de49b62ac70926e58eb2278ea32995e775b4290dc5b20f3995cdc06c063154c94a66e092c257b85cff88a9be189e7f98eb0700d1cab0e61a33b5da25c47567a554325c2d80124d0204295df7657acd6b62dc766ffe3a16d0c1396abf2a34a51eedcffef8cb3c0cc77e839caf4856d6f4cfd228b5dfc5dd529f92a2a5bf242e20b2f4147511c8cacdfda0f2d6b561c0432a4040e7e027fe9a48d00df6b63cc8179b5c13dcc6ef1917e6c2254e8f2b28d5538593a79f89a53794b46af06f287287f26a8e8b1fd6b40f26ded5dbb479031cc647d1f9222e9b2f750f8b1d56ac462888e491a5f15ad8f055efb15a81711c1b5da318e433c98f994dd223a8af472ef7fa0a87c73ba098a2f540ece69c173344b49f78718e781f874fea12640b780e0ebd741a8f455ba788b9cce0e6c5483857ff0c8e1e131c136c1c4958a730171d86c054fe5cec5e5c1ec7fe0579a2ce77549152829b596e6e6df3425b6827272b7de41ef0735a0ef2feef87882022615872d99643f28777c44b8f3508140569258e76cf88da7bf61ef7a1fd3be0b89abe84b499fc3fb2dad664e481f353ff3af9e49b386b3ddbe82c927915560b146891e27084d1915a34b0c2386684133ea41e3add5e342d1f0d531da7cf2290f75d6d87cbcb9c6199ae02661f68b3be5a1886821e12dc8f6fd8a0cd2a770b9d27a811e2cf58338074abb2f8f60ae30995bfb08da6affbc609c55295a102a480dc28a1808a3ce7f0d3fa08f580e5996eb9bf29e0405cd2d9443606e91b1b5f33e7463257de553c29234e4f9ad440203787c2d5d1eaa41042487116e4cd55bdf2f86a4bbb57969fe6a374559be8ec35530d95747fb7dd2ececf67320ccdcdeda911e2683ca8ffd680bbde0a1fa7e4712b5eb739cb4e430045c3c8531ae5c4ff76005b4995b7491f3429c93ef4f63eb6d82334f93688196ee1694d8d7fbaf783a037d60790400dfb19138f2794fce6df5dfbc652b6bf749fc97bb324924f4d8caeb8a4257e11ab514d2c20d8e62020d75a9cc14bce9c9a7f6707d4efc6f5ad96603d174867c69fdeace00b096daeb30735d51fd253933ea09b56e786addfb7c67b1a8725f922c527b1f7d481c05ea2b5851d9b676b584ba5323d4f6407d7e3009de23f842fe878f8a5bc5f776894ed143ab05d87e421636ad861e61a153ee43400a93cd234581bda6174ebfafcd9d7d0e04d4e2246c782203e6dc4cf2ded84747ad2d21d2260f742f6a67f583e2b5d23db4287f67dbeec6b6c6625a38e30ee42d10ec0a7ce6f6780277c1a9fa75f364ebed648bbdbb7b4d60cf6043600fa961963dac40d57c040136160e42db725a1a8637f63d792502e4ea71c7ef92d213cb472e26e31e24bacd5cb5a1aa720820c47d4abe0b1543b48e77e2abd11cf1cdc37e991bd01356e4f3ccf4a73b7d237002760fb6ed5bf23f701bbe4724f4e10255356b64f822791a30b3063051570f7b228b181a64bb20ba4528fb4aa104d9928e6503192ea99066270ddcf26b246f74b60a77c9b047b6a33287c345382a8d38f796419435e195f5f9751b570a15cbf0c853f910c7da3ed1b082ec5d4c46dfecda248692505529d1f645329926f7fe8f3ed85150ddadaa956f0df3e05208e7c3ee1dc851dba039aca03fac80c07f7477d21e84f96227ee2dc7252cce5847134c6a09e929f77b3255b80f09af2e3051244993a55ff97ea2318f363948586ecc788c5f2ac413dfae7bea2bd4514a418ae5c884cc1ca7b57d96edcf569c97c375dbbdd4ceea167d94dd2a032682d6bb9a19cd42252f152c93355e4ebcef4befa985fe8535ec95320ffc7d531ffa7949332ba7d25f2e0cba3ddbf47be4baf9a33e3c7c92e4eca4e6f67f1115f031547a17c77c6fa3dc38bf66fdb2586d076c72367a4bdd51d740cb4c4f7bd0fde3f4ce77a05dd7c84c622a3a2e8f46a1f96f52142ee18606c15c4dcda7cc4de4ac2554350202392a6102c944cc051427d2a7c17c1468429bcd9e061310e7d4ca47ffdfb79ad14c5143faba21ff2789025e0fe529da78b1e898d76dd6573c8e8ae473331e437b2b8cb18f7f21355eb756d1fa7582273f1a14f80a8d466b812994fcd9318ee34c17cc5bc723693fe2ced91e712c1f627a7dc16f8bdff931695e6e1650fded33b11adb3199ef87e78c9380b61e60b9e823d95798df0c6200d03e7c19c2cca086d2905b9ca5b3a7091c25dbfdf29b3a3027cfa4b97172aff67e2771a06e705272abb95fb13d1c2e737f4e884bb4f9188c0e4e5986c843ae66d6b7b8f627a489d1349c51d0b96ded67a3cda25595938145ec2fad09fdb3d35bad729c06b19b0d93dafb9509cc1be0028620d20a0c61db8eba03eec63aa6bd794158e1a80232d72e664e5f6a8e71f4e8ff8b4ec81945e8ba3dd56c7691673b7d67c6f46cff9d0aef72cdbfca87fe647b96c78e44dcd0633cd0459c9692a2cb51b5efd4e9cfb747d6660a61d250700ccc4b254ac3d411d5e44cb5d232781ee303f16477d7b4cbce2c0774ee84a4af7cb7cbe39575f1b13c78a26a9e752ab61ae3bef9258ea4a4e993e6b6b2b8a315521fd9dc8402107af0d412e6cd3433ee3d29e6768944100ad456ce99ebb1a3b0fa0cb529e7d64f66f6cf78a5859418b1a313de254d9bcc0e9fc337496324c2a65c5f1c9db03084d81690912ee98f740a761737274dbd0172c2f570fd231deabdc6b67308f4dd977e37972c5928db6f29fbdbf0bbe4508c3b3ff571bb8e31599933cc161cbad66e7fe42af2f80ca7249c665868b46648ec6656456340e41bece64169f610794d7fbd11d1b736630769840485bcf12a4796df446ef32cc6efde8217dde6aad0c445591e5e3d66ed51df37d06f031add9d528974d816e211aaf8a16087243b81bfbbb509bacf06d28175e496073ece459a31a6cef27dfea4d18a4af1e6e25915c7dc91ac4d5eecb842edcb35deb3e6d7219db9a53d7fb1cbaa2298659a4ae4d22130a952c18d3e97a7107108130cf352285d05d9246756f7d978823082be7275cdbc4784b21dc5d43396b3d06e156a783b6969299511c4e0e134fad45223c0dc9662385e3ba726b4acde18f08bc077330b26e65e6ca6c9628054f697df7ef3251c510e94a0bfd1c70433ac6923d5594d44a19795d1ccfe42df784aeec7b81741a612dafa16350111c9a338f9e8b4d59f2e554267118e3c5b1fa3d47c1cccfcaba4dea88488fc64d8cef82c7737dbef2e5d9f5dcf5cd51235913c83a168d8f0694ceb10d15165ef35f4dbb33c31c321e117ac4132b67578e0ca8a52ab85e986ad4518f7a3cd851b7fc621d77cd1ee61448eb54553cdb9a79a28ff2c9baa9b4415c2f902a48af2531b992428daba27ffc1a78a0025dd1d22ff6ced80c93886218815e3b73565b40152a7e9c507f5603ccf05dd937936483705d135e2150d76f1a75c780672b328a9df97f77e8045b5f81be505a0bf7aace11422322ef56f7f2c5aa01433c2a39be6cb99a222bffab0afdf7a38036f8ab09412e58824c5a22105edc4d4cd63f58aee002e83f4475e275c03d6b3fee0698a4e54f6c8e25c6b9208146ba528e7fa4ba04e0aab45841e78d8eae0b3fa8b1850e208e4932bf77268d8428e74913ae59b3934033f30d122e06eedab90ce6db6e15c417a69db112fdde6776564fce15fcaa6f2ba78c6630b240a67b08056c50b5a8e44910a50ec7c8fe0217a060a288c6590bab0948e68bfb40c8d188f3ba661987f53ee6a8efdbe76b67d2746996dde3772bb17acbee78f4ec3b5a1e1d863b0741978cb57c057a77704f422a52477ca466394fe5b1cfb45c771098e2bd00e651b60722cc32eb0e9aa5463c8ba49755a5f3db62783e32aa13cd24544d940587adccb519d960bc3d7574e38804686a346707ca2cf43552e06aba286f24d771e59dadd4829ed3448d4df053f6ebe471dcb1cc35ed2e7fea0e08521961ec57ce96a59efc07f55503de034855ea8ef0b34fcad366c7d8921cbdb146c60a241fad47de4a16b2565da8dce09b9e12e160705b0cf5869526687e7e9768e53034be2fdafd7f1520bc680ab67444e962468276dc32829005eac48935a6d8b5094938bac7ed3058aad012b80d913b6d7dc147c235dce2eb70dba5fe698e100c8a622fe3ab874d2aa8780534a311f6ae0bf758c4217fc7ad21c57a97b2c0278ea7120c85ee918eb13cf5a60087a927f8e090b910a9ba9421e489c2b4a8d6b4c2919388855002c293b2a323a2acce2791ce74c0b945bbee5f99d2349f5b56596fb0054e1e065ebf1b573f92f61090253aa8cb955e08b615c2cf24149f381dbca5deec56d81606458fd9e57a910d9c7c3c67ff0836b31c00e0875c5589471b3f409d99f13e4299745000b4c56be38c769d7a4725f7f7bcb63ef622435b468e23eea852e35c8a791761284dc4181abb0b6f3aa737f093e95b25c4ef6d9e24ac089dd5c7320950fc97acaea61062f52fe959d9c13f6a19643e2f49d9ffb58881f814f7c99d38d111f8e7bd4315cdb11334719f4deb02653daf020c9c59ee5a9d746b536f17bebb18f8a9d7877dffefcc41b727765f98262ccb7c29f4a60b279f4c64cc9350cade648eed35aabe9cfcea0904710b71b32568c53c3d359f103dacb6bde2b64a3f29d60f8640b0525aae247c0d2310050dca3289a35568a294ed482447fe82d54f8546458c8cdede45ac423295240f9ba26c87a31e5c20e7b934063624e11ce24c36411790643de50ae93b5944f3c71ce49d8334fe189ad2043dd66dfed54abf975c59626d751a4194da78e6a763742e09f519f9cf1b13367a5098b1445ccd9043b8aa2821f2454f519ad4f2ef66d6cec2f482876630976bd1d14959796256d1ffa3347c98b45731d40d1867e77df8c31afe32ea523d5ab1be8e2f592b134bc1072234ae5a03b5902f3466f60fc479f9e2bb8d81067db71d125ff90cc3e356a06de9b40e0ca9fc6ab6fd9e2e8b4b8ed82b3527dbfe0a86302ddf003713b1616664417ec45b19135daf30168d6c09b36d56e744f8bd33af345860f7e672c8c2f819b7cdaa7b30c9ab129a57f9bad3b428d63b8d07509bcb02d6ced9f32f83b9aa689435e8eefc7c499837830351d8bb4c0474f251e0d21063b5e1597bd3d0af6da0e52acf90a6ef3c8256d8e81c507dcf9b1c615cbcf29304039918ea4ff422fea9b459aab190cf59732c77b48c039586e43177db1bfdce9c1c09ec6926fe1cf0e56681cf3694d2b4e1915e148b149145bc39c1ca70883f9a05deed2b14f9a82cc9a8b2cfb0b0740cb380111825c12e4fc3296e030f76fc2e582d32cbbea4ebb9e72a34e5c752962ca95d889b931998959ea4838c03408ca07c4030d57a392566b891ffcd9060a3a25189a3718e923dfd2ba4dd0131a20293dee75dc39ac3e2822722088f7ab5980e3b7284ee8c486d97ec93cc161debe716072e010b821c2af58a06e939da12c04dad143c4deff6d7e423da0b6dc8f8546a8dcdea0eaab1911f548d95f94996c2a709b4587cb0fcc95af841611229853084366c727f3774d66e8ce11f4cf32f400c5b26ce3ea0a45c58acc1bbd262529fec8160ff5792b5577e6cc0bc8c8fb2661b3d64016cedfd3655e37a059cd3818ee5958d63167c5fd0336ad4f000836fea622d93d74a95899a21a399ee4bb5a48feb6ea65c05fc269b8918beb5c2019d9138bc9746f43dbb0381dc6fdc22ef74da8189e5611c044975822edaad64e3ad1e9c7b390aa2d33871e792f0a84b4bae23bdc58111b34d9ba6817ee87371714a545c6500be627321c54caa6c83873aa3137f90a0f0c93b2ebedb57c0bffac3b754dfe4685001371513f5b5e9fffde7aef3f13977c608053a1a73f70f5c0303edbbb8857fe98c081e9f7fbe274b0a7976e12e476f422a5b186b3ec76e4383a211fddd7667f7f791157cbb2767c72c760348e772017e5fc8c9d8050fb5a4412ce3a5c30519c6ea4534078b30c84a1e75b2546cb64279d159adeca4800751c0996138fc4ad424993fd884989f76886816a31fdfaa54259dfabd6c6d462c3a9b826f2977c3de3444040722b047368c51d22af618160a37550e58e3ec47b783408b32a3da30ae87d5e6fcb3addf256fee51f09e831b4386ff521f28612d4082098a4a022863f23987481812419c027f4123b04ef79de24bc282a93440b538bf75268a6630e806514e15a302fa6849b41abb234ae9e8348db33784af592d8171237458bdb16bedd12c3a4fe6e2e08436ae96e0d54f8d32f9ba0175dab285ce782453f6ce73ac2667755ce49cc0eaaa74955fa89c06b5d6ed287d8fd47df1f962a52ee896fcae419f79733cc01d9977fb2dc95a8b5305eed651470add65c127c8e6a8a2865124889177f54bb8e454d83a29421e7b125c25094947504df3e43963651512d09dea55ea5feb724fea586d97d30984d87ea0b7fd65477cb7aca2db60b70b6a8f9a231f450bcd0abf17f6e856906b76a198bfac97951b1c5ea23948378bdd23a8a4f8e1dce2e5ab1ef4c57c42c5a5a8c92e8e4104c0c41f08b1614d0a652d919efa1e91539b50f3eb1301bb6154d7322bf7a1f462a92e06cdba89f832f8c25b212986ca8253078061210a4d7c0753bf46bbb96adf88a28c09d2b4599ede31b7ef0d46be83c25c9613a7cd326484d6ade64f81adc996686339987ab64aebdc1455b3d2cf913d0ecd00624d489b701b89f920a9b913f20ad37d05d874304e58a0e9d944448b5201d3d1a5973cd21abc1fbcf1444a4fadbf76879754a03f3f5ef704638d25c8e3483e089d240c3ffd0679f03167edd50f62cfda7667ec44c81635de44ffa9c3740205f05362ee5a3b74d68cd0bb95efafa60b1ddcc1d821c6f2fdc8103ac8c2e646d6ba9eed7b16f66092297c19c426c8696d423b4ac6aa90b5293bbc18d2e26ea5f8bd6f238ff49278ad14f4a287a9b28c37310f1091d0e347e0632d382436364e677a7d7262e61fc3c82d386745b5ace3f6010b370ebf46375a402328fb3ef6b464c61dc049b10eb5388a9f352b3768e1f882bfa7428f4011938fead5f12ac6f8b90d407ec61972544014b596d59d1c7b9907e71d2a8d9e661060a1b089e2615b5eb453e7c47ca955b9ab530e27de15a190a94d4da9c2d74b85f66f3f27132af40e07096aaab6a4d10890be0ba25bf45614584d2b1d503ed686d197c5289b6160c0d8898a47e07384c5bbd3bd567c4379df6cc5a6e2c5b2e83a8fbac9f7e692edfd4723e79df1c0fff70b4f3e70e850affe3111a5e07e31a86dda4ef3e1b232188e618a87c765148c43aa76a53abf1abc6755df9e2f6e90f1dfb57d2fdf64b908a8e2a5ee42c5ee14a0aecdc516c29c78a9d0fe06b730f4e57cc30ee397fc4c45b0cdf7f0b7ac17894c587effede010f854f174a3b25d8617b85b828884248ee1e73714b181125ee9080551c2a6bd76f86028e2767d61ccaa1872baa44cd3c9979343d2f9cd1b8f0ba5f86a93a90299baa4208c38b17500a22c699c4e2dd88e2ba4370c39cead098127625a0db8b64810bab8f588eb3e96f900c9e5dbda5f67e797c6ec6564442fb5ce701b29781d7a4008624f114fecf4b0289e66a9a287f50528b52c17ccb2916c4c8f2f53bf9a4474387c62cdd019b7b8a84d73cf47b948751169af8e80712e59e320ecb05eb90ba076c9ff99e3d13bb4f0bc4e1ea8d2f30542d494f523f4b5b868a154372b22adff5ef02c4b13c393c69fb9e3c803aca07bab276c7c40c7ab49118e49ef572e69b345b9338b2abb7655dfa4459e07c80aa340795855b56228ac6755302b80a91607bf93b46fc6747da6621b61e49d4cb58ccd709fc7ad66063354cc169e8a497c28ef4218e842c9f1e96e4e6d82202cce29bbf7e25241277ad4d53fbedf272cb2216c724269d813cbeebc5e9fc77609983b8d8b7a2f8296f31bf022decd24e05adc820002d7ec86248ab224d62cee382defc8c449b17b4e1b2a227f122b0cb72b028c57c550eb0c76ab83a09f71d4b50f619dc3a28aefd4ea44f47994f81faccecd57f04eec4c55e46ee270ad5b5cc2ee0e7c2599cf4f9e7f0c4d358f1f707126124d4df431c871ddda146b969a2f3051a5ddce2961a8f0b910a27fd99be3084f6470acfe496b967b2b0f665fd11762eb547b33b469cd027a22fa5006e77ace408e66ea1213524a462de3d353c16040e3feda52f29c4f22b5743e3e735b55a4fd9919955cfd7855760029cf4f28c5973440f2a229b7fcb74d464376091ef9eece17edffdc31f2b5f7d41ddb8061c22524cfc0205c5cfe887285cc6555f016e5a13c458cf160b63fc7011f7ac8776761c39b5ccef5fa59f6e3b6f116064adf2591e34fb761d5cd603b01f0d4754665d818eaab76f57f2dbaa79d4cdf973ee833f19996433712c034dc1ceaa84d1cb9db1f35a75630307637b7e5b6e44cf06557a21c8f636fd94f3cdfcc8abc724c514a5423ff5a7d70cb371a1e9de9433d9f13d6fc5bd3570d9d4cdc3dfbb44de1ebf3a9f80c603219d67a7033d02af13161a6e321fd4d7c9ca7d751a0853b1e77233935707a3b391af69d04146518bf985862217a83e714fc5ce33c2b418caf4e2f37a9c262784d73d88c3535da629b17825cf16b61808a53d1051f157f6cfb9057314d446efc437684b6fb12bcf74db8566c492e63e0d7c08ebc906b3126bb9b08a37b6027d891960e533ab9056fc59de8caabd57b4bedfa10ac91403bbf962f4e50b46d46106af49ec982c2b432c93b0ac0d56d7d2ec2406af9029d9d9078dde8ff2b578d02aee44dc81e9783daa5a3a5243e46a790a7d375a90535e0bcc503bae0ba5fa52e567c45e9c5c4fe1d4ca9e32121448f4aa9c05f552fc0707c653aa459dc850ed5c04ee1046c26d1697688c44f5096e9bc8db2d93cda5f14bbd11880fdbe6dc52d6cf4330cb32f5d014daac41045fbd0cb0d92ecf5c53e668fbb96cdf52727d9d5802145c6e5ad70f372da4695650b298af2bcafa7fc4a5aa4d1ec330f388f2fd5f7479f340347e610195bdbc3ebe1780449d6b901e256c0044c9594e878a489257067353cbb265730149a272e9e8e29cd065ec0a3d0cdb663857ad3802766789808769506a62bd929ad00dd46069dc964a6b17abedc4b937b17436fb96d387a148fc81788cadf24ce2fc56334e408f1df104debcecae2a265c24d46e244fe4f48f4fd5216d1fd19b51ccae2d6c1f19872b138d633149f998766e35e53d1075d7566659e9926b14b1cafb3c21f2c6c1d35e1f5fc6ba13b8b0045cbbe3735afcdabcf5ef6b33996ab8cadc3e60782b306769636544647ae340e019923f065fca676d9d369791c380f42623f243cb64753a468076a6122491e8d2d8034133efb44d3cf99c573c02f2d2a0ba06f00707ac97645733bf8a27c3a45ad2619f8301fce6e7ab6c3883980918e0f381aad2c2e6116d4e358888e8a807ef57483543707288c2f7ecf536dee8aaf083af6fb727b5da9fab90f2a1cd6bf9b8724b8844e6a22b4939c085d9f09586fae646ff85ccb11fdf03afb42ad8a73390bd47a9ba9b137a1897f46b296943f200e838bb240969e420120ecf4a9bd15a24a0b35e95a3ee5c9a88173d224dcb7911089e7ad5ab60416cd993463086a31626fe173396db1daea1ad5d2b7a88dacaa3f7bb0163b2af0fc9328c3ca6585779e2ba6804561e17b6948902ded8d6ca5cbf2c46d2e29fde857845f56053121562d2681f62ac6134163f920ddbde9ceaa55874a78f43dadc1ae89c4341e1e7ccee23e5dfa829d695bb6664562edd9a04e6b3b20cbbfdde1efd1ebe8f42ca543a5924cd3737613f8239ec06658ea146ef4d38a05635db8f473db688f1aae002ec0424612c59fdf2c363a2bf57aa48ac263750636d413b455134d6b466c26f54fc858a18351d3539dd134800895c80a64500320009791845403135bb48c2ca82ab8d13bc86e48d2b003186cd2989fa50c913e4691af07de2df3a35fe20fa10ef8c99e98614d4285dca1734ec1852b98615dc2a4645c2c487f0e1cb7d9fa6dc02a4929a448878c02d77733f741567c6decc13921b28659fb2b6dcaeef9a9f24722ee6f458ef11db5dfdb639e43ffb1bfe3bb464c4b3004cefbd54a02418b9d05607ee62c9e4f87b815496439f2960f736c601e49532999b3b256ffa714957f58fcb89efe069200c232e52e234244dd73a0ba0f07a2e11dd01e38bcc2c081263e6c7f3f6e218f08e41947f96cff34b0dd0ec1537bf9cd80d9d63e9c1c79a009aac4e30fda5760497382c7156fb920b50406df661f751ae1825fcd5f38651fd9c90b179313ebf25395bc22c69a6b5f9525c443aee6fe0264af2c5fb23306354ef0870d0d9e6e943b4753c7fdbf1efbc53bd064c505db0f467a0c1e01c0bc80fd90d0f7f898018d07b1e2826fe257408228e3bc0f6602940556a314ab4c9858de8508664d2b0dff51059b3ae2514c274c4ad8d26ac33b25e24b7f6a2ead951d48c711b972b60cbecd5c71705e1553def3a0c0987a27daa61dda9cd28e35bd9bd203a786ec8e8520b9278171027f31592212667a46ebbcf1092bcb54042d65a74806b25d4a6ecf183abb5b35e3ae5113236b14a863701776012dd4f6a803cc270b5bbfe73c328baae78137dac9c953ef2118abc748c47d363c7f25ddd4ee26c1e2ac241f79b6f66fdf972659ac784e1b00c3f9517d4815f1557c28b422ee67e6c81502abcbe40f7de12b2c89fd7c328830536596c1b47b6192df2323f2fc4a82969d32516c1fabcfc8044f8b6b6ae16bce0f1f6168c2b88a5aca2f27ec9e478e4e14debd65c020efb6b35897e47464a7ea9cb665f12d3120c90d1a15d532d2602adc8360dbc2c23d804a0c5cf91cfefac9d1fc7385b143623738e4201bafea6ad1651390752d4e1b0a241d9a7734c9bc5c5dffc420f4bc2b6120a9e40d8ec236dc1f1540787cec00a7a6fb27e4f36b6f2cd858ad755e6e8e83c7649dc23f072562b19d6adfd8a9a320c26a44c213f35688e6631ebef5ee96ad05af4148ea05bc80e7f15879594b75b2c1676dd36ac40d48f2d9d4522b9e259cace011b25636ca5c9bc73289f8807e3e139bc8a35a46720a299a1c4af4416ec1732575e1aae59b0f385c06d4ffcac6b108bd93f70eb0ff6382d42b2695515977a2207081a1ee32736bf292c3fd6caec4a22da1af696218d3a6901f95b854fd55f0ec3b9c53a27ececba7a2174a576a6fb903910f67318a8d3646c59cdcbfaa85f5dff153589eec7102a57e9ca1b08b62772a2120c1f03c61fe5d71ee4d9a03b85d125ccc74da6daf0396099493bc61d31871499d8efa010238aa434a60c11fc8271834fadddf13123e1fc5dc2dbcae854fe378ac027a631c9d537b275e403067fab41973fc3f56d616322e6986197d4bdc9aa111c1ca84d484f37e9e989ba8f6fdbc47eb09758ede8a79e7693a0b7f6a11104999dbd99d64eafb50925b1fe82667a4d3445283fbd020df5217105d7eeaa307d9fe205fa3c8ceb8c968ed3d81dc0acd2e7d4e2fe6282cc27da81c851f66ec50b37c852b7ab0383d62e03dec5e607c0fc20bf247317b6c9daec362a11aa295743fc468d59b99d053e022713e52bdc12ab318b7c9308be7f95a444b9409a053da8fc365ac1444a8a7f34049e010c5152e0146813dca4498a4e51a197dad31f34dd708c8f5601ce7e10520b0503d86a4c11cf67362857bff8546cbc1981a7269df857abe8e54227ac1c313d747c4e00a407f3c201a9242830814247fa24cec145c17de4be5c15fe4e17484623b29cd94e0bba05361f83090e434643c346c8760d0afe7559a59fcac523cff065b5586e53da7b70fb06b7fe80e1b37db265ba94496f16e55afcfe6e90da312a2e210da83f8499c42d5e4f84e046cf8ca31c36f7821c7e65aadf51751fc94f88f0f28235b8bd735fc3cacca778a2fdf0c515248d2da325364af966b0f33067c8ebdda2c8ded9be9a3457e46be91ffc3ee6b70e42a4e53c48e989e520858e52873404dcc0e09adc85af91062d839f32b0bde64b87de534f405c80d9de7b6be414669b68bcf3f9b2f88f6664dd39aebf9fa0b89c19441638039bef0df0ec20a253e84dfcd49da3be4b4708adbae21af1a9549d3a1522135e8fa3e121968f8bb6ec61b356a14a45ed617acd27b0ace683728603d735d310443cdfa7441067195f5a1888bd14d8adaa3560ad113c8a4c0072ee221cf02222b779654292a710b17c8295da2cc9fdb0bcf0fb4837dd57236d1abc38b7f445728e0c8602603407269550bf195ba4fa0039f9a00cac3b9b8e51efeb3b4232d0868abf728c4d04c69b4ad883d2ea5efa5cbc4d8b627be411fd0181b0f8b3d372b89763a5fe9597879f6a7ae31564d73e24605325d6ac40a2475104766099d82feafba8eab3baff7b20d049b85619fac7517bb14ee4875c1a66b3b0c5b1c57ad33fed2d204bc59957adbcba01f2a31f2909893e4cbdf5665f5e7f801f4b24a4dcfc59ec430ec0920ded898cc11eaff7e90bc4b82642244c68a9393010bc73a77beb9fdd1146c1c6ac30ea5b0f8544df4d5b66d4a356744703cbe8f214c121437cfa55a2a95f92ad0d884d80c71f8a279d0ab7e2229f0b9e0a778dcdea7a904973f7fd0676a9d662aad80e96b1fe6cf929ff59e0f6e3c7e52bc6e9152bb104093aae84f1155eccf31bacafa5d3f6389ab4fc588354b3e4b3b8ff4c0649a06e591436b4c5fbddaa58c5f70b557c8457364225d5c39e9aa5f255c212784b01a041e7d7313bf9a1d2086b0de0f5127dbcbbe00790e4bbfb7f2f2c02c5f16380ca34d02106d47254e1331316d248ce15560f7bba854c23f3b4f1344be09bbc2476786fa6032e042e2088e30f2c3c319bef70b74e5f50693d22c064548ef45f802086389afea948d7aba5e395580e07e2555361466236a917efbd9ada2bae37f6e7ef88623b8107cf39b3cca3820e3d6f0a8ee3e796b6780bf481c8cbffb041bc7986d5243eefb80d89ea30ca6cf7208dc9067b0a643fdf9c59aaf01f1fea930cf5cc9d90625a9a42d9f090e107db7a84fe0cdf1168e56a370dd481c978112ccbfad91e2392637eb2dc18d6abc48a4df65ad2ffb5ab9e07619e342be47e6f066d0b2631c79ac9f57bb1e217cd8bbff66f24bc579fd56cc0863e62be9af50522c6d46cfc71fc8a667ef4c4aae874049e46e0e8785b1f45dd2972e6fa1c374e11b9a0ebcef9296c92fcb63ece439d4a647fb280f86226ad365231200df0252043ed60a57538d16f5978b4f1e77bf7792fc7bc96fc4d88dd680a793d0cedcaf24374e867cf1cd1e9630aca6e688ad257946d30fae7634b706f0d6b26f72b2f48e5251a087315841950acd1bf12edeb0c557189ff053cf21c0d5b907c2c3735148844f7844d3c1ae8ab613b7d3f6271a86c8e8eacd04382e48a046457afb7398f1f80044bf9acf110d16ae048bdfabd83f679f217475b86c0d2bb983267789d935949f26b39dd6173dbc6282692affa88edd757581c404e8cb55d96fb3c4599bdc5af81d6dd3e3176b081c52d72e0ed548ed791f0e2ba6fe3555ddd021bd36dcdce8aae00f20908e357941edf26906f1bfc0238d5be304a183ddb8e94d9a4a8a0f23b24a0b5a57109a85216211dba30081c69262a9e60df5f55be609743fa5ece4978ff27b87d8d3cdb60c95fb1b7a4f00355d2d81e0211755ac4efa34fd40e68abc775d660f0f3c02eb3bf427d2060638827b84925bfb54457f9af6bb6f468b774ca472e86f80aa28845374cdd13c0abb3b44e45d0dcc126430e313d384c97f2b62cbbafd4afd910134b838bf905e5f25462e0be4604845e66b7c19bb6bdcc5fee746f913cd22c5cc7c8aadee8d15923a0e4acee1534d4a370307bb8066ee5f2aeec8250bedc7d0f316c228751b4efc8bf3182362795d526e0efe2f13cf5a54be0436a9763eee9326bd9c58ce9d464d4bada01a3eeca029660fb8553edcfa0df76833a0d411f0042d43885902970e57b2848eee8e244cd624b13b00d7b0103109a74a7ce355c857230b9716983205b3808edcbf2ca8326e504a8a43176fa1719f6a68a2c9de7a308652883daf880e63140cd8196334a42425940114a20c8b352ab5081bceadde8769d4552f518718813e60b44517d10f78edb1d83788adc3808f47bdb20acecc12fa32526b219781881815ae92e8837eec9e4b102f0b0f25f686cde41c862a2bd7d9a33b6efcd8b3474e47ca7ee8d38faa345d331da3d61c3362099e874c88366fdde41a737b07552cefef6f188019b45b564fddf812a082def4de439f8ecbde243543f8a92c9ed9616c7d5a3ace4e495e827a92e0200ed5c4ac1294d3de1e85196cdd84313a0b9a95940f14a69a51f7546486a003a0305f1d4ae89f1fc1bb82eb7bd946051cb51dcf1bbb11d617a5c1ac935d216da8f149f840eceaa36f553a8d8b58ff88849dc956b948da65d2a7e07938fdc001189a6d153e9eb1ce0f75fe85beb1162cd41be4ce11ec685f5eade46f0b4edf5ebb98fb6b1e4b4fabfc03c4014db3f6032d391df112f3b4d908802454f6f39a2733b79d9b65d627b424d2cc87564b30566ad0441e0161c5b1a19dcba77697459ddfc6f3d5e71bb295c5d7098df9ecffed92451fa4a6e57b3e8b7eac30005a2b6eb68c168f18fd758e814c998855a5ec84abb4e483156a90297225cc7a58e22d36d98b7c4ce2cb65a87a8acb987bf7b5f4d8f06790751c069a663b8cd27fcac7e1a367ac97cb83d26b46ec19c06f239f4fc1a19709a7a5c40b0555dcb19643cea0c03cd1a0200d6bd7e0795b606473fd2dff7aa7e62fa375514b647204bfdab99b90d8f59f003734189a1d9cb6127fe7c10afc244c69de3ecb78ebc4eeb3aa2adaadda5d15bb1696edc7b69a6bbf5c9ac5278831a3b04c15f4d8d5ce6ad682fa4ca0830a784c774c274973215b9996f408dab7655e0301fb0eb50973fc0b5e3ccb9c3cff4a7546a24b8de407e4f03fb8b288cbe09c6f58073533e4e11a0a8d70956257def1f477dc1b65ae73705a43085ba96958777c8927047595a9bc1229dae3e0ea26d05ddd4953ebc8e273d49b60e7c949eaffd929b8a1d2e064f014e2394b47e8b8f804f5b6c4eee6fb399476a16f4c1275b0e0c5cdc348ab2b6dbd46857170044243df7e239740637d59a4f4806657ab4faf007de268425cc81128176039302352143bcbd7e468b66ee14fc712c49cd9762f6d7a243fcb367dfcb05416e732476ef88873d1a10f4fe0dd521e084dd54e7c4fb12f6864e4962387a064cda1d36e36e86c9fd1916eaefd94696754676ff140a3b73de56ac91e4378a26f8346247c119b996033d73f5401c41f5c92699cb2a4125c8ed1717429eebd35b87b41b6312af438dcfe18780659291f67ca43ca950a0124fdea8d4c527f16503da1e15837cb3ddd215822ba6147711cd46fda065d022b0519cadd1a8cf164f873c241bdb31d873dd7c38c0683bbc38d0af75e1677715b671399d41572b54a81ff6543d72e104e98ea4422ece8960e31414e92ef685d6456beb8a7ac9f1dd3086065088fd8c9b4fd9e7784358d1d79a25fd98703e030a585d564939c3d09d5247bf78861cd5bb93d9138d0868b67bf849468bd921af25ac75ecc7423fe2bf25d34c9fce82347cf280caaad72e93402d20c3dd77957ce8e43f62102f62ed37f1cdf25d6b2610e05b63f5828e7becbc44417d7d37f5ba50ab446e8e729c648ede0f7a68962b72bc805856f146f8ef24ac240a292f8ea03f2065e2a09d02360b56c551b2c1e5dd7f023fcfc2ca098d3bcf83b8b34ab47d12e18a772e2a158d054290e5deb59e73222afae2182d67b25a483dec50f3a107d689fffa61a31b32e45bfc5d1d7594cf386d624dd72414e12413ee79acf48b8f99a2fad708aad25d39bedb31c1c8eabefb82fb6ea2097ad3dcb07ac61450dcf08981343d8e5e01406b8ea25184f9f31fe3c47d77b6d7d1d791c568225ba047358500c793635a68d89a537908694cd6ca559fd055b71a17e487f9abc66f3981c25373720086fda179efa46f5ed47689e74629158bec2853f23fc2c8bd457634313ec9298a629148c2218ff5c49e9044d791bb373e0ba3b78d54a10c1908bd1d457f3778d55260869062d9a8412cfe0fdadb168cd2c4e4c489fe60af8e0e929b61d673a18b8f22c8949c68148e60fd2b32eff44a07b6d5dc56039c6c7557718f826c0fb01c58940ccb932c7512ec557a9f60a74aadb64433663696ef878348a31a6fccc18928780fef0709a4f56d6071a4b168368e8b41457449028013b7ef1ddf2b32ee60ef0c809312c3c89d9b7ecb40db0e0db146b278c5749ae0559f21589ede071b51b8314ee21a009768db1be4846aed7c9fbcdf67484e07f844254ebaf479849b89d100803619e3794c8246cc5a037586ed373479a7fd03e7aced2f8b8064894b894bb352542ceb350dcc8e615bb13d21471e066e651a8a4c32308a91105ab19281d741091f54f75e34521f8bf38d58c5c55dbbfc5c2cfc6101804eb45e87f9ed22eb9f68f23290953ec2f64c724aee44ab7c13751f7f36b6116ce85bc05428409331270d4898c542fb1a38e8581255ee07accb4b152e61e4c695651131dc577e70255db751a60c375213cbc7bef006f3bab22314f972cf05647a71e39386113f828dd1131a344f827c8d70f1acea835dd0834c6c78ef1fbd336978513be5828c898aefaa5ad73fdb05da229bc826d75b9d9e59356da723c8369371c510e23559d8e61ef97b704bf3765cf41583006cf5d805fe33334a6e4c1d2b64f25e67494306514daf43313e60c6eb4b7e1de4f89fdc82c85ce2afab3708ba341c5c7fe17f2508efeb9471462b4878138ecfc444cb3bd81bbe47f67690184b6e1b2d7354d5ebef41272170f69da5f0a0bf45a0345f7f6b0068894b63ece91d9eed4eaf7d0c87009f529c2e865bf64eeba1f29f2f079ef6d70d0784ee7537b18febe8d396b0b2c372cf3038904fe0e1b0be2468a48d9b344d5e802c3ccfc9c339aaab227b3729e3285a13723032e3f4d9d9dde545d2e136df370f41af38f8385d946eaf77a00fefb75c974744ea532363312896cdb20abb7795ce02ab1b5a0c1c22bb9785b30f243448da227a39314d64c83422227d6aa455baa451985a8a138a20f6551a3da9484e625b1e04bd08f359d98e2d73cb6b653eb54e3765697160da44a05d6cdb3a83fb7a87e9916ffcadd4d59409797eae5e81beb3c403b0dfc30c3ef4948940135a3336489fbb9c097fd31f975906a421999b9887d1d4417e5fdc4be2a578d3e98e96cde6fcaf89d26a8f93b2239b7bdc2ce21b7223fe2f7d56e844f53fafe79c39652380f1a0b07e8e7bea083ba872f50dc25c9fc4cc44ecf6b87c3b177f5278fbe0e64586beab3c6b011861a0113d42a5fdb9fbacb9b884ebf39b3b761703d126cbc6cfd4807d5f6368337781ee027c8e305ac0bb1eaad362ea3be0ea79ac9ddbe497726786bfabc529fc4d5d829756ba233830c27d831bec98f33c94a8574bc277fa411d64d7cc52422d59e4858c7f0a96a2f7675fae25dc1baee01a9569ac430e87a1c76531c019cfa8a33afaf9f7d0cfca00da345ed26556006bc57c89c738f0608a3d046eabf1ecea0928e77b5ef11074939b07dd7d96fc8e9873c0ddd5c88633abb0e1232ab9417b29d7c0dc53abf18c96007c609ce0fc27baf766816004cbed92541ccec55afe97b996ddbde7be76428e080a236b86c21eb5f192a8dd5b1e874e9369a1abbde340884d377d347de171eeba684dab994a8f499b493b5fab179ec2eeb2b29b42ea06a399b12ce547240c0bc1f53dca2264d3cf528d420c57ff417be4c58c9597a637ebbe70cd94a743975499f2a2e3e92a03c04d22b463558ea464c144766c5f2fe8da0a89dde714d380e5d1f5bde4532c2550f2cd4176abf5cf9ce608f322ba26158897c89e6422e86de7cadfcd87ea26c816c4c02347f896591a489f5015b30624a1a13a8be93bb0d71fdd65f43a36c5d9b5235a8aa877bdf8bb893716aa950387fbaa92d3f78a2b22196f864f031c27dd7b4aa565550d542c799eda3e9fa4a2821d857ebc50ba605aee6c249042a2bf660ff683589a5225829793baa41f5bfb75e4a020267ef2e48fb1847a6cfc993c2a3155fdb1eb023516cf36618dbc82baa9c25be6e2d89eb3b1dae0da119f8909dc84713bdd040e5d01fc7ccd20d5cae0bb23f7faafc333073f70b0ada699bf40de12a43bcc8ac2135813c7f8ace67b517f46b0eb96947e6c908f6e3a385e6b2dbfb2cdfd456330aadae96bbeb671ff402491727dc35b18ce5c26348169a9e173ee906d9f93aed65ebe12ffbea55a553541c5c65d359c91f0937a04cf561f954522d01e9d96b5425eb34db2a6affc0d75d5d8990be0fedca60a89bbc2756d2b83ba3c2f88478ac69d5b5473739f7251a06fbecd704a9c76f8af3a186d122a415b183f3ad318d6b03a1e9d8d20aefa8d098bdb595aacd05760106715b8f8ba7ca01b4bba17d0e0a8b339f730c7eceaa76b20748e0902dd7508c3e354a29508df93aa47eaf47775d5c5b883c6ef2842ff3859bc69261be3dfcbef72f8025764ddd77549b860c40124586ffe2e10d9ba2bf049854a9f47bb7748f169b3599d4d90d00bdbefb250378b2961d16da87c448fce4e70c825c737f0c699a06fa7b054d09e8ac36881a014b897ec6e86e531dbbabbb955e3eff84319c779d57d90dd8a8d46bf50ac484a45a690fa039758f6b097d8b4f844a112da20d570bde69d7ec029d8f0ad74b23b87710a7d7b371e07aecb47d3084f44dfbc471c7e2e2eab027b92fcad12502a1ba701eb685b417e4c588a9c3713912c2ee173a39488e1aa6fe6ec2d7d9f7ab2454498bcc1ffd3926fafbde2d3650d906199b7d9dea2888f9d252522f6374ec26e97ddd62c65c8475107f79b449367f6b93f30a54125bed6cf1faba5865871998b6b2c59713e5a5eccb6c131947117620f0662440b1efb4c53b581abcd66435f83a7e5a0558167aa59929737575b993ec00ab85de016892d9764b37704a8d1691c60d95df9ed0f60d7c25223f7a41b51cc18b8de52de8ab0cc9041586f8e0a9e6f597266c6d143de3ca04845e4c37b07892ed8ffd7dae6a924c4ac0653406b4a1f3c47d43cc87178fafb903d385017265cd79d6c5fce3cec82b1a1def6327506656714987ef7afa379c3a5bffe1807b764e2c49a987ceb79825bd9c74d4c7596972ef6d0e04f2d0a84af92143d20ec64f5f381cfb7b5221064fbfc3c3284f7c3c06890790fcd8d0d8ef6e2bc4bc696e65ce295841bc3f9e15d6554db2f64ab80b201cb1e97b6db63cc108732b8ba91f839d1c66d6bc1d80d9b0ba3f46ca3398d5bb5d64abb1350f833593ae84451501ffeef133b15d4f68d81b0fe076d9af21de1a38519bc7ffc90c9ee32378d7d77bfce31208fb8d8f4a5065e4c1f7f0bbd9d7fd1b4e64d1b7329a75f9a9125316f19a5deed0018178d7fe61d8bd4ef9b45ab61d6dc576c3f70a95f1887db5774c631606c9ed490f56753f59509c19583fbda5b8caa4f4da5f149c72a70601348ffd72a73a65e4219467d2c78a014d6727674f3d1b29fb02cdcb420f337791cc11360aba7b2197a0f5d527670f2b7b7bed2a15e2967c5a62f95eeba590cc3ec43204660ee5ff77d0dcbe7c1c5a1dbbbf17ce7d699fb138b237827e1b89f162621deadd3a90c1d56081db0a0f9b907c1d182fa1704cf</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">您好，这里需要密码。</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这里有东西被加密了，需要输入密码查看哦。</summary>
    
    
    
    <category term="macOS" scheme="https://blog.wangk.cn/categories/macOS/"/>
    
    
    <category term="macOS" scheme="https://blog.wangk.cn/tags/macOS/"/>
    
  </entry>
  
</feed>
